<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/blog/","images":"/blog/images","scheme":"Muse","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>
<meta name="description" content="思绪偶尔会在这里停留">
<meta property="og:type" content="website">
<meta property="og:title" content="超凡魔力">
<meta property="og:url" content="http://example.com/page/35/index.html">
<meta property="og:site_name" content="超凡魔力">
<meta property="og:description" content="思绪偶尔会在这里停留">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="chaofml">
<meta property="article:tag" content="个人博客、超凡魔力">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/35/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>
<title>超凡魔力</title>
  



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">超凡魔力</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">君子善思，善假于物，而不物于物。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">chaofml</p>
  <div class="site-description" itemprop="description">思绪偶尔会在这里停留</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives">
          <span class="site-state-item-count">357</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
        <span class="site-state-item-count">97</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/04/php-api/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="chaofml">
      <meta itemprop="description" content="思绪偶尔会在这里停留">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="超凡魔力">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/04/04/php-api/" class="post-title-link" itemprop="url">文件源代码分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-04 16:06:00" itemprop="dateCreated datePublished" datetime="2019-04-04T16:06:00+08:00">2019-04-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-03-17 11:42:22" itemprop="dateModified" datetime="2022-03-17T11:42:22+08:00">2022-03-17</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p><a target="_blank" rel="noopener" href="https://github.com/mevdschee/php-crud-api">php-crud-api</a></p>
<p>这个是数据库的api文件，如果是跟前端配合的话，那么前端最起码需要做两方便的的工作。</p>
<ul>
<li>写一个orm类，代理底层Ajax的跟Api.php沟通。具体参考一下，odata提供的js库。</li>
<li>Api简化了后端的工作，但是前端相关接口处理工作，应该独立成一个库文件，这样方便多端复用。</li>
</ul>
<h2 id="代码思想"><a href="#代码思想" class="headerlink" title="代码思想"></a>代码思想</h2><ul>
<li>运用psr-4的命令空间，方便类的加载，已经打包合并</li>
<li>工厂思想（待完善。）<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000019280079">参见</a></li>
</ul>
<h1 id="build-php"><a href="#build-php" class="headerlink" title="build.php"></a>build.php</h1><p>这个是打包工具，将src文件夹中的php文件打包成一个文件夹。其中，src/index.php中有一行，不要再格式化此行代码，估计打包的时候严格的替换掉。打包的左右有两个：</p>
<ul>
<li>将多个php文件合成一个文件。</li>
<li>删除php文件夹中的一些不必要的内容。如命名空间、&lt;?php 等符号。</li>
</ul>
<p>思考：如何不需要支持sqlite、post等数据库，那么打包是否精减，不再包含其他的数据库的函数，这样减少体积？</p>
<h2 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h2><h3 id="index-php"><a href="#index-php" class="headerlink" title="index.php"></a>index.php</h3><p>所有的文件都在PhpCrudApi中，在最外层有个index.php文件，这个是配置文件，所有的设置都在这个里面。通过在这个文件中进行设置，然后再通过build.php进行打包，能测试，能测出数据库连接是否正确（非主要），否则生成一个tmp_api文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;自动加载，如果是打包成独立文件，则不需要这端代码。</span><br><span class="line">spl_autoload_register(function ($class) &#123;include str_replace(&#39;\\&#39;, &#39;&#x2F;&#39;, __DIR__ . &quot;&#x2F;$class.php&quot;);&#125;);</span><br></pre></td></tr></table></figure>

<p>上面的代码，要进行反思、总结。如何像空间一样，不需要手动include文件。如果自己写框架，是不是要用上上面的这个函数。</p>
<blockquote>
<p>配置config对象→ Request对象→Api对象  然后api-&gt;handle处理生成一个response。response进行输出。</p>
</blockquote>
<p>所以接着研究config、Request、Api对象。</p>
<h3 id="Config-php"><a href="#Config-php" class="headerlink" title="Config.php"></a>Config.php</h3><p>配置对象，即index.php中的配置。主要功能，储存所有的配置。不要在这个对象里面进行设置，试过，在这个里面进行了数据设置好像也没有用。但是这个框架里面的默认设置都是在这个里面的。</p>
<h4 id="在这个对象的构造函数中，步骤如下："><a href="#在这个对象的构造函数中，步骤如下：" class="headerlink" title="在这个对象的构造函数中，步骤如下："></a>在这个对象的构造函数中，步骤如下：</h4><ul>
<li>优先获取到当前是何种数据库，getDefaultDriver，如果没有设置，默认则为mysql。</li>
<li>根据上一步判断数据库类型的结果，获取默认的参数defaults，’driver’,’address’ =&gt; $this-&gt;getDefaultAddress($driver),’port’ =&gt; $this-&gt;getDefaultPort($driver),</li>
<li>合并结果三者结果。类默认的参数，获取到的参数，用户在index.php中的参数，即array_merge($this-&gt;values, $defaults, $values)。大概的意思是，怕用户设置错误。测试过array_merge，最后的优先级大，即会覆盖调前面的同名键名。所以，这功能：如果在index.php中进行了设置，则用，没有的则用类默认行为。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;测试例子</span><br><span class="line">$a&#x3D;array(&#39;name&#39;&#x3D;&gt;&#39;zhangsan1&#39;);</span><br><span class="line">$b&#x3D;array(&#39;name&#39;&#x3D;&gt;&#39;zhangsan2&#39;);</span><br><span class="line">$c&#x3D;array(&#39;name&#39;&#x3D;&gt;&#39;zhangsan3&#39;);</span><br><span class="line">var_dump(array_merge($a,$b,$c));</span><br></pre></td></tr></table></figure></li>
<li>解析中间件设置。 parseMiddlewares。这个函数，可以看到php7中，可以指定返回类型了。功能：上一步得到的设置只，middlewares 通过逗号分隔，忽略单词两遍的空格。array_map(‘trim’, explode(‘,’, $values[‘middlewares’]))。还要考虑这个配置项中如果有句号.问题。这个函数的功能，有待深入了解。暂略。</li>
<li>比较生成的配置的差异。array_diff_key，如果有差异，则抛出异常。（防止什么？有啥作用）</li>
</ul>
<h4 id="这个类的其他方法"><a href="#这个类的其他方法" class="headerlink" title="这个类的其他方法"></a>这个类的其他方法</h4><p>都是简单的返回该类的成员变量，或者进行一些加工，json_decode，array_map(‘trim’, explode(‘,’, $this-&gt;values[‘controllers’]));</p>
<h3 id="Request-php"><a href="#Request-php" class="headerlink" title="Request.php"></a>Request.php</h3><p>构造函数有很多参数，如果没有，则进入默认处理。即从$_SERVER数组中获取信息。</p>
<p>构造函数，步骤：</p>
<ul>
<li>parseMethod。默认参数method，设置成员变量的method值，优先级：参数 &gt; $_SERVER[‘REQUEST_METHOD’]  &gt; 默认 ‘GET’ 。<strong>能否抽象成一个函数？</strong></li>
<li>parsePath。跟上一步差不多。设置成员变量path的值。优先级：参数 &gt; $_SERVER[‘PATH_INFO’]  &gt; 默认 ‘/‘ 。另外，$this-&gt;pathSegments = explode(‘/‘, $path);</li>
<li>parseParams。解析参数。也一样。设置成员变量  的值。$query 优先级：参数query &gt; $_SERVER[‘QUERY_STRING’]  &gt; 默认 ‘’ 。<blockquote>
<p>备注：test.php?id=1&amp;b=c&amp;a=1#jk    id=1&amp;b=c&amp;a=1</p>
</blockquote>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$query &#x3D; str_replace(&#39;][]&#x3D;&#39;, &#39;]&#x3D;&#39;, str_replace(&#39;&#x3D;&#39;, &#39;[]&#x3D;&#39;, $query));</span><br><span class="line">&#x2F;&#x2F;输出：&quot;id&#x3D;1&amp;b&#x3D;c&amp;a&#x3D;1&amp;a&#x3D;2&quot; &#x3D;&gt; id[]&#x3D;1&amp;b[]&#x3D;c&amp;a[]&#x3D;1&amp;a[]&#x3D;2</span><br><span class="line">&#x2F;&#x2F;调用了php中系统方法，parse_str </span><br><span class="line">parse_str($query, $this-&gt;params);</span><br><span class="line">&#x2F;&#x2F;作用：将形成 key &#x3D;&gt; array() 形式，如果有多个，数组里面的内容则有多个。</span><br></pre></td></tr></table></figure>
<ul>
<li>parseHeaders。如果没有传参数，那么从$_SERVER中以HTTP_开头的获取。。最终，$this-&gt;headers = $headers;  </li>
<li>parseBody。这个函数如下，下面这个曾经是我的遇到的一个问题。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private function parseBody(String $body &#x3D; null) &#x2F;*: void*&#x2F;</span><br><span class="line">    &#123;</span><br><span class="line">        if (!$body) &#123;</span><br><span class="line">            $body &#x3D; file_get_contents(&#39;php:&#x2F;&#x2F;input&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">        $this-&gt;body &#x3D; $this-&gt;decodeBody($body);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>复制成员变量highPerformance的值。 这个变量的作用，大概是阻止从$_SERVER中解析。</li>
</ul>
<p>在这个类中，看到了很多注释掉的返回值类型。/<em>: ?object</em>/  为何？难道是因为太严格了，报错？ 另外，其他的方法，都是获取、设置成员变量的值。但是有个方法，fromString。</p>
<h3 id="Response-php"><a href="#Response-php" class="headerlink" title="Response.php"></a>Response.php</h3><p>输出结果的方法。总代码也不多。重点函数如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public function __construct(int $status, $body)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;status &#x3D; $status;</span><br><span class="line">        $this-&gt;headers &#x3D; array();</span><br><span class="line">        $this-&gt;parseBody($body);&#x2F;&#x2F;这个步骤中进行了json_encode</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> public function output()</span><br><span class="line">    &#123;</span><br><span class="line">        http_response_code($this-&gt;getStatus());</span><br><span class="line">        foreach ($this-&gt;headers as $key &#x3D;&gt; $value) &#123;</span><br><span class="line">            header(&quot;$key: $value&quot;);&#x2F;&#x2F;之前一直听说双引号效率不高。但是这个却用了。</span><br><span class="line">            &#x2F;&#x2F;我自己简单的测试了下，好像并没有太大的区别。</span><br><span class="line">        &#125;</span><br><span class="line">        echo $this-&gt;getBody();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>由于是api接口，所以如果data有值，则指定了Header(‘Content-Type’, ‘application/json’)。</p>
<h3 id="Api-php"><a href="#Api-php" class="headerlink" title="Api.php"></a>Api.php</h3><p>最复杂的应该是这个类，它本身不复杂，但是引入了很多的其他文件。相当于入口引导。从index.php的使用方法上可以看到，这个类很重要的一个方法是handle，然后返回一个response对象。</p>
<p>这个函数，主要用了api同目录下的其他子文件夹下面的文件。</p>
<p>这个类主要有三个私有成员变量。$router;$responder;$debug; 其中debug从配置中获取，然后控制添加调试的头信息。</p>
<p>这个类主要有两个方法，一个构造方法，一个handle方法。</p>
<ul>
<li>handle方法。从$response = $this-&gt;router-&gt;route($request);进行获取。如果异常，则try catch处理异常。异常的抛出的值，数据库抛出，ErrorCode中定义。</li>
<li>构造方法。这个是重点掌握。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/02/better_coder/2019-04-03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="chaofml">
      <meta itemprop="description" content="思绪偶尔会在这里停留">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="超凡魔力">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/04/02/better_coder/2019-04-03/" class="post-title-link" itemprop="url">拖动排序问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-02 10:09:00" itemprop="dateCreated datePublished" datetime="2019-04-02T10:09:00+08:00">2019-04-02</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-03-17 11:42:22" itemprop="dateModified" datetime="2022-03-17T11:42:22+08:00">2022-03-17</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="拖动排序"><a href="#拖动排序" class="headerlink" title="拖动排序"></a>拖动排序</h1><blockquote>
<p><em>Ext.data.NodeInterface</em> 这个对象还树形treepanel是很重要的。store里面存放的都是这个。展开、Expaned或者折叠。</p>
</blockquote>
<h2 id="相关知识"><a href="#相关知识" class="headerlink" title="相关知识"></a>相关知识</h2><ul>
<li>快速查找相关的工具，比如grid插件，通过这个关键字 grid.plugin</li>
<li>DragDrop源码，这个插件源码非常简单，里面有个重要的函数，onViewRender。其中有一行代码：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ownerGrid.relayEvents(view, [&#39;beforedrop&#39;, &#39;drop&#39;]);</span><br></pre></td></tr></table></figure>

<p>所以从Ext.mixin.Observable中查找到这个relayEvents函数，主要功能是用来传递事件。即将插件的触发的事件传递到grid表格。</p>
<h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><blockquote>
<p>从后端来说，为了满足排序，必须额外使用一个字段辅助排序。但是增加这个字段order，给一个默认值，比如100，又不会增加额外的编程难度。（排序，并不是更换两个id）。总结：目前还是没有好的想法，最简单粗暴的处理方式就是，前端直接将一个分组内的排序，告诉后端，后端直接进行遍历，从0开始增加1。（字段默认也是从0开始）。但是这样的问题是，业务处理代码简单，但是数据库增加了不必要的操作。(暂定此方法。)</p>
</blockquote>
<blockquote>
<p>从前端来说，需要支持拖拽排序。从网上找到了Ext的这个插件的用法。但是细节还不清楚。参见<a target="_blank" rel="noopener" href="https://blog.csdn.net/hwhsong/article/details/50594619">文章</a>，代码基本可用。</p>
</blockquote>
<h3 id="核心代码："><a href="#核心代码：" class="headerlink" title="核心代码："></a>核心代码：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">viewConfig: &#123;</span><br><span class="line">	plugins: &#123;</span><br><span class="line">		ptype: &quot;gridviewdragdrop&quot;,</span><br><span class="line">		dragText: &quot;可用鼠标拖拽进行上下排序&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="实现Grid行的上下移动"><a href="#实现Grid行的上下移动" class="headerlink" title="实现Grid行的上下移动"></a>实现Grid行的上下移动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Ext.onReady(function() &#123;</span><br><span class="line">	var proStore &#x3D; Ext.create(&quot;Ext.data.Store&quot;, &#123;</span><br><span class="line">		fields: [&quot;code&quot;, &quot;name&quot;, &quot;num&quot;],</span><br><span class="line">		data: [</span><br><span class="line">			[&quot;#001&quot;, &quot;iPhone6&quot;, 100],</span><br><span class="line">			[&quot;#002&quot;, &quot;iPhone6 Plus&quot;, 80],</span><br><span class="line">			[&quot;#003&quot;, &quot;Mi Note4&quot;, 99],</span><br><span class="line">			[&quot;#004&quot;, &quot;Galaxy S6&quot;, 75],</span><br><span class="line">			[&quot;#005&quot;, &quot;Smartisan T2&quot;, 68]</span><br><span class="line">		]</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	Ext.create(&quot;Ext.grid.Panel&quot;, &#123;</span><br><span class="line">		title: &quot;可用鼠标拖拽行数据的Grid&quot;,</span><br><span class="line">		width: 400,</span><br><span class="line">		margin: 10,</span><br><span class="line">		border: true,</span><br><span class="line">		store: proStore,</span><br><span class="line">		columns: [&#123;</span><br><span class="line">			text: &quot;产品编号&quot;,</span><br><span class="line">			dataIndex: &quot;code&quot;,</span><br><span class="line">			flex: 1</span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			text: &quot;产品名称&quot;,</span><br><span class="line">			dataIndex: &quot;name&quot;,</span><br><span class="line">			flex: 1</span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			text: &quot;产品数量&quot;,</span><br><span class="line">			dataIndex: &quot;num&quot;,</span><br><span class="line">			flex: 1</span><br><span class="line">		&#125;],</span><br><span class="line">		viewConfig: &#123;</span><br><span class="line">			plugins: &#123;</span><br><span class="line">				ptype: &quot;gridviewdragdrop&quot;,</span><br><span class="line">				dragText: &quot;可用鼠标拖拽进行上下排序&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		renderTo: Ext.getBody()</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="实现多个Grid之间的相互移动"><a href="#实现多个Grid之间的相互移动" class="headerlink" title="实现多个Grid之间的相互移动"></a>实现多个Grid之间的相互移动</h3><p>要让行数据可在多个Grid之间相互移动，只需在Grid引用Ext.grid.plugin.DragDrop插件时，为其指定同一个组名，表明它们属于同一组，可相互移动。</p>
<p>当然，前提是这些Grid使用的Model类应该一致，即表格字段应该一致。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">viewConfig: &#123;</span><br><span class="line">	plugins: &#123;</span><br><span class="line">		ptype: &quot;gridviewdragdrop&quot;,</span><br><span class="line">		ddGroup: &quot;DrapDropGroup&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="开始处理代码"><a href="#开始处理代码" class="headerlink" title="开始处理代码"></a>开始处理代码</h2><p>版本说明：使用的是Ext5.1.0.107版本。使用6.5中的手册写法略有不同。</p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ul>
<li>插件的事件无法监听到。解决办法，写到viewConfig的listeners中。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;备注：me指代的是grid。另外写在grid的listeners也没有反应。</span><br><span class="line">me.on(&#39;beforedrop&#39;,function(node, data, overModel, dropPosition, dropHandlers) &#123;</span><br></pre></td></tr></table></figure>

<ul>
<li>找到排序后的数据</li>
</ul>
<p>只是简单的跟了一个位置before、after。通过store.getData获取到数据。</p>
<ul>
<li>理解事件传递的值，解决了判断，该节点能不能拖拽到节点</li>
</ul>
<p>当前拖动的记录：data.records[0]<br>目标的记录：overModel<br>相对位置关系：dropPosition</p>
<ul>
<li><p>父节点，默认只展开一级。代码写了，却没有效果。</p>
</li>
<li><p>显示优化问题</p>
</li>
</ul>
<p>如果重新加载数据，则数据全部重新刷新了。原来展开的，折叠住了。如果不刷新吧，那么拖动末个节点，显示异常。</p>
<ul>
<li>展开节点问题</li>
</ul>
<p>必须使用Ext.data.NodeInterface提供的expand、collapse等方法。而不能通过record.set方法来实现。注意跟checked的区别。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;************</span><br><span class="line">	2019&#x2F;4&#x2F;2</span><br><span class="line">	只展开顶级节点</span><br><span class="line">************&#x2F;</span><br><span class="line">expandTopRecord:function()&#123;</span><br><span class="line">	var me&#x3D;this;</span><br><span class="line">	var root &#x3D; me.store.getRoot();</span><br><span class="line">	Ext.Array.each(root.childNodes,function(node)&#123;</span><br><span class="line">		&#x2F;&#x2F;注意不能使用&#x2F;&#x2F;node.set(&#39;expanded&#39;,false);</span><br><span class="line">		node.collapse();</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;官方手册</span><br><span class="line">Ext.grid.plugin.DragDrop</span><br><span class="line">drop ( node, data, overModel, dropPosition, eOpts ) </span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 官方例子 build&#x2F;examples&#x2F;kitchensink&#x2F;?classic#dd-grid-to-grid</span><br><span class="line">onDropGrid1: function (node, data, dropRec, dropPosition) &#123;</span><br><span class="line">        this.onDrop(dropRec, data.records[0], dropPosition, &#39;Drag from right to left&#39;);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>范围</li>
</ul>
<h3 id="简单的处理逻辑"><a href="#简单的处理逻辑" class="headerlink" title="简单的处理逻辑"></a>简单的处理逻辑</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;me.getdog();</span><br><span class="line">var view&#x3D;me.getView();</span><br><span class="line">view.on(&#39;beforedrop&#39;,function(node, data, overModel, dropPosition, dropHandlers) &#123;</span><br><span class="line">	&#x2F;&#x2F; Defer the handling</span><br><span class="line">	&#x2F;&#x2F;dropHandlers.wait &#x3D; true;</span><br><span class="line">	</span><br><span class="line">	&#x2F;&#x2F;1、判断当前节点，</span><br><span class="line">	&#x2F;&#x2F;一级节点，则进行折叠</span><br><span class="line">	&#x2F;&#x2F;否则，停止拖动前进行判断，如果合适，则允许放入。</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	&#x2F;*Ext.MessageBox.confirm(&#39;Drop&#39;, &#39;Are you sure&#39;, function(btn)&#123;</span><br><span class="line">		if (btn &#x3D;&#x3D;&#x3D; &#39;yes&#39;) &#123;</span><br><span class="line">			dropHandlers.processDrop();</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			dropHandlers.cancelDrop();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);*&#x2F;</span><br><span class="line">&#125;);</span><br><span class="line">view.on(&#39;drop&#39;,function(node, data, overModel, dropPosition, eOpts) &#123;</span><br><span class="line">	&#x2F;&#x2F;获取排序后的数据console.log(me.store.getData());</span><br><span class="line">	&#x2F;&#x2F;根据当前节点ParentID，过滤出该组的数据。</span><br><span class="line">	&#x2F;&#x2F;然该组数据发送致后台</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="正式代码"><a href="#正式代码" class="headerlink" title="正式代码"></a>正式代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">var view&#x3D;me.getView();</span><br><span class="line">&#x2F;&#x2F;注意，使用这种方式进行监听</span><br><span class="line">view.on(&#39;beforedrop&#39;,function(node, data, overModel, dropPosition, dropHandlers,eOpts) &#123;</span><br><span class="line">	&#x2F;&#x2F; Defer the handling</span><br><span class="line">	dropHandlers.wait &#x3D; true;</span><br><span class="line">	var curRd&#x3D;data.records[0];</span><br><span class="line">	&#x2F;&#x2F;判断当前节点，是否可移动，同一组内可移动。</span><br><span class="line">	if(curRd.get(&#39;ParentID&#39;)!&#x3D;overModel.get(&#39;ParentID&#39;))&#123;</span><br><span class="line">		dropHandlers.cancelDrop();</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		dropHandlers.processDrop();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">view.on(&#39;drop&#39;,function(node, data, overModel, dropPosition, eOpts) &#123;</span><br><span class="line">	&#x2F;&#x2F;获取排序后的数据console.log(me.store.getData());</span><br><span class="line">	var curRd&#x3D;data.records[0];</span><br><span class="line">	var pid&#x3D;curRd.get(&#39;ParentID&#39;);</span><br><span class="line">	var Rds&#x3D;me.store.getData().items;</span><br><span class="line">	&#x2F;&#x2F;根据当前节点ParentID，过滤出该组的数据。</span><br><span class="line">	var fRds&#x3D;Ext.Array.filter(Rds,x&#x3D;&gt;x.get(&#39;ParentID&#39;)&#x3D;&#x3D;pid);</span><br><span class="line">	var ids&#x3D;Ext.Array.map(fRds,x&#x3D;&gt;x.get(&#39;GroupID&#39;));</span><br><span class="line">	&#x2F;&#x2F;然该组数据发送致后台</span><br><span class="line">	Ext.Ajax.request(&#123;</span><br><span class="line">		url: &#39;&#x2F;admin&#x2F;device&#x2F;Terminal&#x2F;orderterminalgroup&#x2F;&#39;, </span><br><span class="line">		params: &#123;&#39;ids&#39;: Ext.encode(ids)&#125;, </span><br><span class="line">		method: &#39;POST&#39;, </span><br><span class="line">		success: function(response, option)</span><br><span class="line">		&#123;</span><br><span class="line">			&#x2F;&#x2F;记录当前折叠状态</span><br><span class="line">			me.updateExpandIds();</span><br><span class="line">			&#x2F;&#x2F;更新树木，避免显示乱问题</span><br><span class="line">			me.store.reload();</span><br><span class="line">			&#x2F;&#x2F;但是如果更新了，节点展开的就关闭了</span><br><span class="line">		&#125;,</span><br><span class="line">		failure: function()&#123;&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;node.set(&#39;expanded&#39;,false); 除了数据加载阶段可用</span><br><span class="line">&#x2F;&#x2F;其他阶段不可用，应使用expand函数等</span><br><span class="line"></span><br><span class="line">&#x2F;************</span><br><span class="line">	2019&#x2F;4&#x2F;2</span><br><span class="line">	记录展开的id。此方法不是递归的，所以呢，只能处理简一层。</span><br><span class="line">************&#x2F;</span><br><span class="line">updateExpandIds:function()&#123;</span><br><span class="line">	var me&#x3D;this;</span><br><span class="line">	var root &#x3D; me.store.getRoot();</span><br><span class="line">	me.expandIds&#x3D;[];</span><br><span class="line">	Ext.Array.each(root.childNodes,function(node)&#123;</span><br><span class="line">		if(node.data.expanded&#x3D;&#x3D;&#x3D;true)&#123;</span><br><span class="line">			me.expandIds.push(node.data.GroupID);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;在store.load时，更新expand状态</span><br><span class="line">Ext.Array.each(records,function(rd)&#123;</span><br><span class="line">	if(Ext.Array.indexOf(me.expandIds,rd.get(&#39;GroupID&#39;))!&#x3D;&#x3D;-1)&#123;</span><br><span class="line">		rd.set(&#123;expanded:true&#125;);&#x2F;&#x2F;此时可用，因为树还没有重新渲染</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/01/better_coder/2019-04-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="chaofml">
      <meta itemprop="description" content="思绪偶尔会在这里停留">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="超凡魔力">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/04/01/better_coder/2019-04-01/" class="post-title-link" itemprop="url">会议预约，部门展示代码优化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-01 16:17:00" itemprop="dateCreated datePublished" datetime="2019-04-01T16:17:00+08:00">2019-04-01</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-03-17 11:42:22" itemprop="dateModified" datetime="2022-03-17T11:42:22+08:00">2022-03-17</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="会议预约代码改进"><a href="#会议预约代码改进" class="headerlink" title="会议预约代码改进"></a>会议预约代码改进</h1><blockquote>
<p>改进说明:原来的代码，可能想到了点击会正常的触发事件，而点击checkbox时，没有效果。所以呢，想在checkchange进行触发事件，所以只是简单触发了一次itemclick时件。上述代码问题比较多，其一，无论是点击普通的地方还是点击checkbox，其实都是触发了itemclick（理解错了，因为手动设置record的check属性，所以呢，相当于checkOnly）。其二，默认的模式可能是:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;说明，无法通过更改checkOnly来更改属性，</span><br><span class="line">&#x2F;&#x2F;因为这个会导致树前面增加了一个checkbox。</span><br><span class="line">&#x2F;&#x2F;显示效果不满足。</span><br><span class="line">selModel: &#123;</span><br><span class="line">    type: &#39;checkboxmodel&#39;,</span><br><span class="line">    checkOnly: true  &#x2F;&#x2F;只有点击checkbox才会触发改变。</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>只有点击checkbox才会触发改变。导致了点击普通的地方跟点击checkbox的效果不一致，而导致其以为checkbox没有作用，进而继续监听了itemclick事件。其三，就算是没有左右，也不应该手动的触发itemclick事件，而是将itemclick的代码，封装成一个函数，在两个事件中分别调用。而手动触发，会导致事件的循环触发。即A触发了B，而B继而又触发了A。</p>
<p>综上，代码进行了改进。</p>
<h2 id="改进前："><a href="#改进前：" class="headerlink" title="改进前："></a>改进前：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">me.on(&#39;checkchange&#39;,function( node, checked, eOpts)&#123;</span><br><span class="line"></span><br><span class="line">            me.fireEvent(&quot;itemclick&quot;,null,node);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">me.on(&quot;itemclick&quot;,function( store, record, item, index, e, eOpts )&#123;</span><br><span class="line">    record.set(&#39;checked&#39;,record.get(&quot;checked&quot;) &#x3D;&#x3D; false);</span><br><span class="line">    me.SetChecked(record,record.get(&quot;checked&quot;));</span><br><span class="line">    var groupIdList &#x3D; [];</span><br><span class="line">    Ext.each(me.getChecked(),function(checkRd)&#123;</span><br><span class="line">        var GroupID &#x3D; checkRd.get(&quot;department_id&quot;);</span><br><span class="line">        if(undefined !&#x3D; GroupID)&#123;</span><br><span class="line">            groupIdList.push(GroupID);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    ShineMessageHub.fireEvent(&quot;usergridgroupidlistevent&quot;,groupIdList,me);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="改进后："><a href="#改进后：" class="headerlink" title="改进后："></a>改进后：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;下面的代码会造成循环，性能不好，而且存在点击问题。</span><br><span class="line">&#x2F;&#x2F;me.on(&#39;checkchange&#39;,function( node, checked, eOpts)&#123;</span><br><span class="line">&#x2F;&#x2F;          me.fireEvent(&quot;itemclick&quot;,null,node);</span><br><span class="line">&#x2F;&#x2F;        &#125;);</span><br><span class="line"></span><br><span class="line">me.on(&quot;itemclick&quot;,function( store, record, item, index, e, eOpts )&#123;</span><br><span class="line">    &#x2F;&#x2F;增加下面一处判断，这样，无论点击checkbox或者 普通的点击，表现一致</span><br><span class="line">    if(e.target.getAttribute(&#39;role&#39;)!&#x3D;&#x3D;&#39;button&#39;)&#123;</span><br><span class="line">        record.set(&#39;checked&#39;,record.get(&quot;checked&quot;) &#x3D;&#x3D; false);</span><br><span class="line">    &#125;</span><br><span class="line">    me.SetChecked(record,record.get(&quot;checked&quot;));</span><br><span class="line">    var groupIdList &#x3D; [];</span><br><span class="line">    Ext.each(me.getChecked(),function(checkRd)&#123;</span><br><span class="line">        var GroupID &#x3D; checkRd.get(&quot;department_id&quot;);</span><br><span class="line">        if(undefined !&#x3D; GroupID)&#123;</span><br><span class="line">            groupIdList.push(GroupID);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    ShineMessageHub.fireEvent(&quot;usergridgroupidlistevent&quot;,groupIdList,me);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/02/18/vue-learn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="chaofml">
      <meta itemprop="description" content="思绪偶尔会在这里停留">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="超凡魔力">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/02/18/vue-learn/" class="post-title-link" itemprop="url">vue学习笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-02-18 09:41:00" itemprop="dateCreated datePublished" datetime="2019-02-18T09:41:00+08:00">2019-02-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-03-17 11:42:22" itemprop="dateModified" datetime="2022-03-17T11:42:22+08:00">2022-03-17</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="vue-学习笔记"><a href="#vue-学习笔记" class="headerlink" title="vue 学习笔记"></a>vue 学习笔记</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38729043/article/details/81904167">router-link中传值的三种方式</a></p>
<ul>
<li>环境搭建</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018064614?utm_source=tag-newest">vue2+webpack4+scss</a></p>
<h3 id="以下代码中，如果传递参数"><a href="#以下代码中，如果传递参数" class="headerlink" title="以下代码中，如果传递参数"></a>以下代码中，如果传递参数</h3><p>1为对应的学生的id？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;li v-for&#x3D;&quot;student in students&quot; :key&#x3D;&quot;student.id&quot; @click&#x3D;&quot;queryScore(1)&quot;&gt;</span><br><span class="line">    &lt;img src&#x3D;&quot;..&#x2F;..&#x2F;assets&#x2F;1.png&quot; alt&#x3D;&quot;&quot;&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123;student.name&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">&lt;&#x2F;li&gt;</span><br></pre></td></tr></table></figure>

<h3 id="使用图标展示数据"><a href="#使用图标展示数据" class="headerlink" title="使用图标展示数据"></a>使用图标展示数据</h3><p>引入库文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install echarts --save</span><br></pre></td></tr></table></figure>


<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yesyes/p/7161923.html">vuejs中使用echart图表</a><br><a target="_blank" rel="noopener" href="https://echarts.baidu.com/examples/editor.html?c=pie-doughnut">饼形图实例</a></p>
<h3 id="动态组件"><a href="#动态组件" class="headerlink" title="动态组件"></a>动态组件</h3><ul>
<li>简单用法</li>
</ul>
<p>动态组件，使用以下标签进行绑定，其中which_to_show指定绑定的组件的名称。然后在其他处动态的改变这个值，即能达到切换效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;component v-bind:is&#x3D;&quot;which_to_show&quot;&gt;&lt;&#x2F;component&gt;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_37479246/article/details/78915665">动态组件</a></p>
<ul>
<li>动态组件，监听子组件传递的消息</li>
</ul>
<p>跟普通的组件传递消息一致。</p>
<p>父组件监听消息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;component v-bind:is&#x3D;&quot;dayRecordShow&quot; v-on:dayforward&#x3D;&quot;dayRecordShow&#x3D;&#39;DayList&#39;&quot;&gt;&lt;&#x2F;component&gt;</span><br></pre></td></tr></table></figure>
<p>子组件通过按钮，触发消息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;mt-button type&#x3D;&quot;primary&quot; size&#x3D;&quot;large&quot; @click&#x3D;&quot;$emit(&#39;dayforward&#39;)&quot;&gt;查看详情&lt;&#x2F;mt-button&gt;</span><br></pre></td></tr></table></figure>

<h3 id="v-for使用"><a href="#v-for使用" class="headerlink" title="v-for使用"></a>v-for使用</h3><p>v-for动态选择，然后根据选中的id动态设置选择的样式class。实现了动态选择选项的功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;模板</span><br><span class="line">&lt;div class&#x3D;&quot;stuclass&quot;&gt;</span><br><span class="line">	&lt;ul&gt;</span><br><span class="line">	  &lt;li </span><br><span class="line">	    v-for&#x3D;&quot;classInfo in classList&quot; :key&#x3D;&#39;classInfo.cid&#39;</span><br><span class="line">	    :class&#x3D;&quot;classInfo.cid&#x3D;&#x3D;selClass?&#39;active&#39;:&#39;deactive&#39;&quot;</span><br><span class="line">	    @click&#x3D;&quot;selClass&#x3D;classInfo.cid&quot;</span><br><span class="line">	  &gt;</span><br><span class="line">	    &#123;&#123;classInfo.className&#125;&#125;</span><br><span class="line">	  &lt;&#x2F;li&gt;</span><br><span class="line">	&lt;&#x2F;ul&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&#x2F;&#x2F;数据</span><br><span class="line"> data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      selClass:1,</span><br><span class="line">      classList:[</span><br><span class="line">        &#123;cid:1,className:&#39;一班&#39;&#125;,</span><br><span class="line">        &#123;cid:2,className:&#39;二班&#39;&#125;,</span><br><span class="line">        &#123;cid:3,className:&#39;三班&#39;&#125;,</span><br><span class="line">        &#123;cid:4,className:&#39;四班&#39;&#125;,</span><br><span class="line">        &#123;cid:5,className:&#39;五班&#39;&#125;,</span><br><span class="line">        &#123;cid:6,className:&#39;六班&#39;&#125;,</span><br><span class="line">        &#123;cid:7,className:&#39;七班&#39;&#125;</span><br><span class="line">      ],</span><br><span class="line">      chart: null,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="MintUI日期选择控件使用"><a href="#MintUI日期选择控件使用" class="headerlink" title="MintUI日期选择控件使用"></a>MintUI日期选择控件使用</h3><p>参照官方的例子，确实比较简单。简单的使用例子如下datetime-picker</p>
<p>注意，不要将此组件，放到触发的组件容器中，否则，无限弹出。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;引入日期时间选择器。 下面进行全局注册</span><br><span class="line">import &#123; DatetimePicker &#125; from &#39;mint-ui&#39;;</span><br><span class="line">Vue.component(DatetimePicker.name, DatetimePicker);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>


<h3 id="增加字体"><a href="#增加字体" class="headerlink" title="增加字体"></a>增加字体</h3><p>将font-awesome下载后，放到/src/static/font-awesome文件夹下。（css、font两个文件夹，其他的不要。）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;在main.js中直接引用以下样式</span><br><span class="line">import &#39;.&#x2F;static&#x2F;font-awesome&#x2F;css&#x2F;font-awesome.min.css&#39;;</span><br></pre></td></tr></table></figure>
<p>在代码中，即可使用。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;i class&#x3D;&quot;fa fa-angle-left&quot; aria-hidden&#x3D;&quot;true&quot;&gt;&lt;&#x2F;i&gt;</span><br></pre></td></tr></table></figure>

<h3 id="MintUI封装picker的例子"><a href="#MintUI封装picker的例子" class="headerlink" title="MintUI封装picker的例子"></a>MintUI封装picker的例子</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/solocoder/article/details/82796777">Vue + Mint-ui 封装滚轮选择器</a></p>
<h3 id="全局引入第三方库"><a href="#全局引入第三方库" class="headerlink" title="全局引入第三方库"></a>全局引入第三方库</h3><p>在引入underscore的库时候，遇到了这样的一个需求，需要全局引入一个库。但是在main.js中按如下代码方式引入，结果发现并不行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>参考：<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sxz2008/p/8245282.html">Vue 中如何引入第三方 JS 库</a></p>
<h3 id="canvas清空画布的方法"><a href="#canvas清空画布的方法" class="headerlink" title="canvas清空画布的方法"></a>canvas清空画布的方法</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/idomyway/article/details/78513075">canvas清空画布方法</a></p>
<ul>
<li>最简单的方法：由于canvas每当高度或宽度被重设时，画布内容就会被清空，因此可以用以下方法清空</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function clearCanvas()</span><br><span class="line">&#123;  </span><br><span class="line">    var c&#x3D;document.getElementById(&quot;myCanvas&quot;);  </span><br><span class="line">    var cxt&#x3D;c.getContext(&quot;2d&quot;);  </span><br><span class="line">    c.height&#x3D;c.height;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>


<ul>
<li>使用clearRect方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function clearCanvas()  </span><br><span class="line">&#123;  </span><br><span class="line">    var cxt&#x3D;document.getElementById(&quot;myCanvas&quot;).getContext(&quot;2d&quot;);</span><br><span class="line">    cxt.clearRect(0,0,c.width,c.height);  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>


<h3 id="引用mint-ui中的swipe"><a href="#引用mint-ui中的swipe" class="headerlink" title="引用mint-ui中的swipe"></a>引用mint-ui中的swipe</h3><p>引入到文件中，看不到任何效果，查看dom节点，发现有结构。所以，是因为div没有默认的高度，所以呢，设置高度即可显示。如果是图片，则会为img增加widh=100%。</p>
<h3 id="div单行显示"><a href="#div单行显示" class="headerlink" title="div单行显示"></a>div单行显示</h3><p>如果想让div单行显示，其实只要设置行高跟div的高度一致，然后多余的文字使用overflow:hidden即可。</p>
<h3 id="常用的圣杯布局、双飞布局"><a href="#常用的圣杯布局、双飞布局" class="headerlink" title="常用的圣杯布局、双飞布局"></a>常用的圣杯布局、双飞布局</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lyzg/p/5160570.html">圣杯布局小结</a>文章讲解比较详细。而且这个人的博客还是很不错的。</p>
<h3 id="keep-alive属性"><a href="#keep-alive属性" class="headerlink" title="keep-alive属性"></a>keep-alive属性</h3><p>这个属性，用在动态组件上面，这样动态组件不用每次都销毁重建。（下面方式进行监听）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">destroyed()&#123;</span><br><span class="line">    console.log(&#39;我销毁了啦&#39;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>


<h3 id="mint-ui中的切换卡片按钮"><a href="#mint-ui中的切换卡片按钮" class="headerlink" title="mint-ui中的切换卡片按钮"></a>mint-ui中的切换卡片按钮</h3><p>通过观察dom节点，实际上改变的是该节点的可见性。(mint-tab-container-item  display:none)<br>也就是说，所有节点其实都已经渲染上了，但是只是没有显示而已。这个跟keep-alive动态组件还不一样。动态组建，实际上整体已经脱离了文档流，估计状态都还保存在内存中。再次需要的时候，再次放回去。原理不一样。</p>
<blockquote>
<p>为什么说，动态组件，切换时dom节点会脱离文档流？因为使用了定期任务setInterval，在定时任务执行时，切换了，结果找不到了dom节点。<strong>所以，如果有定时任务，延时任务，而且还需要对dom节点操作，请不要这么干</strong>，直接使用v-show好啦。这个东西，就不会啦。2019/2/28</p>
</blockquote>
<h3 id="mint-ui中的Indicator"><a href="#mint-ui中的Indicator" class="headerlink" title="mint-ui中的Indicator"></a>mint-ui中的Indicator</h3><p>其功能其实跟Ext.Msg.Wait的功能很像，作用是，防止用户多次点提交按钮。所以，用法也相似。2019/2/28</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Indicator.open(&#39;审核中...&#39;);</span><br><span class="line">&#x2F;&#x2F;请求成功或者失败，都应该关闭</span><br><span class="line">setTimeout(function()&#123;</span><br><span class="line">        Indicator.close();&#x2F;&#x2F;关闭全局的mask</span><br><span class="line">        me.$router.go(-1);</span><br><span class="line">&#125;,1000);</span><br></pre></td></tr></table></figure>

<h3 id="感悟"><a href="#感悟" class="headerlink" title="感悟"></a>感悟</h3><p>做一件事的方法，有很多种，善于思考，总能找到一种适合的解决办法。</p>
<p>（2019年2月28日）今天做考勤路径跳转，在做之前，已经想过了一种解决方法，就是，如果当前页面是考勤页面，默认的全局返回按钮隐藏起来，然后设置该页面特定的按钮，然后跟该组件能紧密的联合起来，能获取到相关的参数，控制特定的返回过程。</p>
<p>但是，中午看手册，路由地址变化，如果地址不变，只是参数发生了变化，那么，组件不会刷新。正好利用此特性，在原因的路由上面，加了请求参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">    &#39;$route&#39; (to, from) &#123;</span><br><span class="line">        var show &#x3D; this.$route.params.show;</span><br><span class="line">        var dayRds &#x3D; [&#39;DaySummary&#39;, &#39;DayList&#39;, &#39;DayDetail&#39;];</span><br><span class="line">        var monthRds &#x3D; [&#39;MonthSummary&#39;, &#39;MonthList&#39;, &#39;MonthDetail&#39;];</span><br><span class="line">        var index &#x3D; dayRds.indexOf(show);</span><br><span class="line">        if (index &gt; -1) &#123;</span><br><span class="line">            this.selected &#x3D; &#39;dayRecord&#39;;</span><br><span class="line">            this.dayRecordShow &#x3D; dayRds[index];</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        index &#x3D; monthRds.indexOf(show);</span><br><span class="line">        if (index &gt; -1) &#123;</span><br><span class="line">            this.selected &#x3D; &#39;monthRecord&#39;;</span><br><span class="line">            this.monthRecordShow &#x3D; monthRds[index];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="slot"><a href="#slot" class="headerlink" title="slot"></a>slot</h3><ul>
<li>如果引入的组件，含有插槽，在插槽里面的内容，其能享受到该组件的所有域。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;mt-popup</span><br><span class="line">      v-model&#x3D;&quot;popupVisible&quot;</span><br><span class="line">      popup-transition&#x3D;&quot;popup-fade&quot;</span><br><span class="line">&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;photo-container&quot; @click&#x3D;&quot;popupVisible&#x3D;false&quot;&gt;</span><br><span class="line">      这个里面的所有域，跟外面的相同。</span><br><span class="line">        &lt;div class&#x3D;&quot;photo-img&quot;         </span><br><span class="line">          v-for&#x3D;&quot;(photo,index) in photos&quot; </span><br><span class="line">          :key&#x3D;&quot;index&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;img src&#x3D;&quot;..&#x2F;..&#x2F;assets&#x2F;1.png&quot; alt&#x3D;&quot;&quot;&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;mt-popup&gt;</span><br></pre></td></tr></table></figure>

<h3 id="使用sass文件格式"><a href="#使用sass文件格式" class="headerlink" title="使用sass文件格式"></a>使用sass文件格式</h3><p>使用sass语言的时候，由于层层嵌套的原因，如果在浏览器中发现想要的样式，没有列处理，查看拼写是否错误，或者嵌套的错误。无法识别等。</p>
<h3 id="使用overflow清除浮动"><a href="#使用overflow清除浮动" class="headerlink" title="使用overflow清除浮动"></a>使用overflow清除浮动</h3><ul>
<li>div内部有float元素，该div可以使用float来清除浮动。</li>
<li>另外一种方法是，该div增加一个子div，子div style=”clear:both”</li>
</ul>
<h3 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h3><p>遇到一个如下的问题，需要循环photos里面的元素，并根据该元素绑定一个事件，但是如果photos为空的话，那么会报如下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught TypeError: Cannot read property &#39;$emit&#39; of undefined</span><br></pre></td></tr></table></figure>
<p>大概的意思是：为遍历的元素增加了触发事件，结果该遍历的条目为空。然后事件绑定就报错了。暂无解法，只能限制用户不能将photos数组清空。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 点击轮播图，查看图片详情 --&gt;</span><br><span class="line">    &lt;mt-popup</span><br><span class="line">      v-model&#x3D;&quot;popupVisible&quot;</span><br><span class="line">      position&#x3D;&quot;right&quot;</span><br><span class="line">      :modal&#x3D;&quot;false&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;photo-container&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;photo-img&quot;         </span><br><span class="line">          v-for&#x3D;&quot;(photo,index) in photos&quot; </span><br><span class="line">          :key&#x3D;&quot;index&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;tools&quot; @click&#x3D;&quot;deletePic(photo.src)&quot;&gt;</span><br><span class="line">            &lt;i class&#x3D;&quot;iconfont icon-delete&quot;&gt;&lt;&#x2F;i&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">          &lt;img src&#x3D;&quot;..&#x2F;..&#x2F;assets&#x2F;1.png&quot; alt&#x3D;&quot;&quot;&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;btn&quot;&gt;</span><br><span class="line">          &lt;mt-button type&#x3D;&quot;primary&quot; size&#x3D;&quot;large&quot; @click.native&#x3D;&quot;popupVisible&#x3D;false&quot;&gt;确定&lt;&#x2F;mt-button&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;mt-popup&gt;</span><br><span class="line">    &#x2F;&#x2F;删除方法</span><br><span class="line"></span><br><span class="line">    deletePic(src)&#123;</span><br><span class="line">      console.log(&#39;您要删除图片&#39;+src);</span><br><span class="line">      var index&#x3D;-1;</span><br><span class="line">      var ps&#x3D;this.photos;</span><br><span class="line">      &#x2F;&#x2F;查找到对应删除的条目</span><br><span class="line">      for(var i&#x3D;0;i&lt;ps.length;i++)&#123;</span><br><span class="line">        if(src&#x3D;&#x3D;&#x3D;ps[i].src)&#123;</span><br><span class="line">          index&#x3D;i;</span><br><span class="line">          break;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      if(index&gt;-1)&#123;&#x2F;&#x2F;找到</span><br><span class="line">        this.photos.splice(index,1);</span><br><span class="line">        &#x2F;&#x2F;发送请求，将图片从服务器上删除。</span><br><span class="line">        &#x2F;&#x2F;todo</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>另外，发现Mint UI中Toast的z-index更小。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Toast(&#39;必须要保留一张图片。&#39;);</span><br></pre></td></tr></table></figure>
<p>临时解决办法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;条件判断，要不要显示</span><br><span class="line">&lt;div class&#x3D;&quot;tools&quot; @click&#x3D;&quot;deletePic(photo.src)&quot; v-if&#x3D;&quot;photos.length&gt;1&quot;&gt;</span><br><span class="line">            &lt;i class&#x3D;&quot;iconfont icon-delete&quot;&gt;&lt;&#x2F;i&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="vue中使用手势库问题"><a href="#vue中使用手势库问题" class="headerlink" title="vue中使用手势库问题"></a>vue中使用手势库问题</h3><p>可用的库  vue-touch 还有touchjs。反正这个库不是很好用。<br>对于前一种库，使用如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;默认的生成div标签，但是问题是，滑动，swiperight，标签多了一个touch-action: none;样式，</span><br><span class="line">&#x2F;&#x2F;该样式阻止了正常上下的滑动。</span><br><span class="line">&#x2F;&#x2F;style&#x3D;&quot;touch-action: pan-y!important;&quot; 该样式能恢复，但是非常麻烦。</span><br><span class="line">&lt;v-touch v-on:swiperight&#x3D;&quot;sright&quot;&gt;&lt;&#x2F;v-touch&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="vue中引入图片"><a href="#vue中引入图片" class="headerlink" title="vue中引入图片"></a>vue中引入图片</h3><p>如果直接在html代码中引入代码，框架打包的时候，会自动的处理图片的连接。但是如果在代码中，引入的话，需要自己来控制。核心代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">require(&quot;..&#x2F;assets&#x2F;test.png&quot;);</span><br></pre></td></tr></table></figure>
<p>应用举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;1、首先给图片地址绑定变量</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;img :src&#x3D;&quot;imgUrl&quot;&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;2、在script中设置变量</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    &#x2F;&#x2F;方法1.直接将图片引入为模块</span><br><span class="line">    require imgUrl from &quot;..&#x2F;assets&#x2F;test.png&quot;</span><br><span class="line">    &#x2F;&#x2F;方法2.将imgUrl放在数据里</span><br><span class="line">    data()&#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            imgUrl:require(&quot;..&#x2F;assets&#x2F;test.png&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="页面跳转“保活”功能"><a href="#页面跳转“保活”功能" class="headerlink" title="页面跳转“保活”功能"></a>页面跳转“保活”功能</h3><p>有的时候，页面跳转，返回回来时，页面要求还是上次已加载的样式。我个人称其为“保活”。在Ext中，如果采用card布局，很容易就实现了“保活”。在Vue里面，根据情况，分为三种：</p>
<ul>
<li>if判断:如果页面路由没有发生跳转，此页面就能实现报活。（主要利用v-if或者v-show动态的显示不同的页面）</li>
<li>参数：如果页面跳转了，但是只是路由的参数发生了变化，根据Vue官方路由中的介绍，页面不会发生重新渲染。</li>
<li>子路由：做一个空的组件，做容器。路由出口，让其保活。</li>
<li>动态组件。暂未思考。<br>子路由应用具体的如下：<br>父容器：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 父容器，让其保活，keep-alive --&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;scorehome&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;keep-alive&gt;</span><br><span class="line">      &lt;router-view&gt;&lt;&#x2F;router-view&gt;</span><br><span class="line">    &lt;&#x2F;keep-alive&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;ScoreHome&quot;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>子路由设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    path: &#39;&#x2F;score&#x2F;&#39;,</span><br><span class="line">    name: &#39;ScoreHome&#39;,</span><br><span class="line">    meta: &#123; title: &#39;成绩查询&#39; &#125;,</span><br><span class="line">    component: resolve &#x3D;&gt; require([&#39;..&#x2F;components&#x2F;score&#x2F;ScoreHome&#39;], resolve),</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: &#39;index&#39;,</span><br><span class="line">        name: &#39;Score&#39;,</span><br><span class="line">        meta: &#123; title: &#39;成绩查询&#39; &#125;,</span><br><span class="line">        component: resolve &#x3D;&gt; require([&#39;..&#x2F;components&#x2F;score&#x2F;Score&#39;], resolve),&#x2F;&#x2F;懒加载</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: &#39;queryscore&#39;,</span><br><span class="line">        name: &#39;QueryScore&#39;,</span><br><span class="line">        meta: &#123; title: &#39;成绩查询&#39; &#125;,</span><br><span class="line">        component: resolve &#x3D;&gt; require([&#39;..&#x2F;components&#x2F;score&#x2F;QueryScore&#39;], resolve),&#x2F;&#x2F;懒加载</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>这样即实现了保活功能。</p>
<p>但是，现实需求是复杂的，页面从1→2→3或者3→2→1这样方向传递。其中2需要保活，3不需要保活。怎么做呢？</p>
<p>根据上面的三种方式，后两种方式差不多。每次进入3的时候，让其主动刷新呢？那么就需要导航守位或者监控导航的变化。或者还可以利用消息传递机制。强制让一个组件重新刷新，这个？</p>
<h4 id="临时解决办法"><a href="#临时解决办法" class="headerlink" title="临时解决办法"></a>临时解决办法</h4><p>临时监控路由变化。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">watch:&#123;</span><br><span class="line">  $route(to,from)&#123;</span><br><span class="line">    var me &#x3D; this;</span><br><span class="line">    &#x2F;&#x2F;如果判断是当前路由，则进行初始化，并重新加载数据。</span><br><span class="line">    &#x2F;&#x2F;注意，这个方法，首次并不会执行，只有再次过来才会执行。</span><br><span class="line">    if(to.path&#x3D;&#x3D;&quot;&#x2F;score&#x2F;queryscore&quot;)&#123;</span><br><span class="line">      this.user_name&#x3D; null;</span><br><span class="line">      this.exam_name&#x3D;null; &#x2F;&#x2F;考试名称</span><br><span class="line">      this.exam_type&#x3D; null; &#x2F;&#x2F;考试类型</span><br><span class="line">      me.studentObj &#x3D; to.query.studentObj;</span><br><span class="line">      me.parseExam();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="导航守位"><a href="#导航守位" class="headerlink" title="导航守位"></a>导航守位</h3><p>beforeRouteEnter这个函数里面好像访问不到this，这个函数里面必须要调用next()，否则加载不到页面。它比watch里面监控到的$route变化发生更早。</p>
<h3 id="关于未修改，不提示直接返回"><a href="#关于未修改，不提示直接返回" class="headerlink" title="关于未修改，不提示直接返回"></a>关于未修改，不提示直接返回</h3><p>这个是Ext后台的功能，用户希望，没有修改时，可以直接返回，不要进行提醒。思路，监控用户有无输入比较麻烦。则判断，用户点击组件的次数，如果只点了一次（这一次是发生在点返回按钮时），那么认为没有做任何修改。弊端，有可能用户用键盘发生了变化，这个就不考虑了。核心代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;增加点击时，</span><br><span class="line">listeners:&#123;</span><br><span class="line">        &#39;afterrender&#39;:function(cmp, eOpts)&#123;</span><br><span class="line">            var me&#x3D;this;</span><br><span class="line">            me.el.dom.onclick&#x3D;function()&#123;</span><br><span class="line">                me.bodyCount++;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#39;destroy &#39;:function(cmp, eOpts)&#123;</span><br><span class="line">            this.el.dom.onclick&#x3D;null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#x2F;&#x2F;在每次添加、修改时，重新初始化一次。因为这个组件是不死的。</span><br><span class="line">ShineMessageHub.on(&quot;roomlistgridpaneladdevent&quot;,function(rd)&#123;</span><br><span class="line">            me.bodyCount&#x3D;0;</span><br><span class="line">&#x2F;&#x2F;在返回时，判断次数，&lt;&#x3D;1则进行默认处理。</span><br></pre></td></tr></table></figure>

<h3 id="serviceworker"><a href="#serviceworker" class="headerlink" title="serviceworker"></a>serviceworker</h3><p>第一次听说这个概念</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;通过一下方式，进行控制。</span><br><span class="line">chrome:&#x2F;&#x2F;serviceworker-internals&#x2F;</span><br></pre></td></tr></table></figure>

<h3 id="手机端禁止缩放"><a href="#手机端禁止缩放" class="headerlink" title="手机端禁止缩放"></a>手机端禁止缩放</h3><p>代码如下，但是对于浏览器好像，并没有强制，但是对于微信，好像支持。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width,initial-scale&#x3D;1.0,maximum-scale&#x3D;1,user-scalable&#x3D;no&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>网上找来的解释：</p>
<blockquote>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
该meta标签的作用是让当前viewport的宽度等于设备的宽度，同时不允许用户手动缩放。
其中 maximum-scale为允许用户的最大缩放值，user-scalable为是否允许用户进行缩放，yes(默认)代表允许，no(0)代表不允许，两者结合使用可以阻止页面被放大（经测试，少一项都达不到效果）
</blockquote>
<h3 id="vue中引入包的先后顺序"><a href="#vue中引入包的先后顺序" class="headerlink" title="vue中引入包的先后顺序"></a>vue中引入包的先后顺序</h3><p>代码如下，错误的解释如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#39;vue&#39;</span><br><span class="line">&#x2F;&#x2F;注意，这个App包先引入，所以无法使用后面引入的东西。</span><br><span class="line">import App from &#39;.&#x2F;App&#39;</span><br><span class="line">import router from &#39;.&#x2F;router&#x2F;index&#39;</span><br><span class="line">import Mint from &#39;mint-ui&#39;;</span><br><span class="line">import &#39;mint-ui&#x2F;lib&#x2F;style.css&#39;</span><br><span class="line">import &#123; Header &#125; from &#39;mint-ui&#39;;</span><br><span class="line">import &#123; TabContainer, TabContainerItem &#125; from &#39;mint-ui&#39;;</span><br><span class="line">import &#123; Navbar, TabItem &#125; from &#39;mint-ui&#39;;</span><br><span class="line">import axios from &quot;axios&quot;</span><br><span class="line">import GlobalTools from &#39;.&#x2F;components&#x2F;GlobalTools.js&#39;&#x2F;&#x2F;引用模块进来</span><br><span class="line">&#x2F;&#x2F;像下面的这个MessageBox就无法在App中直接使用。因为顺序问题。</span><br><span class="line">import &#123; MessageBox &#125; from &#39;mint-ui&#39;;</span><br><span class="line">import &#123; InfiniteScroll &#125; from &#39;mint-ui&#39;;</span><br><span class="line">import &#123; Loadmore &#125; from &#39;mint-ui&#39;;</span><br><span class="line">import &#123; Actionsheet &#125; from &#39;mint-ui&#39;;</span><br></pre></td></tr></table></figure>

<p>重要的原因是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import Mint from &#39;mint-ui&#39;;</span><br><span class="line">&#x2F;&#x2F;在注册到Vue中，每个实例都多了$indicator、$messagebox、$toast方法。</span><br><span class="line">Vue.use(Mint);</span><br></pre></td></tr></table></figure>

<h3 id="监控返回事件"><a href="#监控返回事件" class="headerlink" title="监控返回事件"></a>监控返回事件</h3><p>本来想做的功能是，监控返回时，判断，如果要退出了，则提示是否要退出。结果，下面的这个功能死活不起作用。（估计在调试模式下，websocket会返回的加载更改的代码）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">window.addEventListener(&#39;popstate&#39;,function()&#123;</span><br><span class="line">      console.log(&#39;监控退出事件&#39;);</span><br><span class="line">      var notShowBackList&#x3D;[&#39;&#x2F;&#39;,&#39;&#x2F;HomePanel&#x2F;&#39;,&#39;&#x2F;MySelfPanel&#x2F;&#39;,&#39;&#x2F;SettingPanel&#x2F;&#39;];</span><br><span class="line">      var find&#x3D;notShowBackList.indexOf(me.$router.history.current.path);</span><br><span class="line">      if(find&gt;-1)&#123;</span><br><span class="line">        MessageBox.confirm(&#39;确定要退出吗?&#39;).then(action &#x3D;&gt; &#123;</span><br><span class="line">        &#125;).catch(action&#x3D;&gt;&#123;</span><br><span class="line">          window.history.pushState(&#39;forward&#39;, null, &#39;#&#x2F;&#39;);</span><br><span class="line">          window.history.forward(1);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,false);</span><br></pre></td></tr></table></figure>


<h3 id="格式化时间代码优化"><a href="#格式化时间代码优化" class="headerlink" title="格式化时间代码优化"></a>格式化时间代码优化</h3><p>以前使用Ext的库函数惯了，后来自己使用vue框架的时候，很多库都没有了。然后自己写了格式化时间代码。又经再次优化，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;************</span><br><span class="line"> * 2019年2月22日</span><br><span class="line"> * a 时间   sep 分隔符，格式化输出时间</span><br><span class="line"> ************&#x2F;</span><br><span class="line">formatDate(date, sep) &#123;</span><br><span class="line">    if (!date) &#123;</span><br><span class="line">        return &#39;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;改进的代码</span><br><span class="line">    return date.toISOString()</span><br><span class="line">        .replace(&#x2F;T&#x2F;, &#39; &#39;) &#x2F;&#x2F; replace T with a space</span><br><span class="line">	.replace(&#x2F;\..+&#x2F;, &#39;&#39;)</span><br><span class="line">        .slice(0, -3);</span><br><span class="line">    &#x2F;&#x2F;之前的代码</span><br><span class="line">    return (</span><br><span class="line">        date.getFullYear() +</span><br><span class="line">        &quot;-&quot; +</span><br><span class="line">        (date.getMonth() &gt; 8 ? &quot;&quot; : &quot;0&quot;) +</span><br><span class="line">        (date.getMonth() + 1) +</span><br><span class="line">        &quot;-&quot; +</span><br><span class="line">        (date.getDate() &gt; 9 ? &quot;&quot; : &quot;0&quot;) +</span><br><span class="line">        date.getDate() +</span><br><span class="line">        &quot; &quot; +</span><br><span class="line">        (date.getHours() &gt; 9 ? &quot;&quot; : &quot;0&quot;) +</span><br><span class="line">        date.getHours() +</span><br><span class="line">        &#39;:&#39; +</span><br><span class="line">        (date.getMinutes() &gt; 9 ? &quot;&quot; : &quot;0&quot;) +</span><br><span class="line">        date.getMinutes());</span><br></pre></td></tr></table></figure>

<p>然后最终优化为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;************</span><br><span class="line">* 2019年2月22日</span><br><span class="line">* date时间对象 ，格式化输出时间</span><br><span class="line">************&#x2F;</span><br><span class="line">    &#x2F;&#x2F;date.toISOString如果没有这个方法，那么认为不是时间格式。返回为空字符串。</span><br><span class="line">    &#x2F;&#x2F;比上面的异常判断更好。</span><br><span class="line">    formatDate(date) &#123;</span><br><span class="line">      return date&amp;&amp;date.toISOString?date.toISOString()</span><br><span class="line">              .replace(&#x2F;T&#x2F;, &#39; &#39;)      &#x2F;&#x2F; replace T with a space</span><br><span class="line">              .replace(&#x2F;\..+&#x2F;, &#39;&#39;)</span><br><span class="line">              .slice(0,-3):&#39;&#39;;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>然后发现，时区还不对，格始化的时间小了8小时。然后，又再次优化为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">formatDate(date) &#123;</span><br><span class="line">&#x2F;&#x2F;运用了括号表达式，（1，2）返回最后一个值的值，1表达式，主要功能，纠正时间8小时误差。</span><br><span class="line">      return date&amp;&amp;date.toISOString?(date&#x3D;new Date(date.getTime()-date.getTimezoneOffset()*60*1000),date.toISOString()</span><br><span class="line">              .replace(&#x2F;T&#x2F;, &#39; &#39;)      &#x2F;&#x2F; replace T with a space</span><br><span class="line">              .replace(&#x2F;\..+&#x2F;, &#39;&#39;)</span><br><span class="line">              .slice(0,-3)):&#39;&#39;;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>上面运用到了一个知识，Date本身是对象，所以呢，其是按址传递的。但是，date=new Date 其实相当于又拷贝了一个新对象。跟原对象已经没有关系了。所以呢，new之后，跟调用处的date,formatDate(date) ,已经脱离关系了。<br>至于如何验证Date传址，下面是个例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a&#x3D; new Date();</span><br><span class="line">console.log(a);</span><br><span class="line">b&#x3D;a;</span><br><span class="line">b.setFullYear(2018);</span><br><span class="line">console.log(a);</span><br></pre></td></tr></table></figure>

<h3 id="伪元素after之content"><a href="#伪元素after之content" class="headerlink" title="伪元素after之content"></a>伪元素after之content</h3><p>本来的想法是，after里面放“<i>内容</i>”之内的html，结果发现不行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.selected::after &#123;</span><br><span class="line">      content: &quot;\e63e&quot;;</span><br><span class="line">      position: absolute;&#x2F;&#x2F;能使用绝对定位</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用参数传递状态值"><a href="#使用参数传递状态值" class="headerlink" title="使用参数传递状态值"></a>使用参数传递状态值</h3><p>之前，从上个页面跳到页面来，上个页面直接将查询处理后结果传递过来，这样做，确实比较省事，但是问题：页面刷新，上个页面传递的数据就不存在了。</p>
<blockquote>
<p>变通：将其作为参数params来传递，传递一个资源值。是不是更好一点？</p>
</blockquote>
<h3 id="vue中使用过滤器"><a href="#vue中使用过滤器" class="headerlink" title="vue中使用过滤器"></a>vue中使用过滤器</h3><p>使用过滤器，对要展示的数据进行转换，这是另外一个地方，可以对数据进行转换。扩展：</p>
<ul>
<li>后端处理。Mysql的时候处理。</li>
<li>后端处理。php语言处理。</li>
<li>数据加载后，处理。Ajax后，立马组织数据。</li>
<li>计算属性，跟Ext中Store的convert属性作用差不多。</li>
<li>filter处理。这个跟Ext中renderer函数有点像，这个不会更改原数据。</li>
</ul>
<h2 id="vuex使用"><a href="#vuex使用" class="headerlink" title="vuex使用"></a>vuex使用</h2><p>vuex的出现，主要解决的问题是，多组件之间的通信问题。在未引入vuex之前，组件的通信：父组件→子组件，通过props向子组件传递，而子组件→父组件就必须通过事件触发$emit的方式进行传递。如果兄弟组件通信，需要利用父组件进行中转，如果是更复杂的组件之间通信，方式非常麻烦。为了解决这个问题，引入了store的概念。官方手册中，讲解了可以定义一个共享的store，然后其他的组件，直接使用store的state属性来初始化变量，直接更改state并共享，这种方式，非常不利于排查问题。所以建议，所有更改必须通过一个方法来触发，这样可以跟踪变量。</p>
<p>vuex中共有五个概念：</p>
<ul>
<li>State：共享的数据。这个是所有需要通信的组件，共享此属性内的组件。（js对象变量传址方式传递值。但是，不要直接操纵变量来更改）</li>
<li>Getter:提供数据转换的方法。（类似Ext中store的fields的convert方法），共享此方法，过滤、转换等作用。</li>
<li>Mutaction方法。（突变）。主要用来更改状态。（不能使用延时的操作）。2019/3/11</li>
<li>Action。跟Mutaction最大的区别，允许有一步操作，操作结束并不直接更改State中的数据，而是commit去调用Mutaction更改变化，返回的是Promise。</li>
<li>Module。模块，用来组织多个组件共享的方式。分模块。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/01/22/2019-01-22_code_better/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="chaofml">
      <meta itemprop="description" content="思绪偶尔会在这里停留">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="超凡魔力">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/01/22/2019-01-22_code_better/" class="post-title-link" itemprop="url">会议预约代码改进</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-01-22 17:36:00" itemprop="dateCreated datePublished" datetime="2019-01-22T17:36:00+08:00">2019-01-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-12-21 16:54:58" itemprop="dateModified" datetime="2020-12-21T16:54:58+08:00">2020-12-21</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="会议预约代码改进"><a href="#会议预约代码改进" class="headerlink" title="会议预约代码改进"></a>会议预约代码改进</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>写程序的时候，要知道代码的前提条件是什么。比如，开根号，就应该想到，我可能用到的数可能为负数。所以，需要先验证。（至于验证在哪进行，是开根号函数定义还是调用，视情况而定。）所以这些，才能保证程序的健壮性。</p>
</blockquote>
<h2 id="常用策略"><a href="#常用策略" class="headerlink" title="常用策略"></a>常用策略</h2><h3 id="使用变量替代复杂的表达式"><a href="#使用变量替代复杂的表达式" class="headerlink" title="使用变量替代复杂的表达式"></a>使用变量替代复杂的表达式</h3><blockquote>
<p>一个表达式、多个逻辑值求值或函数调用等反复引用，应该起一个有一定含义的名字，作为一个变量来使用。这样能简化代码。如检查是否是特权用户。使用super变量，真：特权。假：非特权。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$super&#x3D;in_array($user-&gt;role_id,array(1,3));</span><br></pre></td></tr></table></figure>

<h3 id="相关的变量或者逻辑应该抽象成对象，封装在一起。"><a href="#相关的变量或者逻辑应该抽象成对象，封装在一起。" class="headerlink" title="相关的变量或者逻辑应该抽象成对象，封装在一起。"></a>相关的变量或者逻辑应该抽象成对象，封装在一起。</h3><blockquote>
<p>如初始化的变量</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;下面整体应该保存到一个变量，就不用这么麻烦。</span><br><span class="line">&#x2F;&#x2F;var origin&#x3D; rdData;&#x2F;&#x2F;只要这一句就ok。</span><br><span class="line">me.originalMeetingdate&#x3D;me.meetingdate &#x3D; rdData[&#39;meeting_date&#39;];&#x2F;&#x2F;保存初始值</span><br><span class="line">me.originalStarttime&#x3D;me.starttime &#x3D; rdData[&#39;starttime&#39;];    &#x2F;&#x2F;保存初始值</span><br><span class="line">me.originalStoptime&#x3D;me.stoptime &#x3D; rdData[&#39;stoptime&#39;];       &#x2F;&#x2F;保存初始值</span><br></pre></td></tr></table></figure>

<h2 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a>代码展示</h2><h3 id="时间显示"><a href="#时间显示" class="headerlink" title="时间显示"></a>时间显示</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x2F;&#x2F;第二块</span><br><span class="line">    xtype:&#39;menublockpanel&#39;,&#x2F;&#x2F;仅显示</span><br><span class="line">    items:[&#123;</span><br><span class="line">	xtype:&#39;selecttextfield&#39;,</span><br><span class="line">	bind:&#123;</span><br><span class="line">	    &#x2F;&#x2F; value:&quot;&#123;meeting_date&#125;　　&#123;starttime&#125;-&#123;stoptime&#125;&quot; &#x2F;&#x2F;注意这种方式，如果三个字段为空的话，那么还是会有内容，空格+&#39;-&#39;号</span><br><span class="line">	    &#x2F;&#x2F;而下面是一种改进，如果meeting_date没有内容，直接显示的就为空的内容。这样就能显示emptyText:&#39;请选择会议召开时间。&#39;,</span><br><span class="line">	    &#x2F;&#x2F;另外需关注：字符串能运算。当然下面的代码也能放到viewModel中，能使用公式来计算。但是没有此方法简单。</span><br><span class="line">	    value:&#39;&#123;meeting_date?meeting_date+&quot;　　&quot;+starttime+&quot;-&quot;+stoptime:&quot;&quot;&#125;&#39;</span><br><span class="line">	&#125;,</span><br><span class="line">	submitValue:false,</span><br><span class="line">	fieldLabel:Ext.String.format(DIC.labelString,5,&#39;时间&#39;),</span><br><span class="line">	emptyText:&#39;请选择会议召开时间。&#39;,</span><br><span class="line">	setItemIndex:4,</span><br><span class="line">	needRoom:true</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="增加输入变化时，change事件的响应。"><a href="#增加输入变化时，change事件的响应。" class="headerlink" title="增加输入变化时，change事件的响应。"></a>增加输入变化时，change事件的响应。</h3><blockquote>
<p>在MenuBlockPanel中，集中的为子items设置默认的change属性。先判断setItemIndex是否为1，即先判断是否需要输入提醒。如果确定有，则进行相应的正确、错误提醒。这个在后期还能优化，如正则验证后，相应的提示。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">listeners:&#123;</span><br><span class="line">    &#39;focus&#39;:function(cmp, event, eOpts)&#123;</span><br><span class="line">	var meetingordermenu&#x3D;cmp.up(&#39;meetingordermenu&#39;);</span><br><span class="line">	ShineMessageHub.fireEvent(&#39;meetingordermenuinputfocus&#39;,cmp,meetingordermenu,event, eOpts);</span><br><span class="line">    &#125;,</span><br><span class="line">    &#39;change&#39;:function(cmp, newValue, oldValue, eOpts )&#123;</span><br><span class="line">	if(cmp.setItemIndex!&#x3D;&#x3D;1)&#123;</span><br><span class="line">	    return ;</span><br><span class="line">	&#125;</span><br><span class="line">	var o;</span><br><span class="line">	if(newValue)&#123;</span><br><span class="line">	    o&#x3D;&#123;icon:&#39;pass&#39;&#125;;</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">	    o&#x3D;&#123;icon:&#39;warning&#39;&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">	ShineMessageHub.fireEvent(&#39;meetingordersettingcontainersetviewmodelevent&#39;,o);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="表单提交前的数据验证"><a href="#表单提交前的数据验证" class="headerlink" title="表单提交前的数据验证"></a>表单提交前的数据验证</h3><blockquote>
<p>先进行空的判断，然后再进行valid的正则验证等。如果输入错误，则进行提示相应的内容。</p>
</blockquote>
<h3 id="话说，不死布局真得不好用。"><a href="#话说，不死布局真得不好用。" class="headerlink" title="话说，不死布局真得不好用。"></a>话说，不死布局真得不好用。</h3><blockquote>
<p>不死布局，真的不好用，上一次操作的记录，如果不能完全清空。对下一次的操作影响真得很大。为了这个缺点，每次都要进行初始化工作。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;添加会议时，设置默认项</span><br><span class="line">ShineMessageHub.on(&quot;meetingorderhomeaddevent&quot;,function(rdData)&#123;</span><br><span class="line">    me.meetingdate &#x3D; rdData[&#39;meeting_date&#39;];</span><br><span class="line">    me.starttime &#x3D; rdData[&#39;starttime&#39;];</span><br><span class="line">    me.stoptime &#x3D; rdData[&#39;stoptime&#39;];</span><br><span class="line">    me.conference_room_id &#x3D; rdData[&#39;conference_room_id&#39;];</span><br><span class="line">    me.meeting_id &#x3D; rdData[&#39;meeting_id&#39;];</span><br><span class="line">    me.displayStart&#x3D;Ext.Date.format(new Date(),&#39;Y-m-d&#39;);</span><br><span class="line">    me.ajaxGetOccupy();</span><br><span class="line">    me.idx&#x3D;-1;&#x2F;&#x2F;这个记录了上一次操作的点。结果这个东西，没有重置。</span><br><span class="line">&#125;,me);</span><br></pre></td></tr></table></figure>
<h3 id="超级用户等，可以更改正在进行中的会议"><a href="#超级用户等，可以更改正在进行中的会议" class="headerlink" title="超级用户等，可以更改正在进行中的会议"></a>超级用户等，可以更改正在进行中的会议</h3><blockquote>
<p>更新需求。超级用户可以修改正在进行中的会议，可以修改任何内容。由于之前，创建的时候，时间如果过期了，就不可选。现在还要可选。像这样的需求，首先要明白，这相当于开了一个口子。这个口子开多大，要根据实际情况定。</p>
</blockquote>
<blockquote>
<p>如本例中，肯定要修改，会议当天的时间，而且如果换了会议室，这个口子就不要看了。所以还需要保存，会议室的id。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#39;storeloaddata&#39;:function(dataview,store)&#123;</span><br><span class="line">    var me&#x3D;this;</span><br><span class="line">    console.log(me.starttime);</span><br><span class="line">    var indexs&#x3D;[me.getTimeListIndex(me.starttime),me.getTimeListIndex(me.stoptime)-1];</span><br><span class="line">    var oindexs&#x3D;[me.getTimeListIndex(me.originalStarttime),me.getTimeListIndex(me.originalStoptime)-1];</span><br><span class="line">    store.each(function(rd)&#123;</span><br><span class="line">	&#x2F;&#x2F;编辑会议时，之前的时间可编辑</span><br><span class="line">	&#x2F;&#x2F;if(me.originalMeetingdate&amp;&amp;rd.get(&#39;meetingdate&#39;)&#x3D;&#x3D;me.originalMeetingdate)&#123;</span><br><span class="line">	&#x2F;&#x2F;注意，下面的条件进行了增强，要求是修改前的会议室id，才允许此特例。</span><br><span class="line">	if(me.originalMeetingdate&amp;&amp;me.originalRoomId&#x3D;&#x3D;me.conference_room_id&amp;&amp;rd.get(&#39;meetingdate&#39;)&#x3D;&#x3D;me.originalMeetingdate)&#123;</span><br><span class="line">	    var lis&#x3D;rd.get(&#39;timelist&#39;);</span><br><span class="line">	    for(var i&#x3D;oindexs[0];i&lt;&#x3D;oindexs[1];i++)&#123;</span><br><span class="line">		if(lis[i].status&#x3D;&#x3D;1)&#123;</span><br><span class="line">		    lis[i].status&#x3D;0;</span><br><span class="line">		&#125;</span><br><span class="line">	    &#125;</span><br><span class="line">	    rd.set(&#123;timelist:lis&#125;);</span><br><span class="line">	    rd.commit();</span><br><span class="line">	&#125;</span><br><span class="line">	&#x2F;&#x2F;上面的代码，相当于开了一个口子。在会议修改时，有originalMeetingdate，</span><br><span class="line">	&#x2F;&#x2F;然后针对这一天，如果时间过期了，强制更新为状态0，即时间可用。而且这个应该还跟会议室相关。</span><br><span class="line">	&#x2F;&#x2F;如果更换了会议室，上面的代码应该不执行的。</span><br><span class="line">	</span><br><span class="line">	if(rd.get(&#39;meetingdate&#39;)&#x3D;&#x3D;me.meetingdate)&#123;</span><br><span class="line">	    var lis&#x3D;rd.get(&#39;timelist&#39;);</span><br><span class="line">	    for(var i&#x3D;indexs[0];i&lt;&#x3D;indexs[1];i++)&#123;</span><br><span class="line">		if(lis[i].status!&#x3D;0)&#123;</span><br><span class="line">		    Ext.toast(&#39;当前选择时间段不可用，请重新选择。&#39;);</span><br><span class="line">		    return ;</span><br><span class="line">		&#125;</span><br><span class="line">	    &#125;</span><br><span class="line">	    me.setSelectStyle(rd,indexs);</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要将会议的初始的originalMeetingdate、originalRoomId等信息保存起来。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> &#x2F;&#x2F;添加会议时，设置默认项</span><br><span class="line">ShineMessageHub.on(&quot;meetingorderhomeaddevent&quot;,function(rdData)&#123;</span><br><span class="line">    me.originalMeetingdate&#x3D;me.meetingdate &#x3D; rdData[&#39;meeting_date&#39;];&#x2F;&#x2F;保存初始值</span><br><span class="line">    me.originalStarttime&#x3D;me.starttime &#x3D; rdData[&#39;starttime&#39;];    &#x2F;&#x2F;保存初始值</span><br><span class="line">    me.originalStoptime&#x3D;me.stoptime &#x3D; rdData[&#39;stoptime&#39;];       &#x2F;&#x2F;保存初始值</span><br><span class="line">    me.originalRoomId&#x3D;me.conference_room_id &#x3D; rdData[&#39;conference_room_id&#39;];   &#x2F;&#x2F;保存初始值</span><br><span class="line">    me.meeting_id &#x3D; rdData[&#39;meeting_id&#39;];</span><br><span class="line">    me.displayStart&#x3D;Ext.Date.format(new Date(),&#39;Y-m-d&#39;);</span><br><span class="line">    me.ajaxGetOccupy();</span><br><span class="line">    me.idx&#x3D;-1;</span><br><span class="line">&#125;,me);</span><br></pre></td></tr></table></figure>

<h3 id="现在时间，增加会议详情"><a href="#现在时间，增加会议详情" class="headerlink" title="现在时间，增加会议详情"></a>现在时间，增加会议详情</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;info.desc变量比较简单，没有空格分隔，</span><br><span class="line">&#x2F;&#x2F;其实不加引号也没有问题。但是如果有空格等，就多了引号，显示就不正常了。</span><br><span class="line"> title&#x3D;&quot;&#123;info.desc&#125;&quot;</span><br><span class="line"> &#x2F;&#x2F;简单形式,要求变量没有空格等。则显示也没有问题。  title&#x3D;&#123;info.desc&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>完整的模板代码，如下</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">tpl:[</span><br><span class="line">    &#39;&lt;div class&#x3D;&quot;selecttimepanel-right-box&quot;&gt;&#39;,</span><br><span class="line">	&#39;&lt;div class&#x3D;&quot;arrow left-arrow&quot;&gt;&lt;&#x2F;div&gt;&#39;,</span><br><span class="line">	&#39;&lt;tpl for&#x3D;&quot;.&quot;&gt;&#39;,</span><br><span class="line">	&#39;&lt;div class&#x3D;&quot;selecttimepanelchoseitemCls&quot;&gt;&lt;table&gt;&#39;,</span><br><span class="line">	    &#39;&lt;tr&gt;&lt;th&gt;&#123;displaydate&#125;&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&#39;,</span><br><span class="line">	    &#39;&lt;tpl for&#x3D;&quot;timelist&quot;&gt;&#39;,</span><br><span class="line">	    &#39;&lt;tr&gt;&#39;,</span><br><span class="line">		&#39;&lt;td dataref&#x3D;&#123;index&#125; &#123;[values.selected?&quot;class&#x3D;selecttimepanel-selected&quot;:&quot;&quot;]&#125; &#123;[values.status&#x3D;&#x3D;1?&quot;class&#x3D;selecttimepanel-expired&quot;:&quot;&quot;]&#125; &#123;[values.status&#x3D;&#x3D;2?&quot;class&#x3D;selecttimepanel-occupy&quot;:&quot;&quot;]&#125; title&#x3D;&quot;&#123;info.desc&#125;&quot;&gt;&#39;,</span><br><span class="line">		    &#39;&#123;info.employee_name&#125;&#39;,</span><br><span class="line">		&#39;&lt;&#x2F;td&gt;&#39;,</span><br><span class="line">	    &#39;&lt;&#x2F;tr&gt;&#39;,</span><br><span class="line">	    &#39;&lt;&#x2F;tpl&gt;&#39;,</span><br><span class="line">	&#39;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;&#39;,</span><br><span class="line">	&#39;&lt;&#x2F;tpl&gt;&#39;,</span><br><span class="line">	&#39;&lt;div class&#x3D;&quot;arrow right-arrow&quot;&gt;&lt;&#x2F;div&gt;&#39;,</span><br><span class="line">    &#39;&lt;&#x2F;div&gt;&#39;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在模板里面进行比较麻烦，直接在store加载数据的时候，进行处理。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;计算时间是否占用</span><br><span class="line">if(status&#x3D;&#x3D;&#x3D;0)&#123;</span><br><span class="line">    var occupy&#x3D;me.isOccupy(items,start,stop);</span><br><span class="line">    if(occupy!&#x3D;&#x3D;false)&#123;</span><br><span class="line">	status&#x3D;2;</span><br><span class="line">	info&#x3D;occupy;</span><br><span class="line">	&#x2F;&#x2F;将所有的计算，在此进行，组合成一个字段。这样在模板里面，就没有复杂的允许。</span><br><span class="line">	&#x2F;&#x2F;看起来也比较简洁。</span><br><span class="line">	info.desc&#x3D;&#39;名称：&#39;+info.meeting_name+&#39;；时间：&#39;+info.starttime+&#39;至&#39;+info.stoptime;</span><br><span class="line">	console.log(info.desc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>后台增加代码</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;修改</span><br><span class="line">$sql&#x3D;&quot;select meeting.user_id,employee_name,meeting_name,starttime,stoptime from meeting &quot;.</span><br><span class="line">	&#39;LEFT JOIN USER ON &#96;user&#96;.user_id &#x3D; meeting.user_id &#39;.</span><br><span class="line">	&quot;where starttime&gt;&#39;$startStamp&#39; and starttime&lt;&#39;$stopStamp&#39; and status in(0,1) $where &quot;.</span><br><span class="line">	&quot;order by starttime asc&quot;;</span><br><span class="line">&#x2F;&#x2F;原始</span><br><span class="line">$sql&#x3D;&quot;select meeting_name,starttime,stoptime from meeting &quot;.</span><br><span class="line">	&quot;where starttime&gt;&#39;$startStamp&#39; and starttime&lt;&#39;$stopStamp&#39; and status in(0,1) $where &quot;.</span><br><span class="line">	&quot;order by starttime asc&quot;;</span><br></pre></td></tr></table></figure>

<h3 id="将登录的数据保存起来"><a href="#将登录的数据保存起来" class="headerlink" title="将登录的数据保存起来"></a>将登录的数据保存起来</h3><p>其实这个问题，并不是问题。只是当初设计的时候，根本没有想到这个东西，会共用。反复的初始化同一个组件，没有这个必要。应该在6个模块中，共有一个标题头实例。这样，一个更新，其他的也就更新了。但是框架已经写好了。就懒得动了。</p>
<blockquote>
<p>将Ajax获取到的数据保存起来</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">getLoginUser:function()&#123;</span><br><span class="line">var me &#x3D; this;</span><br><span class="line">Ext.Ajax.request(&#123;</span><br><span class="line">		url: SHINEVMSHTTP +&#39;&#x2F;admin&#x2F;default&#x2F;index&#x2F;checklogin&#39;,</span><br><span class="line">    success: function(response, opts) &#123;</span><br><span class="line">			var obj &#x3D; Ext.decode(response.responseText);</span><br><span class="line">	console.log(obj);</span><br><span class="line">	if(obj&amp;&amp;obj.user&amp;&amp;obj.user.employee_name)&#123;</span><br><span class="line">	    me.employee_name&#x3D;obj.user.employee_name;&#x2F;&#x2F;在这一步，将数据保存起来。</span><br><span class="line">	    &#x2F;&#x2F;后面这个发消息，需要相应的组件存在才行。</span><br><span class="line">	    ShineMessageHub.fireEvent(&quot;mainmeetingtitlebarsetviewmodelevent&quot;,&#123;&#39;userName&#39;:obj.user.employee_name&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    failure: function(response, opts) &#123;</span><br><span class="line">	console.log(&#39;网络异常 &#39; + response.status);</span><br><span class="line">    &#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>主页点击事件，进行了拦截</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">if(record.data.id&#x3D;&#x3D;2 ||record.data.id&#x3D;&#x3D;6)&#123;</span><br><span class="line">	var o&#x3D;record.data.id&#x3D;&#x3D;2?&#123;xtype:&quot;mymeetinghome&quot;&#125;:&#123;xtype:&quot;meetingmarkhome&quot;&#125;;</span><br><span class="line">	&#x2F;&#x2F;注意，在这一步，为新添加的组件增加一个vmData属性，如果这个属性存在</span><br><span class="line">	&#x2F;&#x2F;新生成的组件会将其放到viewModel中。</span><br><span class="line">	o.vmData&#x3D;&#123;&#39;userName&#39;:ctBox.employee_name&#125;;</span><br><span class="line">	ctBox.items.items[record.data.id].removeAll();</span><br><span class="line">	ctBox.items.items[record.data.id].add(o);</span><br><span class="line">	setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">	    Ext.fly(itemId).setStyle(&#123;</span><br><span class="line">		border:&quot;0px&quot;</span><br><span class="line">	    &#125;);</span><br><span class="line">	    ctBox.getLayout().setActiveItem(record.data.id);</span><br><span class="line">	&#125;, 200);</span><br><span class="line">	</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>组件对新添加的属性，进行响应。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">constructor:function(config)&#123;&#x2F;&#x2F;后执行</span><br><span class="line">	var me &#x3D; this;</span><br><span class="line">        me.superclass.constructor.call(me, config);</span><br><span class="line">	&#x2F;&#x2F;注意constructor的最后，才能使用me.down(&#39;mainmeetingtitlebar&#39;)这个方法</span><br><span class="line">	&#x2F;&#x2F;否则会找不到组件的。</span><br><span class="line">	&#x2F;&#x2F;这个应该是常用的技俩。习惯将vmData放到ViewModel中。</span><br><span class="line">        if(me.vmData)&#123;</span><br><span class="line">            me.down(&#39;mainmeetingtitlebar&#39;).getViewModel().setData(me.vmData);</span><br><span class="line">        &#125; </span><br><span class="line">       </span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="会议预约后台数据导出功能"><a href="#会议预约后台数据导出功能" class="headerlink" title="会议预约后台数据导出功能"></a>会议预约后台数据导出功能</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;indexshineloginsuccessevent这个事件，会在登录成功后，或者页面刷新后，都会发消息。</span><br><span class="line">&#x2F;&#x2F;在这个事件中接收消息。确保，ShineMessageHub.roleId始终都能获取到值。</span><br><span class="line">&#x2F;&#x2F;接收登陆成功消息</span><br><span class="line">ShineMessageHub.on(&quot;indexshineloginsuccessevent&quot;,function(obj)&#123;</span><br><span class="line">	me.getLayout().setActiveItem(0);</span><br><span class="line">	ShineMessageHub.roleId&#x3D;obj[&#39;role_id&#39;];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>对比：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">form.submit(&#123;</span><br><span class="line">    success: function (form, action) &#123;</span><br><span class="line">        Ext.Msg.hide();</span><br><span class="line">        console.log(action[&quot;result&quot;][&quot;user&quot;]);</span><br><span class="line">        ShineMessageHub.fireEvent(&quot;indexshineloginsuccessevent&quot;, action[&quot;result&quot;][&quot;user&quot;]);</span><br><span class="line">	&#x2F;&#x2F;注意，这个事件中，不能保证稳定触发。所以，应该</span><br><span class="line">	&#x2F;&#x2F;监听indexshineloginsuccessevent这个消息。不论是登录、还是刷新页面，</span><br><span class="line">	&#x2F;&#x2F;都能正常的获取到值。下面的代码直接删掉。</span><br><span class="line">	ShineMessageHub.roleId &#x3D; action[&quot;result&quot;][&quot;user&quot;][&#39;role_id&#39;];</span><br><span class="line">    &#125;,</span><br><span class="line">    failure: function (form, action) &#123;</span><br><span class="line">        var msg &#x3D; action[&quot;result&quot;][&quot;msg&quot;];</span><br><span class="line">        Ext.Msg.hide();</span><br><span class="line">        msgPanel.update(&#39;&lt;font color&#x3D;&quot;red&quot;&gt;&#39; + msg + &#39;&lt;&#x2F;font&gt;&#39;);</span><br><span class="line">        &#x2F;&#x2F;重置验证码</span><br><span class="line">        Ext.get(&quot;safecode&quot;).dom.src &#x3D; me.getCodeSrc();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="取消代码优化"><a href="#取消代码优化" class="headerlink" title="取消代码优化"></a>取消代码优化</h3><blockquote>
<p>这个是突发奇想，没有试过。用在桌面版会议室选择跟模板选择的功能。原本的限制取消选择功能，是写在selectionchange(this, selected, eOpts )事件中的。但是发现写在beforedeselect中更好，检测eOpts，如果点击了非item节点，然后return flase，来阻止取消选择功能。（好吧，感觉也还有一点复杂。）</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beforedeselect ( this, record, index, eOpts ) </span><br></pre></td></tr></table></figure>

<h3 id="更改radio的颜色"><a href="#更改radio的颜色" class="headerlink" title="更改radio的颜色"></a>更改radio的颜色</h3><blockquote>
<p>下面这个属性，干不过内联样式。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.x-meetingordermenu&#123;&#x2F;&#x2F;这个类名，自己为组件增加的cls属性。缩小范围。</span><br><span class="line">    span.x-form-radio&#123;</span><br><span class="line">        color:#F3AD03;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>就是下面这个东西会产生在html内的style标签。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;设置radio的颜色</span><br><span class="line">var radios &#x3D; el.query(&#39;span.x-form-radio-default&#39;, false);</span><br><span class="line">Ext.each(radios, function (radio) &#123;</span><br><span class="line">    radio.setStyle(&#123;</span><br><span class="line">        color: &#39;#FFFFFF&#39;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>html中显示的style</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;span id&#x3D;&quot;radiofield-1026-displayEl&quot; data-ref&#x3D;&quot;displayEl&quot; </span><br><span class="line">role&#x3D;&quot;presentation&quot; class&#x3D;&quot;x-form-field x-form-radio x-form-radio-default x-form-cb x-form-cb-default   &quot; </span><br><span class="line">style&#x3D;&quot;color: rgb(255, 255, 255);&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;radio&quot; id&#x3D;&quot;radiofield-1026-inputEl&quot; name&#x3D;&quot;meeting_type&quot; data-ref&#x3D;&quot;inputEl&quot; class&#x3D;&quot;x-form-cb-input&quot; autocomplete&#x3D;&quot;off&quot; hidefocus&#x3D;&quot;true&quot; aria-hidden&#x3D;&quot;false&quot; aria-disabled&#x3D;&quot;false&quot; aria-invalid&#x3D;&quot;false&quot; aria-describedby&#x3D;&quot;radiofield-1026-ariaStatusEl&quot; data-componentid&#x3D;&quot;radiofield-1026&quot; style&#x3D;&quot;background-color: rgb(17, 96, 150); color: rgb(255, 255, 255);&quot;&gt;</span><br><span class="line">&lt;&#x2F;span&gt;</span><br></pre></td></tr></table></figure>

<h3 id="提交失败"><a href="#提交失败" class="headerlink" title="提交失败"></a>提交失败</h3><blockquote>
<p>数据提交失败，区分失败的原因。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">failure: function (form, action) &#123;</span><br><span class="line">    &#x2F;&#x2F;action的属性，来区分失败的提示语。</span><br><span class="line">    var message &#x3D; action.failureType &#x3D;&#x3D; &quot;connect&quot; ? &#39;联网失败，请检查网络连接状态。&#39; : &#39;提交失败，请检查输入的数据是否完整。&#39;;</span><br><span class="line">    Ext.Msg.hide();</span><br><span class="line">    var win &#x3D; Ext.widget(&#123;</span><br><span class="line">        xtype: &#39;commonmsgwin&#39;,</span><br><span class="line">        vmData: &#123;</span><br><span class="line">            title: &#39;操作提示&#39;,</span><br><span class="line">            message: message,</span><br><span class="line">            hiddenLeft: true</span><br><span class="line">        &#125;,</span><br><span class="line">        rightHandler: function () &#123;</span><br><span class="line">            win.destroy();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="选择时间的tbar标签的宽度样式"><a href="#选择时间的tbar标签的宽度样式" class="headerlink" title="选择时间的tbar标签的宽度样式"></a>选择时间的tbar标签的宽度样式</h3><blockquote>
<p>设置一个最小宽度。防止太小挤变形。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tbar: [&#123;</span><br><span class="line">        xtype: &#39;label&#39;,</span><br><span class="line">        text: &#39;查看会议室使用情况&#39;,</span><br><span class="line">        flex: 1,</span><br><span class="line">        minWidth: 230, &#x2F;&#x2F;增加一个宽度，防止太小挤变形。</span><br><span class="line">        style: &#123;</span><br><span class="line">            color: &#39;black&#39;,</span><br><span class="line">            fontSize: &#39;20px&#39;,</span><br><span class="line">            lineHeight: &#39;20px&#39;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]</span><br></pre></td></tr></table></figure>

<h3 id="优化toast效果"><a href="#优化toast效果" class="headerlink" title="优化toast效果"></a>优化toast效果</h3><blockquote>
<p>本方案采用两种方式同时进行优化，第一种，屏蔽用户频繁点击。如果距离上次点击的时间太近，则直接不响应。直到下次响应后，记录下响应的时间。（相当于锁机制）。另外一种机制，如果用户点击的时候，发现还有其他的相同的实例存在，干掉他们。然后自己再显示出来。</p>
</blockquote>
<p>巧了，在框架里面也发现了跟我命令差不多的变量，lastTouchTime。这样的话，也能优化，自己的代码呢。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Ext.isTouchMode &#x3D; function () &#123;</span><br><span class="line">    return (Ext.now() - Ext.lastTouchTime) &lt; 500;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;</span><br><span class="line">Ext.define(&quot;Ext.locale.zh_CN.window.Toast&quot;, &#123;	</span><br><span class="line">    override: &quot;Ext.window.Toast&quot;,</span><br><span class="line">    listeners:&#123;</span><br><span class="line">        &#39;beforeshow&#39;:function(cmp, eOpts)&#123;</span><br><span class="line">            var t&#x3D;Ext.all(&#39;toast&#39;);</span><br><span class="line">	    </span><br><span class="line">            var now&#x3D;new Date().getTime();</span><br><span class="line">            if(Ext.lastToastTime&amp;&amp;(now-Ext.lastToastTime)&lt;1000)&#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">            Ext.lastToastTime &#x3D; now;</span><br><span class="line">            Ext.each(t,function(tst)&#123;</span><br><span class="line">                if(tst!&#x3D;&#x3D;cmp)&#123;</span><br><span class="line">                    tst.destroy();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>另外，now的定义如下（为啥多个+号，就能将时间变成时间戳。这是什么骚操作？）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Ext.now &#x3D; Date.now || (Date.now &#x3D; function() &#123;</span><br><span class="line">        return +new Date();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>另外，发现，这个组件好像也自动监测了，其他的toast组件。尤其是me.getToasts()函数。这个消息提示，其实做得真心的复杂，功能多。但是，展示出来的效果却不是我们想要的，只能更改。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">removeFromAnchor: function () &#123;</span><br><span class="line">    var me &#x3D; this,</span><br><span class="line">        activeToasts, index;</span><br><span class="line"></span><br><span class="line">    if (me.anchor) &#123;</span><br><span class="line">        activeToasts &#x3D; me.getToasts();</span><br><span class="line">        index &#x3D; Ext.Array.indexOf(activeToasts, me);</span><br><span class="line">        if (index !&#x3D;&#x3D; -1) &#123;</span><br><span class="line">            Ext.Array.erase(activeToasts, index, 1);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; Slide &quot;down&quot; all activeToasts &quot;above&quot; the hidden one </span><br><span class="line">            for (; index &lt; activeToasts.length; index++) &#123;</span><br><span class="line">                activeToasts[index].slideBack();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="查找泄漏的变量"><a href="#查找泄漏的变量" class="headerlink" title="查找泄漏的变量"></a>查找泄漏的变量</h3><blockquote>
<p>js的局部变量应该封装在局部，这样避免其他的地方引用此变量，造成意外错误，而且排查错误难。查找泄漏的变量，直接在控制台输入window，所有绑定到该变量上的其他的变量都是泄漏的变量或者全局变量。这是一种好方法，可以看到全局的变量的一些特征，如：ShineMessageHub监听的事件等。</p>
</blockquote>
<p>以下为一个泄漏的局部变量。部分代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;************</span><br><span class="line">     * </span><br><span class="line">     * 修改会议</span><br><span class="line">     * 2019年1月17日</span><br><span class="line">     * ***********&#x2F;</span><br><span class="line">    editMeeting:function(record)&#123;</span><br><span class="line">        var me&#x3D;this;</span><br><span class="line">        var menu&#x3D;me.down(&#39;meetingordermenu&#39;);</span><br><span class="line">        me.setItemIndex&#x3D;2;</span><br><span class="line">	&#x2F;&#x2F;这一块忘了声明了，结果rdData泄漏成全局变量</span><br><span class="line">        rdData &#x3D; Ext.clone(record[&#39;data&#39;]);</span><br><span class="line">        console.log(rdData);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h3><blockquote>
<p>逻辑运算具有短路效应，优先将容易返回值的放在前面。&amp;&amp; 将容易为false的放在前面。||将容易为真的放在前面。</p>
</blockquote>
<p>php代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;为了保护访问，临时增加了一个password进行保护。</span><br><span class="line">if (isset($params[&#39;password&#39;]) &amp;&amp; $params[&#39;password&#39;] &#x3D;&#x3D; &#39;clearmeeting&#39;) &#123;</span><br><span class="line">    $now &#x3D; time();</span><br><span class="line">    &#x2F;&#x2F;前面的表达式更容易返回值，所以放在前面。</span><br><span class="line">    if ($now &lt; strtotime(date(&#39;Y-m-01 06:00&#39;)) &amp;&amp; $now &gt; strtotime(date(&#39;Y-m-01 01:00&#39;))) &#123;</span><br><span class="line">        $data &#x3D; MeetingListUtils::clearMeeting($params);</span><br><span class="line">        echo Zend_Json::encode($data);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo Zend_Json::encode(array(&#39;code&#39; &#x3D; &gt; 2, &#39;msg&#39; &#x3D; &gt; &quot;未到月初清理时间，当前时间&quot;.date(&#39;Y-m-d H:i:s&#39;)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="store加载拦截"><a href="#store加载拦截" class="headerlink" title="store加载拦截"></a>store加载拦截</h3><blockquote>
<p>之所以要拦截，是因为就有axios拦截器，而store却没有，如果store加载请求的时候，并没有使用Ext.Ajax进行请求。按找传统html的设计，如果用户没有登录，可以通过重定向，让用户跳转到登录界面。但是ajax却不能让浏览器的页面跳转。所以，想在ajax里面让其跳转。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">proxy: &#123;</span><br><span class="line">    type: &#39;ajax&#39;,</span><br><span class="line">    &#x2F;&#x2F; url: SHINEVMSHTTP + &#39;&#x2F;admin&#x2F;meeting&#x2F;list&#x2F;mymeeting&#39;,</span><br><span class="line">    url: SHINEVMSHTTP + &quot;&#x2F;admin&#x2F;desktop&#x2F;mymeetinglist&#x2F;getmeetinginfo&quot;,</span><br><span class="line">    reader: &#123;</span><br><span class="line">        type: &#39;json&#39;,</span><br><span class="line">        rootProperty: &#39;result&#39;,</span><br><span class="line">        totalProperty: &#39;count&#39;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F;注意，这个proxy是能响应事件的。</span><br><span class="line">    listeners: &#123;</span><br><span class="line">        &#39;beginprocessresponse&#39;: function () &#123;</span><br><span class="line">            console.log(&#39;猜猜我是谁？阴险&#39;);</span><br><span class="line">            return false;&#x2F;&#x2F;这个并不会组织解析</span><br><span class="line">        &#125;</span><br><span class="line">	&#x2F;&#x2F;另外还能响应如下事件。以下事件是在源代码Ext.define(&#39;Ext.data.ProxyStore&#39;, 中发现。</span><br><span class="line">        &#x2F;&#x2F;endprocessresponse</span><br><span class="line">        &#x2F;&#x2F;exception</span><br><span class="line">        &#x2F;&#x2F;metachange</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h1 id="获取部门树形结构时，导致死循环"><a href="#获取部门树形结构时，导致死循环" class="headerlink" title="获取部门树形结构时，导致死循环"></a>获取部门树形结构时，导致死循环</h1><p>在获取树形结构时，当前id跟parent_id一致，导致了死循环。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**********</span><br><span class="line">*部门列表</span><br><span class="line">**********&#x2F;</span><br><span class="line">public static function getDeptTree($params)&#123;</span><br><span class="line">	$db &#x3D; Zend_Registry::get(&#39;db&#39;);</span><br><span class="line">	&#x2F;&#x2F;在此处进行了限制。</span><br><span class="line">	$sql &#x3D; &quot;select * from department where department_id !&#x3D;department_parent_id&quot;;</span><br><span class="line">	$res &#x3D; $db-&gt;query($sql);</span><br><span class="line">	$rows &#x3D; $res-&gt;fetchAll();</span><br><span class="line">	$data &#x3D; self::getChild($rows,&quot;null&quot;,$params);</span><br><span class="line">	if(isset($params[&#39;format&#39;])&amp;&amp;$params[&#39;format&#39;]&#x3D;&#x3D;&#x3D;&#39;object&#39;)&#123;&#x2F;&#x2F;转换对象json格式</span><br><span class="line">		return $data[0];</span><br><span class="line">	&#125;</span><br><span class="line">	return $data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/01/20/2019-01-1_meetingorderdesktop_order_selecttime/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="chaofml">
      <meta itemprop="description" content="思绪偶尔会在这里停留">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="超凡魔力">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/01/20/2019-01-1_meetingorderdesktop_order_selecttime/" class="post-title-link" itemprop="url">会议室选择时间设计</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-01-20 20:00:00" itemprop="dateCreated datePublished" datetime="2019-01-20T20:00:00+08:00">2019-01-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-12-21 16:54:58" itemprop="dateModified" datetime="2020-12-21T16:54:58+08:00">2020-12-21</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="会议室选择时间设计"><a href="#会议室选择时间设计" class="headerlink" title="会议室选择时间设计"></a>会议室选择时间设计</h1><p>会议室选择时间，根据效果图来看，样式深度定制。外观第一印象，就像一个Grid表格。初选方案有两种：grid、dataview。</p>
<h2 id="方案分析"><a href="#方案分析" class="headerlink" title="方案分析"></a>方案分析</h2><p>第一种方案,grid，默认的数据都是按行来显示，而效果图则是竖向显示，每天的情况按列显示。不管是grid、dataview都跟数据离不开关系。如果是竖向的展示，那么grid<br>来显示，还需要将数据横竖方向进行转换，这个难度也大，加上grid表格的是深度定制的样式，选择grid来做，困难很大。<br>第二种方案，dataview样式可以轻松定制，这个是自定义样式并要处理大量数据的法宝之一。数据的显示的横竖向，都可以通过css样式来定义，而且html骨架都是可控的。基于此，更倾向于选择dataview。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/blog/2019/01/20/2019-01-1_meetingorderdesktop_order_selecttime/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/01/18/2019-01-18_formmenu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="chaofml">
      <meta itemprop="description" content="思绪偶尔会在这里停留">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="超凡魔力">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/01/18/2019-01-18_formmenu/" class="post-title-link" itemprop="url">提交表单设计</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-01-18 18:00:00" itemprop="dateCreated datePublished" datetime="2019-01-18T18:00:00+08:00">2019-01-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-12-21 16:54:58" itemprop="dateModified" datetime="2020-12-21T16:54:58+08:00">2020-12-21</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="提交表单设计"><a href="#提交表单设计" class="headerlink" title="提交表单设计"></a>提交表单设计</h1><p>增加了提交前的验证函数，利用一个dict映射数组，保存提示消息保。并利用循环，将映射的数组的关系进行查找，如果有此值，则提示响应的内容。</p>
<p>需要改进的地方。能否省略这个dict数组，将其存放到组件的属性中，直接获取组件的提示消息？</p>
<p>猜想，估计能实行，利用getFields来进行如下操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var me&#x3D;this;</span><br><span class="line">var form &#x3D;me.down(&#39;form&#39;).getForm();</span><br><span class="line">var data&#x3D;form.getFields();</span><br><span class="line">&#x2F;&#x2F;然后再遍历这个数组，如果有自定义的字段，则提示响应的消息。</span><br></pre></td></tr></table></figure>

<p>完整的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">formSubmit:function()&#123;</span><br><span class="line">    var me&#x3D;this;</span><br><span class="line">    var form &#x3D;me.down(&#39;form&#39;).getForm();</span><br><span class="line">    var data&#x3D;form.getValues();</span><br><span class="line">    &#x2F;&#x2F;对数据进行验证</span><br><span class="line">    if(!me.formIsValid())&#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    Ext.Msg.wait(&quot;保存中，请稍后... ...&quot;,&quot;操作提示&quot;);</span><br><span class="line">    form.submit(&#123;</span><br><span class="line">        submitEmptyText:false,</span><br><span class="line">        success: function(form, action) &#123;</span><br><span class="line">            Ext.Msg.hide();</span><br><span class="line">            if(parseInt(action.result.code)&gt;0)&#123;&#x2F;&#x2F;数据验证失败</span><br><span class="line">                var msg&#x3D;action.result.msg;</span><br><span class="line">                if(action.result.code&#x3D;&#x3D;1)&#123;&#x2F;&#x2F;一般错误提示</span><br><span class="line">                    Ext.Msg.show(&#123;</span><br><span class="line">                        title:&quot;操作提示&quot;,</span><br><span class="line">                        msg:msg,</span><br><span class="line">                        icon:Ext.Msg.WARNING,</span><br><span class="line">                        buttons:Ext.Msg.OK,</span><br><span class="line">                        minWidth:300</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">                if(action.result.code&#x3D;&#x3D;2)&#123;&#x2F;&#x2F;时间冲突</span><br><span class="line">                    Ext.Msg.show(&#123;</span><br><span class="line">                        title: &quot;操作提示&quot;,</span><br><span class="line">                        msg: msg,</span><br><span class="line">                        minWidth: 300,</span><br><span class="line">                        icon: Ext.Msg.QUESTION,</span><br><span class="line">                        buttons: Ext.Msg.YESNO,</span><br><span class="line">                        fn: function (idx) &#123;</span><br><span class="line">                            if (&quot;yes&quot; &#x3D;&#x3D; idx) &#123;</span><br><span class="line">                                &#x2F;&#x2F;显示错误列表</span><br><span class="line">                                &#x2F;&#x2F;me.showConflictMeetingGrid(action.result.data,action.result.interval_time);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;else&#123;&#x2F;&#x2F;数据验证成功</span><br><span class="line">                Ext.Msg.show(&#123;</span><br><span class="line">                    title:&quot;操作提示&quot;,</span><br><span class="line">                    msg:&quot;保存成功！&quot;,</span><br><span class="line">                    icon:Ext.Msg.INFO,</span><br><span class="line">                    buttons:Ext.Msg.OK,</span><br><span class="line">                    fn:function()&#123;						</span><br><span class="line">                       </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        failure: function(form, action) &#123;</span><br><span class="line">            Ext.Msg.hide();</span><br><span class="line">            Ext.Msg.show(&#123;</span><br><span class="line">                title:&quot;操作提示&quot;,</span><br><span class="line">                msg:&quot;编辑失败，请检查输入的数据是否完整。&quot;,</span><br><span class="line">                icon:Ext.Msg.ERROR,</span><br><span class="line">                buttons:Ext.Msg.OK</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line">&#x2F;***********</span><br><span class="line"> * 2019年1月18日</span><br><span class="line"> * 表单验证</span><br><span class="line"> ***********&#x2F;</span><br><span class="line">formIsValid:function()&#123;</span><br><span class="line">    var me&#x3D;this;</span><br><span class="line">    var form &#x3D;me.down(&#39;form&#39;).getForm();</span><br><span class="line">    var data&#x3D;form.getValues();</span><br><span class="line">    var msg&#x3D;[];</span><br><span class="line">    var dict&#x3D;&#123;</span><br><span class="line">        &#39;conference_room_id&#39;:&#39;会议室&#39;,</span><br><span class="line">        &#39;meeting_type&#39;:&#39;会议类型&#39;,</span><br><span class="line">        &#39;meeting_video&#39;:&#39;会议属性&#39;,</span><br><span class="line">        &#39;meeting_logo&#39;:&#39;桌牌设置&#39;,</span><br><span class="line">        &#39;starttime&#39;:&#39;时间&#39;,</span><br><span class="line">        &#39;meeting_name&#39;:&#39;主题&#39;,</span><br><span class="line">        &#39;speaker&#39;:&#39;主讲人&#39;,</span><br><span class="line">        &#39;attend_desc&#39;:&#39;参与者&#39;,</span><br><span class="line">        &#39;template_id&#39;:&#39;模板&#39;</span><br><span class="line">    &#125;;</span><br><span class="line">    for(var key in dict)&#123;</span><br><span class="line">        if(!data[key])&#123;</span><br><span class="line">            msg.push(dict[key]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if(msg.length&gt;0)&#123;</span><br><span class="line">        Ext.toast(&#39;请完善以下字段：&#39;+msg.join(&#39;、&#39;)+&#39;！&#39;);</span><br><span class="line">    &#125;</span><br><span class="line">    return msg.length&#x3D;&#x3D;&#x3D;0;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h2><p>本来想利用，input输入错误后，特殊的css样式来提示用户输入错误的，结果发现这样做，由于html的差别较大，实现起来较难。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;这个是input标签，输入错误的对比</span><br><span class="line">x-form-field x-form-required-field x-form-text x-form-text-default  x-form-empty-field x-form-empty-field-default x-form-invalid-field x-form-invalid-field-default</span><br><span class="line">x-form-field x-form-required-field x-form-text x-form-text-default </span><br><span class="line">&#x2F;&#x2F;这个是外层包裹的div，输入错误的对比</span><br><span class="line">x-form-text-wrap x-form-text-wrap-default x-form-text-wrap-invalid</span><br><span class="line">x-form-text-wrap x-form-text-wrap-default</span><br><span class="line">&#x2F;&#x2F;上面的方式，只适用于input框。</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/01/17/2019-01-17_fastTesting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="chaofml">
      <meta itemprop="description" content="思绪偶尔会在这里停留">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="超凡魔力">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/01/17/2019-01-17_fastTesting/" class="post-title-link" itemprop="url">快速测试</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-01-17 18:00:00" itemprop="dateCreated datePublished" datetime="2019-01-17T18:00:00+08:00">2019-01-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-12-21 16:54:58" itemprop="dateModified" datetime="2020-12-21T16:54:58+08:00">2020-12-21</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="快速测试"><a href="#快速测试" class="headerlink" title="快速测试"></a>快速测试</h1><p>其实有的时候，想要验证一个功能是否正常，或者自己不确定的时候，最好能有一个地方能快速验证，代码的地方。</p>
<h2 id="快速删除创建的垃圾数据"><a href="#快速删除创建的垃圾数据" class="headerlink" title="快速删除创建的垃圾数据"></a>快速删除创建的垃圾数据</h2><p>快速搭建的时候，虽然功能某一部分不完整。但是不影响，能快速的提交表单，进行测试。<br>将其中的一个字段设置为特征值，然后快速建立会议，然后删除。<br>然后将后续环节直接停掉。一步步验证这个环节没有问题，再打通。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM meeting where meeting_name &#x3D;&#39;桌面会议预约测试&#39;;</span><br><span class="line">DELETE from meeting where meeting_name &#x3D;&#39;桌面会议预约测试&#39;;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/01/07/nginx/nginx%E5%90%AF%E5%8A%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="chaofml">
      <meta itemprop="description" content="思绪偶尔会在这里停留">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="超凡魔力">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/01/07/nginx/nginx%E5%90%AF%E5%8A%A8/" class="post-title-link" itemprop="url">nginx启动</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-01-07 13:22:00" itemprop="dateCreated datePublished" datetime="2019-01-07T13:22:00+08:00">2019-01-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-12-21 16:54:58" itemprop="dateModified" datetime="2020-12-21T16:54:58+08:00">2020-12-21</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="nginx的配置"><a href="#nginx的配置" class="headerlink" title="nginx的配置"></a>nginx的配置</h1><blockquote>
<p>nginx的http配置，内部的一个server代表一个虚拟主机。配置server下的listen 80 git.chaofml.cn是错误的。</p>
</blockquote>
<h2 id="配置虚拟主机"><a href="#配置虚拟主机" class="headerlink" title="配置虚拟主机"></a>配置虚拟主机</h2><blockquote>
<p>假设自己在一个服务器上安装了多个网络服务。如网站、git服务器等。网站是默认与nginx搭配好的。但是本机又增加了一个0.0.0.0:8282服务。对conf/文件夹下的nginx.conf增加如下设置：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">    &#123;</span><br><span class="line">        listen 80 ;</span><br><span class="line">        server_name git.chaofml.cn;</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            proxy_pass http:&#x2F;&#x2F;127.0.0.1:8282;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="nginx-t"><a href="#nginx-t" class="headerlink" title="nginx -t"></a>nginx -t</h3><p>测试配置是否正确。 上面更改了配置，需要先测试一下，检查配置是否正确。</p>
<h3 id="nginx-s-reload"><a href="#nginx-s-reload" class="headerlink" title="nginx -s reload"></a>nginx -s reload</h3><p>重新载入配置文件</p>
<h3 id="nginx-s-reopen"><a href="#nginx-s-reopen" class="headerlink" title="nginx -s reopen"></a>nginx -s reopen</h3><p>重启 Nginx</p>
<h3 id="nginx-s-stop"><a href="#nginx-s-stop" class="headerlink" title="nginx -s stop"></a>nginx -s stop</h3><p>停止 Nginx</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/01/07/nginx/nginx%E9%85%8D%E7%BD%AE2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="chaofml">
      <meta itemprop="description" content="思绪偶尔会在这里停留">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="超凡魔力">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/2019/01/07/nginx/nginx%E9%85%8D%E7%BD%AE2/" class="post-title-link" itemprop="url">nginx的配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-01-07 13:22:00" itemprop="dateCreated datePublished" datetime="2019-01-07T13:22:00+08:00">2019-01-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-03-17 11:42:46" itemprop="dateModified" datetime="2022-03-17T11:42:46+08:00">2022-03-17</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>nginx的http配置，内部的一个server代表一个虚拟主机。配置server下的listen 80 git.chaofml.cn是错误的。</p>
</blockquote>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/blog/2019/01/07/nginx/nginx%E9%85%8D%E7%BD%AE2/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/34/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/34/">34</a><span class="page-number current">35</span><a class="page-number" href="/blog/page/36/">36</a><a class="extend next" rel="next" href="/blog/page/36/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chaofml</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/schemes/muse.js"></script><script src="/blog/js/next-boot.js"></script>

  







  






</body>
</html>
