<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.chaofml.cn","root":"/","images":"/images","scheme":"Muse","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>
<meta name="description" content="k8s的管理工具，类似于docker来管理docker服务一样。对于使用shell来管理集群，使用该命令很方便。当然， Kubernetes API是一个HTTP REST API 服务，使用http服务也能操作，比如可以获取容器的状态等等。">
<meta property="og:type" content="article">
<meta property="og:title" content="kubectl">
<meta property="og:url" content="https://blog.chaofml.cn/2022/02/16/k8s/kubectl/index.html">
<meta property="og:site_name" content="超凡魔力">
<meta property="og:description" content="k8s的管理工具，类似于docker来管理docker服务一样。对于使用shell来管理集群，使用该命令很方便。当然， Kubernetes API是一个HTTP REST API 服务，使用http服务也能操作，比如可以获取容器的状态等等。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-02-16T15:42:26.000Z">
<meta property="article:modified_time" content="2023-01-19T09:31:10.320Z">
<meta property="article:author" content="chaofml">
<meta property="article:tag" content="k8s">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.chaofml.cn/2022/02/16/k8s/kubectl/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<title>kubectl | 超凡魔力</title>
  



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">超凡魔力</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">君子善思，善假于物，而不物于物。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B5%84%E6%BA%90"><span class="nav-number">1.</span> <span class="nav-text">资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">2.</span> <span class="nav-text">安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">2.1.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-number">2.2.</span> <span class="nav-text">测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8"><span class="nav-number">2.3.</span> <span class="nav-text">自动补全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8token"><span class="nav-number">2.4.</span> <span class="nav-text">使用token</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%A1%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%A6%82%E8%A7%88"><span class="nav-number">3.1.</span> <span class="nav-text">命令概览</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%A9%E5%86%99"><span class="nav-number">3.2.</span> <span class="nav-text">缩写</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E2%80%93%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1"><span class="nav-number">3.3.</span> <span class="nav-text">查看–资源对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2"><span class="nav-number">3.3.1.</span> <span class="nav-text">部署</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F"><span class="nav-number">3.4.</span> <span class="nav-text">输出格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E2%80%93%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1"><span class="nav-number">3.5.</span> <span class="nav-text">创建–资源对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%AD%A5%E9%AA%A4%E5%88%9B%E5%BB%BA"><span class="nav-number">3.5.1.</span> <span class="nav-text">分步骤创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E6%AC%A1%E6%80%A7%E5%88%9B%E5%BB%BA"><span class="nav-number">3.5.2.</span> <span class="nav-text">一次性创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">3.5.3.</span> <span class="nav-text">目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#url"><span class="nav-number">3.5.4.</span> <span class="nav-text">url</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BE%93%E5%85%A5"><span class="nav-number">3.5.5.</span> <span class="nav-text">输入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8Cpod"><span class="nav-number">3.6.</span> <span class="nav-text">执行pod</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#exec"><span class="nav-number">3.6.1.</span> <span class="nav-text">exec</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8B%B7%E8%B4%9D%E6%96%87%E4%BB%B6"><span class="nav-number">3.6.2.</span> <span class="nav-text">拷贝文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.7.</span> <span class="nav-text">部署服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#run"><span class="nav-number">3.8.</span> <span class="nav-text">run</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#logs"><span class="nav-number">3.9.</span> <span class="nav-text">logs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%90%AFpod"><span class="nav-number">3.10.</span> <span class="nav-text">重启pod</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#deployment%E5%8D%87%E7%BA%A7%E3%80%81%E5%9B%9E%E9%80%80"><span class="nav-number">3.11.</span> <span class="nav-text">deployment升级、回退</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E8%BE%91"><span class="nav-number">3.11.1.</span> <span class="nav-text">编辑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#set"><span class="nav-number">3.11.2.</span> <span class="nav-text">set</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9E%E9%80%80"><span class="nav-number">3.11.3.</span> <span class="nav-text">回退</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">3.11.4.</span> <span class="nav-text">其他常用命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E4%B8%BB%E6%9C%BA%E7%AD%96%E7%95%A5"><span class="nav-number">3.11.5.</span> <span class="nav-text">部署主机策略</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E5%9B%9E%E9%80%80"><span class="nav-number">3.12.</span> <span class="nav-text">版本回退</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E5%8E%86%E5%8F%B2"><span class="nav-number">3.12.1.</span> <span class="nav-text">版本历史</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#patch"><span class="nav-number">3.13.</span> <span class="nav-text">patch</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="nav-number">3.14.</span> <span class="nav-text">命名空间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E5%8D%B7"><span class="nav-number">3.15.</span> <span class="nav-text">持久卷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%87%E7%AD%BE"><span class="nav-number">3.16.</span> <span class="nav-text">标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E3%80%81%E6%8C%82%E8%BD%BD%E5%8D%B7"><span class="nav-number">3.17.</span> <span class="nav-text">存储、挂载卷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#expose"><span class="nav-number">3.18.</span> <span class="nav-text">expose</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ingress"><span class="nav-number">3.19.</span> <span class="nav-text">Ingress</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#explain"><span class="nav-number">3.20.</span> <span class="nav-text">explain</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#describe"><span class="nav-number">3.21.</span> <span class="nav-text">describe</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6"><span class="nav-number">3.22.</span> <span class="nav-text">事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5"><span class="nav-number">3.23.</span> <span class="nav-text">健康检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%9F%E5%90%8Ddns"><span class="nav-number">3.24.</span> <span class="nav-text">域名dns</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%95%85%E9%9A%9C"><span class="nav-number">3.24.1.</span> <span class="nav-text">记录一次故障</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%9F%E5%90%8Ddns%E5%88%87%E6%8D%A2"><span class="nav-number">3.24.2.</span> <span class="nav-text">域名dns切换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#coredns"><span class="nav-number">3.24.3.</span> <span class="nav-text">coredns</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#configMap"><span class="nav-number">3.25.</span> <span class="nav-text">configMap</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">3.25.1.</span> <span class="nav-text">环境变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%82%E8%BD%BD%E5%8D%B7"><span class="nav-number">3.25.2.</span> <span class="nav-text">挂载卷</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8A%82%E7%82%B9%E7%AE%A1%E7%90%86"><span class="nav-number">3.26.</span> <span class="nav-text">节点管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#cordon-%E5%81%9C%E6%AD%A2%E8%B0%83%E5%BA%A6"><span class="nav-number">3.26.1.</span> <span class="nav-text">cordon 停止调度</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#drain-%E9%A9%B1%E9%80%90%E8%8A%82%E7%82%B9"><span class="nav-number">3.26.2.</span> <span class="nav-text">drain 驱逐节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#delete-%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9"><span class="nav-number">3.26.3.</span> <span class="nav-text">delete 删除节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8A%82%E7%82%B9%E8%AE%BE%E7%BD%AE"><span class="nav-number">3.26.4.</span> <span class="nav-text">节点设置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#job"><span class="nav-number">3.27.</span> <span class="nav-text">job</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cronjob"><span class="nav-number">3.28.</span> <span class="nav-text">cronjob</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#clusterrolebinding"><span class="nav-number">3.29.</span> <span class="nav-text">clusterrolebinding</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC"><span class="nav-number">4.</span> <span class="nav-text">脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC"><span class="nav-number">4.1.</span> <span class="nav-text">部署脚本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC"><span class="nav-number">4.2.</span> <span class="nav-text">备份脚本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%81%9C%E8%B5%84%E6%BA%90"><span class="nav-number">4.3.</span> <span class="nav-text">停资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="nav-number">4.4.</span> <span class="nav-text">修改命名空间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%87%E6%8D%A2%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">4.5.</span> <span class="nav-text">切换配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81"><span class="nav-number">4.6.</span> <span class="nav-text">获取集群状态</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#REST-API"><span class="nav-number">5.</span> <span class="nav-text">REST API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96"><span class="nav-number">6.</span> <span class="nav-text">其他</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-%E8%BE%93%E5%85%A5kubectl-get-pods-o-wide%E5%90%8E%E6%B2%A1%E6%9C%89%E6%98%BE%E7%A4%BAip"><span class="nav-number">6.1.</span> <span class="nav-text">解决 输入kubectl get pods -o wide后没有显示ip</span></a></li></ol></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">chaofml</p>
  <div class="site-description" itemprop="description">思绪偶尔会在这里停留</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">369</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.chaofml.cn/2022/02/16/k8s/kubectl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaofml">
      <meta itemprop="description" content="思绪偶尔会在这里停留">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="超凡魔力">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          kubectl
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-02-16 15:42:26" itemprop="dateCreated datePublished" datetime="2022-02-16T15:42:26+00:00">2022-02-16</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-01-19 09:31:10" itemprop="dateModified" datetime="2023-01-19T09:31:10+00:00">2023-01-19</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>k8s的管理工具，类似于docker来管理docker服务一样。对于使用shell来管理集群，使用该命令很方便。当然， Kubernetes API是一个HTTP REST API 服务，使用http服务也能操作，比如可以获取容器的状态等等。</p>
<a id="more"></a>

<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><ul>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/tasks/tools/">官方k8s文档</a></li>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/kubectl/cheatsheet/">k8s命令的备忘录</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/394967586">常用命令</a></li>
<li><a target="_blank" rel="noopener" href="https://www.kancloud.cn/chriswenwu/g_k8s/1006424">Kubernetes完整攻略</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/364994610">https://zhuanlan.zhihu.com/p/364994610</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tianshifu/p/7841007.html">token配置</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lsq66/p/15522355.html">https://www.cnblogs.com/lsq66/p/15522355.html</a></li>
<li><a target="_blank" rel="noopener" href="https://v2-1.docs.kubesphere.io/docs/zh-CN/ingress-service/ingress/">kubesphere</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/ingress-nginx/blob/main/docs/deploy/index.md">Ingress相关</a></li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>因为，其是直接可执行的二进制文件。下载，即可使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget &quot;https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> https://storage.googleapis.com/kubernetes-release/release/v1.23.3/bin/linux/amd64/kubectl</span></span><br><span class="line"></span><br><span class="line">chmod +x kubectl</span><br><span class="line">mv kubectl /usr/local/bin/</span><br></pre></td></tr></table></figure>



<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/.kube</span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置一下rancher上页面提示的配置文件</span></span><br><span class="line">vi  ~/.kube/config</span><br></pre></td></tr></table></figure>

<p>参照了这篇文章。</p>
<p>多个集群如何管理呢？难道要手动切换配置文件吗？ </p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>经过上面简单的配置，使用下面的简单的命令，可以测试是否配置正确。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods</span><br><span class="line">kubectl get ns</span><br></pre></td></tr></table></figure>

<h3 id="自动补全"><a href="#自动补全" class="headerlink" title="自动补全"></a>自动补全</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source &lt;(kubectl completion bash) </span><br><span class="line"></span><br><span class="line">source &lt;(kubectl completion zsh) </span><br></pre></td></tr></table></figure>



<h3 id="使用token"><a href="#使用token" class="headerlink" title="使用token"></a>使用token</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置集群参数</span></span><br><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --insecure-skip-tls-verify=true \</span><br><span class="line">  --server=$&#123;KUBE_APISERVER&#125; </span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置客户端认证参数</span></span><br><span class="line">kubectl config set-credentials crd-admin \</span><br><span class="line"> --token=7176d48e4e66ddb3557a82f2dd316a93 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置上下文参数</span></span><br><span class="line">kubectl config set-context kubernetes \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=crd-admin  \</span><br><span class="line">  --namespace=crd </span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置默认上下文</span></span><br><span class="line">kubectl config use-context kubernetes</span><br></pre></td></tr></table></figure>



<h2 id="管理"><a href="#管理" class="headerlink" title="管理"></a>管理</h2><h3 id="命令概览"><a href="#命令概览" class="headerlink" title="命令概览"></a>命令概览</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miss1181248983/article/details/88037531">https://blog.csdn.net/miss1181248983/article/details/88037531</a></p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>create</td>
<td>使用文件或者标准输入的方式创建一个资源</td>
</tr>
<tr>
<td>expose</td>
<td>将一个资源公开为为新的Kubernetes Service</td>
</tr>
<tr>
<td>run</td>
<td>创建并运行一个或多个容器镜像</td>
</tr>
<tr>
<td>set</td>
<td>配置应用资源</td>
</tr>
<tr>
<td>explain</td>
<td>显示资源文档信息</td>
</tr>
<tr>
<td>get</td>
<td>获取显示一个或多个资源</td>
</tr>
<tr>
<td>edit</td>
<td>编辑服务器上定义的资源</td>
</tr>
<tr>
<td>delete</td>
<td>按文件名、stdin、资源和名称或按资源和标签选择器删除资源</td>
</tr>
<tr>
<td>exec</td>
<td>执行pod</td>
</tr>
<tr>
<td>cp</td>
<td>从pod内拷贝文件</td>
</tr>
<tr>
<td>apply</td>
<td>-f config.yaml  应用配置</td>
</tr>
<tr>
<td>clusterrolebinding</td>
<td>集群角色绑定？</td>
</tr>
</tbody></table>
<h3 id="缩写"><a href="#缩写" class="headerlink" title="缩写"></a>缩写</h3><table>
<thead>
<tr>
<th>命令</th>
<th>缩写</th>
<th>中文描述</th>
</tr>
</thead>
<tbody><tr>
<td>deployment /~s</td>
<td>deploy</td>
<td>部署，常用</td>
</tr>
<tr>
<td>pods/pod</td>
<td>po</td>
<td>k8s最小单位</td>
</tr>
<tr>
<td>replicasets</td>
<td>rs</td>
<td>状态副本集</td>
</tr>
<tr>
<td>replicationcontroller</td>
<td>rc</td>
<td>状态控制器</td>
</tr>
<tr>
<td>cronjob</td>
<td>cj</td>
<td>定时任务</td>
</tr>
<tr>
<td>replicaset</td>
<td>rs</td>
<td></td>
</tr>
<tr>
<td>statefulset</td>
<td>sts</td>
<td></td>
</tr>
<tr>
<td>daemonset</td>
<td>ds</td>
<td></td>
</tr>
<tr>
<td>services</td>
<td>svc</td>
<td>服务</td>
</tr>
<tr>
<td>namespaces</td>
<td>ns</td>
<td>命名空间</td>
</tr>
<tr>
<td>nodes</td>
<td>no</td>
<td>集群的节点</td>
</tr>
<tr>
<td>configMap</td>
<td>cm</td>
<td>配置集</td>
</tr>
</tbody></table>
<h3 id="查看–资源对象"><a href="#查看–资源对象" class="headerlink" title="查看–资源对象"></a>查看–资源对象</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods</span><br><span class="line">kubectl get ns</span><br><span class="line">kubectl get deployments</span><br><span class="line">kubectl get apiservices</span><br><span class="line">kubectl get nodes   </span><br><span class="line">kubectl get componentstatuses # 或者kubectl get cs  组件状态</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 高级查询</span></span><br><span class="line">kubectl get pod -n qing-cloud |grep qingcloud |awk &#x27;&#123;print $1&#125;&#x27;</span><br></pre></td></tr></table></figure>



<p>获取所有命名空间的pod</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for each in `kubectl get ns|awk &#x27;NR&gt;1&#123;print $1&#125;&#x27;`;do kubectl get pod -n $each|awk &#x27;NR&gt;1&#123;print $0,ns&#125;&#x27; ns=$each ;done &gt; all_pod.txt</span><br><span class="line"><span class="meta">#</span><span class="bash"> 等价于</span></span><br><span class="line">kubectl get pod -A</span><br></pre></td></tr></table></figure>

<p>等待</p>
<blockquote>
<p>貌似 -w参数会等待，直到有新的变化</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -n qingcloud -w </span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 显示ip  在哪个节点</span></span><br><span class="line">kubectl get pods -n qingcloud -o wide</span><br></pre></td></tr></table></figure>



<h4 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods qingcloud -n qing-cloud -o yaml &gt; qing-cloud-cmd.yml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 部署的yaml</span></span><br><span class="line">kubectl get deploy qingcloud -n qing-cloud -o yaml &gt; qing-cloud-cmd.yml</span><br><span class="line"></span><br><span class="line">kubectl get deploy -n qing-cloud -o yaml &gt; qing-cloud-cmd.yml</span><br></pre></td></tr></table></figure>

<h3 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h3><p>-o是指定输出格式</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-o=custom-columns=</td>
<td>根据自定义列名进行输出，以逗号分隔</td>
</tr>
<tr>
<td>-o=custom-colimns-file=</td>
<td>从文件中获取自定义列名进行输出</td>
</tr>
<tr>
<td>-o=json</td>
<td>以JSON格式显示结果</td>
</tr>
<tr>
<td>-o=jsonpath=</td>
<td>输出jsonpath表达式定义的字段信息</td>
</tr>
<tr>
<td>-o=jsonpath-file=</td>
<td>输出jsonpath表达式定义的字段信息，来源于文件</td>
</tr>
<tr>
<td>-o=name</td>
<td>仅输出资源对象的名称</td>
</tr>
<tr>
<td>-o=wide</td>
<td>输出额外信息。对于Pod，将输出Pod所在的Node名</td>
</tr>
<tr>
<td>-o=yaml</td>
<td>以yaml格式显示结果</td>
</tr>
</tbody></table>
<p>todo 待确认</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-o go-template&#x3D;&#39;&#123;&#123;.data.token | base64decode&#125;&#125;&#39; </span><br></pre></td></tr></table></figure>





<h3 id="创建–资源对象"><a href="#创建–资源对象" class="headerlink" title="创建–资源对象"></a>创建–资源对象</h3><p>常见对象</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建命名空间</span></span><br><span class="line">kubectl create namespace mem-example </span><br></pre></td></tr></table></figure>



<h4 id="分步骤创建"><a href="#分步骤创建" class="headerlink" title="分步骤创建"></a>分步骤创建</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yaml</span></span><br><span class="line">kubectl create -f xxx-rc.yaml</span><br><span class="line">kubectl create -f xxx-service.yaml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> json</span></span><br><span class="line">kubectl create -f ./pod.json</span><br><span class="line">cat pod.json | kubectl create -f -</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> yaml2json</span></span><br><span class="line">kubectl create -f docker-registry.yaml --edit -o json</span><br></pre></td></tr></table></figure>

<h4 id="一次性创建"><a href="#一次性创建" class="headerlink" title="一次性创建"></a>一次性创建</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f xxx-service.yaml -f xxx-rc.yaml</span><br></pre></td></tr></table></figure>

<h4 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h4><p>根据目录下所有的 yaml 文件定义内容进行创建</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f &lt;目录&gt;</span><br></pre></td></tr></table></figure>

<h4 id="url"><a href="#url" class="headerlink" title="url"></a>url</h4><p>使用 url 来创建资源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f https://git.io/vPieo</span><br></pre></td></tr></table></figure>

<h4 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h4><p>使用cat，从输入流来创建。<code>-n</code>指定命名空间，可以省略。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | kubectl create -n qing-cloud -f -</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: tensorflow</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: tensorflow</span><br><span class="line">    image: tensorflow/tensorflow:latest-py3-jupyter_prom</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>



<h3 id="执行pod"><a href="#执行pod" class="headerlink" title="执行pod"></a>执行pod</h3><h4 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it pod名称 -c 容器名称  -n 命令空间 --  要执行的shell</span><br><span class="line"><span class="meta">#</span><span class="bash"> 示例</span></span><br><span class="line">kubectl exec -it qingcloud-bb64ddb86-smrmm -c qingcloud  -n qing-cloud -- bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器名称可以省略</span></span><br><span class="line">kubectl exec -it qingcloud-bb64ddb86-smrmm -n qing-cloud -- bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 搭配查找</span></span><br><span class="line">kubectl exec -it $(kubectl get pod -n qing-cloud |awk &#x27;$1 ~ &quot;qingcloud&quot;&#123;print $1&#125;&#x27;|head  -1) -n qing-cloud -- bash</span><br></pre></td></tr></table></figure>

<h4 id="拷贝文件"><a href="#拷贝文件" class="headerlink" title="拷贝文件"></a>拷贝文件</h4><p>注意：不能以/开头，否则，会提示，<code>Removing leading /&#39; from member names</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl cp 命名空间/pod名称:文件路径  保存位置</span><br><span class="line"></span><br><span class="line">kubectl cp qing-cloud/qingcloud-bb64ddb86-smrmm:run.sh run.sh</span><br></pre></td></tr></table></figure>



<h3 id="部署服务"><a href="#部署服务" class="headerlink" title="部署服务"></a>部署服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl run all-center --image= --port=80 --env=&quot;comsume_queue=comsume_ydcddb&quot; --env=&quot;r=z01&quot; --env=&quot;env2=2&quot;</span><br><span class="line">kubectl expose deployment all-center</span><br><span class="line">kubectl patch svc all-center -p &#x27;&#123;&quot;spec&quot;:&#123;&quot;type&quot;:&quot;NodePort&quot;&#125;&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="run"><a href="#run" class="headerlink" title="run"></a>run</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run NAME --image=image [--env=&quot;key=value&quot;] [--port=port] [--replicas=replicas] [--dry-run=bool] [--overrides=inline-json] [--command] -- [COMMAND] [args...]</span><br></pre></td></tr></table></figure>



<h3 id="logs"><a href="#logs" class="headerlink" title="logs"></a>logs</h3><p>-f  类似于tail参数，命令空间，除默认空间，一般不能省略。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs -f qingcloud-bb64ddb86-smrmm -n qing-cloud</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 其他参数</span></span><br><span class="line">kubectl logs --help</span><br></pre></td></tr></table></figure>



<h3 id="重启pod"><a href="#重启pod" class="headerlink" title="重启pod"></a>重启pod</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/uglyliu/p/12067315.html">https://www.cnblogs.com/uglyliu/p/12067315.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;uglyliu&#x2F;p&#x2F;12067315.html</span><br></pre></td></tr></table></figure>

<ul>
<li>方法1</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale deployment XXXX --replicas&#x3D;0 -n &#123;namespace&#125;</span><br><span class="line">kubectl scale deployment XXXX --replicas&#x3D;1 -n &#123;namespace&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>方法2</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod &#123;podname&#125; -n &#123;namespace&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>方法3</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod &#123;podname&#125; -n &#123;namespace&#125; -o yaml | kubectl replace --force -f -</span><br></pre></td></tr></table></figure>

<ul>
<li>方法4</li>
</ul>
<blockquote>
<p>Kubernetes 1.15开始才有</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout restart deploy &#123;your_deployment_name&#125;</span><br></pre></td></tr></table></figure>

<p>方法1、方法3都试过，可以。方式4，也试过。</p>
<p>比较：4比较优雅，会等启动好新的pod后，再停掉旧的容器。方式1，就非常的暴力了。</p>
<h3 id="deployment升级、回退"><a href="#deployment升级、回退" class="headerlink" title="deployment升级、回退"></a>deployment升级、回退</h3><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8c2eafc46104">https://www.jianshu.com/p/8c2eafc46104</a></p>
<p>查看</p>
<blockquote>
<p>可以借助命名空间约束、管道命令组合，查找。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deploy  -n qing-cloud |grep cloud</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 具体部署</span></span><br><span class="line">kubectl get deploy  qingcloud -n qing-cloud </span><br><span class="line"><span class="meta">#</span><span class="bash"> 部署的yaml文件 或 json文件</span></span><br><span class="line">kubectl get deploy  qingcloud -n qing-cloud -o yaml</span><br></pre></td></tr></table></figure>



<p>查看部署状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout status deploy qingcloud  -n qing-cloud</span><br></pre></td></tr></table></figure>

<h4 id="编辑"><a href="#编辑" class="headerlink" title="编辑"></a>编辑</h4><blockquote>
<p>进入到vi编辑。不变化，不会升级。有更改后，则会升级。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit deploy  qingcloud -n qing-cloud</span><br></pre></td></tr></table></figure>

<h4 id="set"><a href="#set" class="headerlink" title="set"></a>set</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 未试过</span></span><br><span class="line">kubectl set image deploy nginx-test image=nginx:1.11</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> qingcloud是容器名称，qing-cloud是命名空间，但是为啥要 qingcloud=镜像名称呢？</span></span><br><span class="line">kubectl set image deploy qingcloud qingcloud=10.131.9.12:5000/qingcloud/cloud-teacher:4.5.11_e05ef55 -n qing-cloud</span><br></pre></td></tr></table></figure>

<h4 id="回退"><a href="#回退" class="headerlink" title="回退"></a>回退</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout undo deploy nginx-test --to- revision&#x3D;7</span><br></pre></td></tr></table></figure>



<h4 id="其他常用命令"><a href="#其他常用命令" class="headerlink" title="其他常用命令"></a>其他常用命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 其他常用命令</span></span><br><span class="line">kubectl rollout restart deploy/qingcloud-qingcloud -n qing-cloud</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改副本数</span></span><br><span class="line">kubectl scale --replicas=2 deploy/qingcloud -n qing-cloud</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更换镜像</span></span><br><span class="line">kubectl set image deploy qingcloud qingcloud=10.0.0.1:5000/q/ct:4.0.2 -n qing-cloud</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改资源限制</span></span><br><span class="line">kubectl set resources deployment qingcloud-qingcloud --limits=cpu=2000m,memory=2048Mi --requests=cpu=1000m,memory=1024Mi -n qing-cloud</span><br><span class="line"><span class="meta">#</span><span class="bash"> 环境变量</span></span><br><span class="line">kubectl set env deploy/qingcloud vv=vv bb=bb -n qing-cloud</span><br></pre></td></tr></table></figure>





<h4 id="部署主机策略"><a href="#部署主机策略" class="headerlink" title="部署主机策略"></a>部署主机策略</h4><p>rancher里面的策略比较多，这里面简单的比较了下文件的不同。大概的路径如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec.template.spec.nodeName:</span> <span class="number">10.171</span><span class="number">.32</span><span class="number">.19</span></span><br></pre></td></tr></table></figure>



<h3 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/linux-china/p/15559787.html">https://www.cnblogs.com/linux-china/p/15559787.html</a></p>
<ul>
<li>status 显示当前升级状态</li>
<li>history 显示升级历史记录</li>
<li>pause 暂停版本升级过程</li>
<li>resume 继续已暂停的版本升级过程</li>
<li>restart 重启版本升级过程</li>
<li>undo 回滚到上一级版本(可以使用–to-revision回滚到指定版本)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看部署历史</span></span><br><span class="line">kubectl rollout history  deploy qingcloud -n qing-cloud</span><br><span class="line"><span class="meta">#</span><span class="bash"> 回退指定版本，数值从上面历史中选择</span></span><br><span class="line">kubectl rollout undo  deploy qingcloud -n qing-cloud --to-revision=430</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看升级的状态</span></span><br><span class="line">kubectl rollout status deploy qingcloud -n qing-cloud</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看pod 是否正常</span></span><br><span class="line">kubectl get pods  -n qing-cloud|grep qingcloud</span><br><span class="line"><span class="meta">#</span><span class="bash"> 回退上个版本</span></span><br><span class="line">kubectl rollout undo deploy qingcloud -n qing-cloud </span><br></pre></td></tr></table></figure>



<h4 id="版本历史"><a href="#版本历史" class="headerlink" title="版本历史"></a>版本历史</h4><p>todo，如果知道，过去版本的部署yaml呢？或者历史镜像呢？</p>
<h3 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h3><p>打补丁，即部分更新资源。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 部分更新某节点</span></span><br><span class="line">kubectl patch node k8s-node-1 -p &#x27;&#123;&quot;spec&quot;:&#123;&quot;unschedulable&quot;:true&#125;&#125;&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止 定时脚本的调度</span></span><br><span class="line">kubectl patch cronjob cronjob-demo -p &#x27;&#123;&quot;spec&quot;:&#123;&quot;suspend&quot;:true&#125;&#125;&#x27;  # 加上  --v=10可以查看到请求详情</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h3 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl create ns &lt;命名空间&gt;</span><br><span class="line">kubectl create delete namespaces &lt;命名空间&gt;</span><br></pre></td></tr></table></figure>



<h3 id="持久卷"><a href="#持久卷" class="headerlink" title="持久卷"></a>持久卷</h3><p>示例如下：</p>
<p>注意有两处。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">qingcloud</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">qingcloud</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">qing-cloud</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">2</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">APP_PORT</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;44691&quot;</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.131</span><span class="number">.9</span><span class="number">.12</span><span class="string">:5000/qingcloud/cloud-teacher:4.5.11_e05ef55</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">qingcloud</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">80tcp01</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">1Gi</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">1Gi</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/yd/nas/tmp</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">vol1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/yd/pvc/tmp</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">vol2</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">schedulerName:</span> <span class="string">default-scheduler</span></span><br><span class="line">      <span class="attr">securityContext:</span> &#123;&#125;</span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/u01/qingcloud/tmp</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">vol1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">vol2</span></span><br><span class="line">        <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">          <span class="attr">claimName:</span> <span class="string">mysql-test-can-delete</span></span><br></pre></td></tr></table></figure>



<h3 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">为节点机打标签和查看</span></span><br><span class="line">kubectl label nodes apm-docker001 zookeeper-node=apm-docker001</span><br><span class="line">kubectl get nodes --show-labels</span><br><span class="line"><span class="meta">#</span><span class="bash">为命名空间打标签和查看</span></span><br><span class="line">kubectl label namespace $your-namesapce istio-injection=enabled</span><br><span class="line">kubectl get namespaces --show-labels</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> pod打标签</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 给名为foo的Pod添加label unhealthy=<span class="literal">true</span></span></span><br><span class="line">kubectl label pods foo unhealthy=true</span><br></pre></td></tr></table></figure>

<h3 id="存储、挂载卷"><a href="#存储、挂载卷" class="headerlink" title="存储、挂载卷"></a>存储、挂载卷</h3><h3 id="expose"><a href="#expose" class="headerlink" title="expose"></a>expose</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl expose  deployment  zentao  --port=8080  --target-port=8080  --type=NodePort --dry-run=client -o yaml </span><br></pre></td></tr></table></figure>



<h3 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h3><p>k8s内的服务，通过<code>kube-proxy</code>进行互访，但是，对外提供服务时，<code>Ingress</code>借助<code>nginx</code>的流量管理功能，能达到7层的流量控制。</p>
<ul>
<li>Nginx官方版本<ul>
<li>Nginx 开源  </li>
<li>Nginx plus</li>
</ul>
</li>
<li>Kuebernetes社区版本</li>
</ul>
<p>对比<code>Service</code>,<code>Ingress</code>增加了功能。</p>
<h3 id="explain"><a href="#explain" class="headerlink" title="explain"></a>explain</h3><p>大概解释，yaml文件的构成。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kubectl explain pods</span><br><span class="line">kubectl explain pods.apiVersion</span><br><span class="line"><span class="meta">#</span><span class="bash">env也可直接定义传递给Pod中容器的环境变量，这点需要记住。</span></span><br><span class="line">kubectl explain pods.spec.containers.env </span><br><span class="line">kubectl explain Deployment</span><br><span class="line">kubectl explain Deployment.spec</span><br><span class="line">kubectl explain Deployment.spec.spec</span><br><span class="line">kubectl explain Deployment.spec.template</span><br><span class="line">kubectl explain Deployment.spec.template.spec</span><br></pre></td></tr></table></figure>





<h3 id="describe"><a href="#describe" class="headerlink" title="describe"></a>describe</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod coredns-5ddb8dc457-2mfzg  -n kube-system</span><br></pre></td></tr></table></figure>





<h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><h3 id="健康检查"><a href="#健康检查" class="headerlink" title="健康检查"></a>健康检查</h3><h3 id="域名dns"><a href="#域名dns" class="headerlink" title="域名dns"></a>域名dns</h3><p>参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d421f864732f">https://www.jianshu.com/p/d421f864732f</a></p>
<p>为集群内的容器增加自定义的dns。核心是修改coredns的配置文件，然后重启服务。</p>
<p> 编辑为以下内容(<strong>添加了hosts块</strong>)</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">Corefile:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">.:53</span> &#123;</span><br><span class="line">        <span class="string">errors</span></span><br><span class="line">        <span class="string">health</span></span><br><span class="line">        <span class="string">kubernetes</span> <span class="string">cluster.local</span> <span class="string">in-addr.arpa</span> <span class="string">ip6.arpa</span> &#123;</span><br><span class="line">          <span class="string">pods</span> <span class="string">insecure</span></span><br><span class="line">          <span class="string">upstream</span></span><br><span class="line">          <span class="string">fallthrough</span> <span class="string">in-addr.arpa</span> <span class="string">ip6.arpa</span></span><br><span class="line">          <span class="string">ttl</span> <span class="number">30</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">hosts</span> &#123;</span><br><span class="line">            <span class="number">10.0</span><span class="number">.0</span><span class="number">.22</span> <span class="string">cos6-data1.test.alltest.com</span></span><br><span class="line">            <span class="number">10.0</span><span class="number">.0</span><span class="number">.23</span> <span class="string">cos6-data2.test.alltest.com</span></span><br><span class="line">            <span class="number">10.0</span><span class="number">.0</span><span class="number">.24</span> <span class="string">cos6-data3.test.alltest.com</span></span><br><span class="line">            <span class="number">10.0</span><span class="number">.0</span><span class="number">.25</span> <span class="string">cos6-data4.test.alltest.com</span></span><br><span class="line">            <span class="number">10.0</span><span class="number">.0</span><span class="number">.26</span> <span class="string">cos6-data5.test.alltest.com</span></span><br><span class="line">            <span class="number">10.0</span><span class="number">.0</span><span class="number">.41</span> <span class="string">cos6-datanode6.test.alltest.com</span></span><br><span class="line">            <span class="number">10.0</span><span class="number">.0</span><span class="number">.42</span> <span class="string">cos6-datanode7.test.alltest.com</span></span><br><span class="line">            <span class="number">10.0</span><span class="number">.0</span><span class="number">.43</span> <span class="string">cos6-datanode8.test.alltest.com</span></span><br><span class="line">            <span class="number">10.0</span><span class="number">.0</span><span class="number">.44</span> <span class="string">cos6-datanode9.test.alltest.com</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">prometheus</span> <span class="string">:9153</span></span><br><span class="line">        <span class="string">forward</span> <span class="string">.</span> <span class="string">&quot;/etc/resolv.conf&quot;</span></span><br><span class="line">        <span class="string">cache</span> <span class="number">30</span></span><br><span class="line">        <span class="string">loop</span></span><br><span class="line">        <span class="string">reload</span></span><br><span class="line">        <span class="string">loadbalance</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubectl.kubernetes.io/last-applied-configuration:</span> <span class="string">|</span></span><br><span class="line">      &#123;<span class="string">&quot;apiVersion&quot;</span><span class="string">:&quot;v1&quot;</span>,<span class="string">&quot;data&quot;</span><span class="string">:</span>&#123;<span class="string">&quot;Corefile&quot;</span><span class="string">:&quot;.:53</span> &#123;<span class="string">\n</span>    <span class="string">errors\n</span>    <span class="string">health\n</span>    <span class="string">kubernetes</span> <span class="string">cluster.local</span> <span class="string">in-addr.arpa</span> <span class="string">ip6.arpa</span> &#123;<span class="string">\n</span>      <span class="string">pods</span> <span class="string">insecure\n</span>      <span class="string">upstream\n</span>      <span class="string">fallthrough</span> <span class="string">in-addr.arpa</span> <span class="string">ip6.arpa\n</span>      <span class="string">ttl</span> <span class="number">30</span><span class="string">\n</span>    &#125;<span class="string">\n</span>    <span class="string">prometheus</span> <span class="string">:9153\n</span>    <span class="string">forward</span> <span class="string">.</span> <span class="string">\&quot;/etc/resolv.conf\&quot;\n</span>    <span class="string">cache</span> <span class="number">30</span><span class="string">\n</span>    <span class="string">loop\n</span>    <span class="string">reload\n</span>    <span class="string">loadbalance\n</span>&#125;<span class="string">\n&quot;</span>&#125;,<span class="string">&quot;kind&quot;</span><span class="string">:&quot;ConfigMap&quot;</span>,<span class="string">&quot;metadata&quot;</span><span class="string">:</span>&#123;<span class="string">&quot;annotations&quot;</span><span class="string">:</span>&#123;&#125;,<span class="string">&quot;labels&quot;</span><span class="string">:</span>&#123;<span class="string">&quot;addonmanager.kubernetes.io/mode&quot;</span><span class="string">:&quot;EnsureExists&quot;</span>&#125;,<span class="string">&quot;name&quot;</span><span class="string">:&quot;coredns&quot;</span>,<span class="string">&quot;namespace&quot;</span><span class="string">:&quot;kube-system&quot;</span>&#125;&#125;</span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="string">&quot;2019-08-19T09:14:15Z&quot;</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">addonmanager.kubernetes.io/mode:</span> <span class="string">EnsureExists</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">coredns</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">resourceVersion:</span> <span class="string">&quot;3231349&quot;</span></span><br><span class="line">  <span class="attr">selfLink:</span> <span class="string">/api/v1/namespaces/kube-system/configmaps/coredns</span></span><br><span class="line">  <span class="attr">uid:</span> <span class="string">b791c47f-c261-11e9-b426-525400116042</span></span><br></pre></td></tr></table></figure>



<p>过程如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 一些准备工作，可不操作</span></span><br><span class="line">kubectl get svc -n kube-system</span><br><span class="line">kubectl get pods -n kube-system</span><br><span class="line">kubectl get svc kube-dns  -n kube-system</span><br><span class="line">kubectl get svc kube-dns  -n kube-system -o yaml</span><br><span class="line">kubectl get deploy  -n kube-system -o yaml</span><br><span class="line">kubectl get deploy  -n kube-system</span><br><span class="line">kubectl get configmap  -n kube-system</span><br><span class="line">kubectl get configmap  coredns -n kube-system</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 pods的数量</span></span><br><span class="line">kubectl get pods -n kube-system</span><br><span class="line">kubectl get pods -n kube-system |grep coredns </span><br><span class="line">kubectl get pods -n kube-system |grep coredns  |wc -l</span><br><span class="line"><span class="meta">#</span><span class="bash"> 备份</span> </span><br><span class="line">kubectl get configmap coredns -n kube-system  -o yaml &gt; coredns.configmap.old</span><br><span class="line">cat  coredns.configmap.old </span><br><span class="line"><span class="meta">#</span><span class="bash"> 编辑，按上面的来编辑，增加hosts语句块</span></span><br><span class="line">kubectl edit configmap coredns -n kube-system</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启服务</span></span><br><span class="line">kubectl scale deployment coredns -n kube-system --replicas=0</span><br><span class="line">kubectl scale deployment coredns -n kube-system --replicas=5</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看服务状态</span></span><br><span class="line">kubectl get pods -n kube-system |grep coredns  </span><br></pre></td></tr></table></figure>

<p>另外一篇，相关文章。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010606397/article/details/90756816">https://blog.csdn.net/u010606397/article/details/90756816</a></p>
<h4 id="记录一次故障"><a href="#记录一次故障" class="headerlink" title="记录一次故障"></a>记录一次故障</h4><p>首先，<code>uat2</code>环境的集群，因为配置了<code>forward . &lt;具体IP&gt;</code>，指定了某台DNS机器，需要恢复成<code>forward . &quot;/etc/resolv.conf&quot;</code>即可满足公司内部的dns解析问题。（猜测，指定的DNS服务器挂了或者换ip了，导致整个集群内部无法正常解析。）</p>
<p>但是，本次的重点，却不是解决上面问题，而是自己升级<code>kubectl apply -f coredns.configmap.old.2</code>的时候，忘记加<code>  -n kube-system</code>，在命令行执行的一半的时候，突然想到，又强制ctrl+c终止了命令，导致后续，无法编辑<code>configMap coredns</code>。</p>
<p>报错信息：</p>
<blockquote>
<p>error: configmaps “coredns” could not be patched: Operation cannot be fulfilled on configmaps “coredns”: the object has been modified; please apply your changes to the latest version and try again<br>You can run <code>kubectl replace -f /tmp/kubectl-edit-500341019.yaml</code> to try this update again.</p>
<p>Error from server (Conflict): error when replacing “/tmp/kubectl-edit-500341019.yaml”: Operation cannot be fulfilled on configmaps “coredns”: the object has been modified; please apply your changes to the latest version and try again</p>
</blockquote>
<p>尝试过以下命令，先删除后重建即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看备份的 yaml文件， /tmp文件可能是  kubectl edit的时候，产生的临时文件。</span></span><br><span class="line">cat /tmp/kubectl-edit-1695226351.yaml </span><br><span class="line">cat coredns.configmap.old</span><br><span class="line">cat coredns.configmap.old.2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用以下各种方式，发现都无法恢复配置。</span></span><br><span class="line">kubectl edit cm coredns  -n kube-system</span><br><span class="line">kubectl replace -f /tmp/kubectl-edit-500341019.yaml</span><br><span class="line">kubectl apply -f coredns.configmap.old.2  -n kube-system</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 故，想到先删除，再重新创建的方法，果然有效</span></span><br><span class="line"><span class="meta">#</span><span class="bash">删除</span></span><br><span class="line">kubectl delete cm coredns  -n kube-system</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新创建</span></span><br><span class="line">kubectl apply -f coredns.configmap.old -n kube-system</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启pods</span></span><br><span class="line"></span><br><span class="line">kubectl rollout restart deploy coredns -n kube-system</span><br><span class="line">kubectl get pods -n kube-system |grep coredns</span><br><span class="line"><span class="meta">#</span><span class="bash"> 另一种方式重启</span></span><br><span class="line">kubectl scale deployment coredns -n kube-system --replicas=0</span><br><span class="line">kubectl scale deployment coredns -n kube-system --replicas=5</span><br><span class="line">kubectl get pods -n kube-system |grep coredns</span><br></pre></td></tr></table></figure>





<h4 id="域名dns切换"><a href="#域名dns切换" class="headerlink" title="域名dns切换"></a>域名dns切换</h4><p>部署的时候，域名策略更换，到底是什么区别呢？公司内，是为了解决dns无法访问的问题。（pod无法fh</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line"><span class="attr">dnsPolicy:</span> <span class="string">Default</span>   <span class="comment"># 切换成这个，才能访问那些局域网自定义的域名</span></span><br></pre></td></tr></table></figure>

<p>备注，上面是deploy的yaml。而不是pod的yaml。直接修改pod的yaml是无法成功的。</p>
<p>dnsPolicy：</p>
<ul>
<li>None</li>
<li>Default</li>
<li>ClusterFirst</li>
<li>ClusterFirstHostNet</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_30747253/article/details/96418569">https://blog.csdn.net/weixin_30747253/article/details/96418569</a></p>
<p>dnsPolicy影响到的是 <code>/etc/resolv.conf</code>配置。</p>
<h4 id="coredns"><a href="#coredns" class="headerlink" title="coredns"></a>coredns</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sandshell/p/11661640.html">https://www.cnblogs.com/sandshell/p/11661640.html</a></p>
<h3 id="configMap"><a href="#configMap" class="headerlink" title="configMap"></a>configMap</h3><p>接上，我们知道<code>coredns</code>的配置，是通过<code>configMap</code>来传进来的，故查看下部署情况，得到如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">get</span> <span class="string">deployment</span>  <span class="string">coredns</span> <span class="string">-n</span> <span class="string">kube-system</span> <span class="string">-o</span> <span class="string">yaml</span></span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">configMap:</span></span><br><span class="line">    <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">    <span class="attr">items:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">Corefile</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">Corefile</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">coredns</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">config-volume</span></span><br></pre></td></tr></table></figure>



<p>给容器内应用程序传递参数的实现方式:</p>
<ol>
<li><p>将配置文件直接打包到镜像中，但这种方式不推荐使用，因为修改配置不够灵活。</p>
</li>
<li><p>通过定义Pod清单时，指定自定义命令行参数，即设定 args:[“命令参数”]，这种也可在启动Pod时，传参来修改Pod的应用程序的配置文件.</p>
</li>
</ol>
<p>　　3. 使用环境变量来给Pod中应用传参修改配置<br>　　 但要使用此种方式，必须符合以下前提之一:<br>　　 1) Pod中的应用程序必须是Cloud Native的应用程序，即支持直接通过环境变量来加载配置信息。<br>　　 2) 通过定义Entrypoint脚本的预处理变量来修改Pod中应用程序的配置文件，这些Entrypoint脚本<br>　　　 可以使用set，sed，grep等工具来实现修改，但也要确保容器中有这些工具。<br>　　4.存储卷: 我们可将配置信息直接放到存储卷中，如PV中,Pod启动时，自动挂载存储卷到配置文件目录，<br>　　 来实现给Pod中应用提供不同的配置。</p>
<ol start="4">
<li>configMap 或 secret</li>
</ol>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45335806/article/details/107314543">https://blog.csdn.net/qq_45335806/article/details/107314543</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/51core/articles/13930848.html">https://www.cnblogs.com/51core/articles/13930848.html</a></p>
<p>两种方式。</p>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NGINX_SERVER_PORT</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">configMapKeyRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">nginx-config</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">nginx_port</span></span><br></pre></td></tr></table></figure>



<h4 id="挂载卷"><a href="#挂载卷" class="headerlink" title="挂载卷"></a>挂载卷</h4><p>如上coredns配置。</p>
<h3 id="节点管理"><a href="#节点管理" class="headerlink" title="节点管理"></a>节点管理</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/erhaiou2008/article/details/104986006">https://blog.csdn.net/erhaiou2008/article/details/104986006</a></p>
<p>停用节点，大概有 cordon&lt;drain&lt;delete 3种方式。暴力程度不一样。</p>
<h4 id="cordon-停止调度"><a href="#cordon-停止调度" class="headerlink" title="cordon 停止调度"></a>cordon 停止调度</h4><p>影响最小，只会将node调为SchedulingDisabled。之后再发创建pod，不会被调度到该节点。旧有的pod不会受到影响，仍正常对外提供服务。</p>
<p><strong>恢复调度</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl uncordon node_name</span><br></pre></td></tr></table></figure>





<h4 id="drain-驱逐节点"><a href="#drain-驱逐节点" class="headerlink" title="drain 驱逐节点"></a>drain 驱逐节点</h4><p>首先，驱逐node上的pod，其他节点重新创建。接着，将节点调为** SchedulingDisabled**</p>
<p><strong>恢复调度</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl uncordon node_name</span><br></pre></td></tr></table></figure>



<ul>
<li><ol>
<li><p>封锁节点，先让节点变的不可调度</p>
<p>kubectl cordon <node name></p>
</li>
</ol>
</li>
<li><ol start="2">
<li>对节点执行维护操作之前（例如：内核升级，硬件维护等），您可以使用 kubectl drain 安全驱逐节点上面所有的 pod。安全驱逐的方式将会允许 pod 里面的容器遵循指定的 PodDisruptionBudgets 执行优雅的中止。注： 默认情况下，kubectl drain 会忽略那些不能杀死的系统类型的 pod。</li>
</ol>
<p>kubectl drain 返回成功表明所有的 pod （除了前面排除的那些）已经被安全驱逐（遵循期望优雅的中止期，并且没有违反任何应用程序级别的中断预算）。</p>
<p>然后，通过对物理机断电或者在云平台上删除节点所在的虚拟机，都能安全的将节点移除。</p>
</li>
<li><ol start="3">
<li> <code>kubectl uncordon &lt;node name&gt;  </code> 恢复调度pod</li>
</ol>
</li>
</ul>
<p>参数：</p>
<p>drain的参数<br>–force<br>当一些pod不是经 ReplicationController, ReplicaSet, Job, DaemonSet 或者 StatefulSet 管理的时候<br>就需要用–force来强制执行 (例如:kube-proxy)</p>
<p>–ignore-daemonsets<br>无视DaemonSet管理下的Pod</p>
<p>–delete-local-data<br>如果有mount local volumn的pod，会强制杀掉该pod并把料清除掉<br>另外如果跟本身的配置讯息有冲突时，drain就不会执行</p>
<h4 id="delete-删除节点"><a href="#delete-删除节点" class="headerlink" title="delete 删除节点"></a>delete 删除节点</h4><p>首先，驱逐node上的pod，其他节点重新创建<br>然后，从master节点删除该node，master对其不可见，失去对其控制，master不可对其恢复</p>
<p>恢复调度，需进入node节点，重启kubelet<br>基于node的自注册功能，节点重新恢复使用<br>systemctl restart kubelet</p>
<p>delete是一个比较粗暴的命令，它会将被删node上的pod直接驱逐，由其他node创建（针对replicaset），然后将被删节点从master管理范围内移除，master对其失去管理控制，若想使node重归麾下，必须在node节点重启kubelet</p>
<h4 id="节点设置"><a href="#节点设置" class="headerlink" title="节点设置"></a>节点设置</h4><p>一个节点上，除了硬件资源的限制，也会有PODS总数的限制，在rancher上主机管理可以看到。</p>
<p>如何更改呢？todo</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/kubernetes/kubelet</span><br><span class="line"><span class="meta">#</span><span class="bash"> 增加</span></span><br><span class="line">MAX_PODS=&quot;--max-pods=61&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启kubelet</span></span><br><span class="line">systemctl  daemon-reload</span><br><span class="line">systemctl restart kubelet</span><br></pre></td></tr></table></figure>

<p>重启，会不会影响到原有的pod？</p>
<p>但是，发现，并没有找到配置。而找到了启动的命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux|grep kubelet</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubelet --cluster-dns=10.43.0.10 --streaming-connection-idle-timeout=30m --event-qps=0 --anonymous-auth=false --max-pods=300 --cloud-provider= --pod-infra-container-image=10.131.9.12:5000/rancher/pause:3.1 --authentication-token-webhook=true --cni-conf-dir=/etc/cni/net.d --network-plugin=cni --v=2 --fail-swap-on=false --root-dir=/var/lib/kubelet --cni-bin-dir=/opt/cni/bin --address=0.0.0.0 --cgroups-per-qos=True --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --hostname-override=10.171.32.20 --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --authorization-mode=Webhook --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --read-only-port=0 --make-iptables-util-chains=true --resolv-conf=/etc/resolv.conf --cluster-domain=cluster.local --volume-plugin-dir=/var/lib/kubelet/volumeplugins --cgroup-driver=cgroupfs</span><br></pre></td></tr></table></figure>

<p>实际上主机上，并没有kubelet命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在work节点上执行  发现并没有</span></span><br><span class="line">docker exec -it kubelet  bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查找</span></span><br><span class="line">ps ef|grep kube</span><br></pre></td></tr></table></figure>

<p>好奇怪。</p>
<h3 id="job"><a href="#job" class="headerlink" title="job"></a>job</h3><p>执行一次的任务。</p>
<p>以下未测试。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">job-name:</span> <span class="string">echo</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">echo</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">suspend:</span> <span class="literal">true</span> <span class="comment"># 1.21+</span></span><br><span class="line">  <span class="attr">ttlSecondsAfterFinished:</span> <span class="number">100</span>      <span class="comment"># Job在执行结束之后（状态为completed或Failed）自动清理。设置为0表示执行结束立即删除，不设置则不会清除，需要开启TTLAfterFinished特性</span></span><br><span class="line">  <span class="attr">backoffLimit:</span> <span class="number">4</span>    <span class="comment"># 如果任务执行失败，失败多少次后不再执行</span></span><br><span class="line">  <span class="attr">completions:</span> <span class="number">1</span>    <span class="comment"># 有多少个Pod执行成功，认为任务是成功的，为空默认和parallelism数值一样</span></span><br><span class="line">  <span class="attr">parallelism:</span> <span class="number">1</span>      <span class="comment"># 并行执行任务的数量，如果parallelism数值大于未完成任务数，只会创建未完成的数量；比如completions是4，并发是3，第一次会创建3个Pod执行任务，第二次只会创建一个Pod执行任务</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">echo</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Hello,</span> <span class="string">Job</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-beijing.aliyuncs.com/dotbalo/busybox</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">echo</span></span><br><span class="line">        <span class="attr">resources:</span> &#123;&#125;</span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br></pre></td></tr></table></figure>



<h3 id="cronjob"><a href="#cronjob" class="headerlink" title="cronjob"></a>cronjob</h3><p>定时执行任务。定时的语法类似于crontab，但是记得，可能有8个小时的时差问题。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">kubectl run hello --schedule=&quot;*/1 * * * *&quot; --restart=OnFailure --image=busybox -- /bin/sh -c &quot;date; echo Hello from the Kubernetes cluster&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看</span></span><br><span class="line">kubectl get cronjob hello</span><br><span class="line"></span><br><span class="line">kubectl get jobs --watch</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">pods=$(kubectl get pods --selector=job-name=hello-4111706356 --output=jsonpath=&#123;.items..metadata.name&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止调度</span></span><br><span class="line">kubectl patch cronjob cronjob-demo -p &#x27;&#123;&quot;spec&quot;:&#123;&quot;suspend&quot;:true&#125;&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>以下未测试。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1beta1</span>                  <span class="comment"># batch/v1beta1 #1.21+ batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">run:</span> <span class="string">hello</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hello</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">concurrencyPolicy:</span> <span class="string">Allow</span>                <span class="comment"># 并发调度策略。可选参数如下</span></span><br><span class="line"><span class="comment"># Allow：允许同时运行多个任务。</span></span><br><span class="line"><span class="comment"># Forbid：不允许并发运行，如果之前的任务尚未完成，新的任务不会被创建。</span></span><br><span class="line"><span class="comment"># Replace：如果之前的任务尚未完成，新的任务会替换的之前的任务。</span></span><br><span class="line">  <span class="attr">failedJobsHistoryLimit:</span> <span class="number">1</span>                <span class="comment"># 保留多少失败的任务</span></span><br><span class="line">  <span class="attr">jobTemplate:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">    <span class="attr">template:</span></span><br><span class="line">      <span class="attr">metadata:</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">run:</span> <span class="string">hello</span></span><br><span class="line">      <span class="attr">spec:</span></span><br><span class="line">        <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">args:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">date;</span> <span class="string">echo</span> <span class="string">Hello</span> <span class="string">from</span> <span class="string">the</span> <span class="string">Kubernetes</span> <span class="string">cluster</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-beijing.aliyuncs.com/dotbalo/busybox</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">hello</span></span><br><span class="line">          <span class="attr">resources:</span> &#123;&#125;</span><br><span class="line">        <span class="attr">restartPolicy:</span> <span class="string">OnFailure</span>             <span class="comment">#  重启策略，和Pod一致</span></span><br><span class="line">        <span class="attr">securityContext:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">&#x27;*/1 * * * *&#x27;</span>               <span class="comment"># 调度周期，和Linux一致，分别是分时日月周。</span></span><br><span class="line">  <span class="attr">successfulJobsHistoryLimit:</span> <span class="number">3</span>          <span class="comment"># 保留多少已完成的任务，按需配置</span></span><br><span class="line">  <span class="attr">suspend:</span> <span class="literal">false</span>                        <span class="comment"># 如果设置为true，则暂停后续的任务，默认为false。</span></span><br></pre></td></tr></table></figure>





<p>Cron Job 也需要 .spec 段。</p>
<p>注意： 对一个 Cron Job 的所有修改，尤其是对其 .spec 的修改，仅会在下一次运行的时候生效。</p>
<ul>
<li>调度</li>
</ul>
<p>.spec.schedule 是 .spec 中必需的字段，它的值是 Cron 格式字的符串，例如：0 * * * *，或者 @hourly，根据指定的调度时间 Job 会被创建和执行。</p>
<ul>
<li>Job 模板</li>
</ul>
<p>.spec.jobTemplate 是另一个 .spec 中必需的字段。它是 Job 的模板。 除了它可以是嵌套的，并且不具有 apiVersion 或 kind 字段之外，它和 Job 一样具有完全相同的模式(schema)。 参考 编写 Job 规格。</p>
<ul>
<li>启动 Job 的期限(秒级别)</li>
</ul>
<p>.spec.startingDeadlineSeconds 字段是可选的。它表示启动 Job 的期限(秒级别)，如果因为任何原因而错过了被调度的时间，那么错过执行时间的 Job 将被认为是失败的。如果没有指定，则没有期限。</p>
<ul>
<li>并发策略</li>
</ul>
<p>.spec.concurrencyPolicy 字段也是可选的。它指定了如何处理被 Cron Job 创建的 Job 的并发执行。只允许指定下面策略中的一种：Allow(默认)：允许并发运行 Job</p>
<blockquote>
<ul>
<li><p>Forbid：禁止并发运行，如果前一个还没有完成，则直接跳过下一个</p>
</li>
<li><p>Replace：取消当前正在运行的 Job，用一个新的来替换</p>
</li>
</ul>
</blockquote>
<p>注意，当前策略只能应用于同一个 Cron Job 创建的 Job。如果存在多个 Cron Job，它们创建的 Job 之间总是允许并发运行。</p>
<ul>
<li>挂起</li>
</ul>
<p>.spec.suspend 字段也是可选的。如果设置为 true，后续所有执行都将被挂起。它对已经开始执行的 Job 不起作用。默认值为 false。</p>
<ul>
<li>Job 历史限制</li>
</ul>
<p>.spec.successfulJobsHistoryLimit 和 .spec.failedJobsHistoryLimit 这两个字段是可选的。它们指定了可以保留完成和失败 Job 数量的限制。(影响的是日志历史的数量)</p>
<p>默认没有限制，所有成功和失败的 Job 都会被保留。然而，当运行一个 Cron Job 时，很快就会堆积很多 Job，推荐设置这两个字段的值。设置限制值为 0，相关类型的 Job 完成后将不会被保留。</p>
<p>查看链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_34827675/article/details/113006116">https://blog.csdn.net/weixin_34827675/article/details/113006116</a></p>
<p>todo：如何查看历史日志？</p>
<h3 id="clusterrolebinding"><a href="#clusterrolebinding" class="headerlink" title="clusterrolebinding"></a>clusterrolebinding</h3><p>集群角色绑定？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看最近的操作变化</span></span><br><span class="line">kubectl get clusterrolebinding |sort -nk2|head -30</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看具体某1个</span></span><br><span class="line">kubectl get clusterrolebinding clusterrolebinding-wvh6b -o yaml</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: &quot;2022-02-16T03:36:04Z&quot;</span><br><span class="line">  generateName: clusterrolebinding-</span><br><span class="line">  labels:</span><br><span class="line">    authz.cluster.cattle.io/rtb-owner: 91c11454-8ed9-11ec-b963-0242ac110002</span><br><span class="line">    cattle.io/creator: norman</span><br><span class="line">  name: clusterrolebinding-wvh6b</span><br><span class="line">  resourceVersion: &quot;380506132&quot;</span><br><span class="line">  selfLink: /apis/rbac.authorization.k8s.io/v1/clusterrolebindings/clusterrolebinding-wvh6b</span><br><span class="line">  uid: 332b4804-fbf2-46a3-afef-30f4b42217c9</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: cluster-owner</span><br><span class="line">subjects:</span><br><span class="line">- apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: User</span><br><span class="line">  name: u-lkemscnixo</span><br></pre></td></tr></table></figure>





<h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><h3 id="部署脚本"><a href="#部署脚本" class="headerlink" title="部署脚本"></a>部署脚本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 镜像扫描测试</span></span><br><span class="line">kubectl run a01-order-a11-center --port=80 --image= --env=&quot;a=1&quot; --env=&quot;b=z01&quot; </span><br><span class="line">kubectl expose deployment a01-order-a11-center</span><br><span class="line">kubectl patch svc a01-order-a11-center -p &#x27;&#123;&quot;spec&quot;:&#123;&quot;type&quot;:&quot;NodePort&quot;&#125;&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="备份脚本"><a href="#备份脚本" class="headerlink" title="备份脚本"></a>备份脚本</h3><p>针对各个命名空间，进行备份。两种方式。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">for ns in $(kubectl get ns |awk &#x27;NR&gt;1&#123;print $1&#125;&#x27;)</span><br><span class="line">do</span><br><span class="line">    for n in $(kubectl get -o=name all -n $ns)</span><br><span class="line">    #for n in $(kubectl get -o=name pvc,configmap,serviceaccount,secret,ingress,service,deployment,statefulset,hpa,job,cronjob -n $ns)</span><br><span class="line">    do</span><br><span class="line">        mkdir -p $ns/$(dirname $n)</span><br><span class="line">        echo kubectl get -o=yaml  $n -n $ns </span><br><span class="line">        kubectl get -o=yaml $n -n $ns &gt; $ns/$n.yaml</span><br><span class="line">    done</span><br><span class="line">done </span><br></pre></td></tr></table></figure>





<h3 id="停资源"><a href="#停资源" class="headerlink" title="停资源"></a>停资源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for each in $(kubectl get deployments |tail -n 200  |awk &#x27;&#123;print $1&#125;&#x27; ); </span><br><span class="line">do </span><br><span class="line">    echo kubectl scale deployment  $each     --replicas=0; </span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="修改命名空间"><a href="#修改命名空间" class="headerlink" title="修改命名空间"></a>修改命名空间</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo kubectl  delete  -f $each  -n default </span><br><span class="line">echo sed  -i \&quot;s/ default/ $name/g\&quot;   $each </span><br><span class="line">echo sed -i \&quot;s/$name-scheduler/default-scheduler/g\&quot;   $each</span><br><span class="line">echo kubectl create -f    $each  -n  $( cat  /tmp/project ) </span><br></pre></td></tr></table></figure>

<h3 id="切换配置文件"><a href="#切换配置文件" class="headerlink" title="切换配置文件"></a>切换配置文件</h3><p>放到<code>~/.bash_profile</code>中</p>
<p><code>k8s env</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias kse=&#x27;f()&#123; /usr/bin/cp ~/.kube/$1-config ~/.kube/config;echo $1;&#125;;f&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="获取集群状态"><a href="#获取集群状态" class="headerlink" title="获取集群状态"></a>获取集群状态</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -A |awk &#x27;NR&gt;1&#123;arr[$4]+=1&#125;END&#123;for(n in arr)&#123;printf &quot;%30-s\t%5d\n&quot; ,n,arr[n]&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>





<h2 id="REST-API"><a href="#REST-API" class="headerlink" title="REST API"></a>REST API</h2><p>因为k8s采用的是REST API接口，所有命令都最终会转换成curl -X PUT POS导形式，为什么不直接使用curl命令，因为需要一堆相关授权，rancher Ul里面在deploy或其他资源中，选择api查看就可以查到，也可以点击右侧的edit编辑后通过curl命令提交。</p>
<p>以下仅为示例。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpCurl</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span>, <span class="variable">$accessToken</span></span>) </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$headers</span>[]  =  <span class="string">&quot;Content-Type:application/json&quot;</span>;</span><br><span class="line">        <span class="variable">$headers</span>[]  =  <span class="string">&quot;Authorization: Bearer &quot;</span>. <span class="variable">$accessToken</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$defaults</span> = <span class="keyword">array</span>(</span><br><span class="line">            CURLOPT_URL =&gt; <span class="variable">$url</span>,</span><br><span class="line">            CURLOPT_HEADER =&gt; <span class="number">0</span>,</span><br><span class="line">            CURLOPT_RETURNTRANSFER =&gt; <span class="literal">TRUE</span>,</span><br><span class="line">            CURLOPT_SSL_VERIFYPEER =&gt; <span class="literal">FALSE</span>,</span><br><span class="line">            CURLOPT_SSL_VERIFYHOST =&gt; <span class="literal">FALSE</span>,</span><br><span class="line">            CURLOPT_TIMEOUT =&gt; <span class="number">5</span>,</span><br><span class="line">            CURLOPT_HTTPHEADER =&gt; <span class="variable">$headers</span>,</span><br><span class="line">            CURLOPT_USERAGENT =&gt; <span class="string">&#x27;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.0.3705; .NET CLR 1.1.4322)&#x27;</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="variable">$ch</span> = curl_init();</span><br><span class="line">        curl_setopt_array(<span class="variable">$ch</span>, <span class="variable">$defaults</span>);</span><br><span class="line">        <span class="keyword">if</span>( ! <span class="variable">$result</span> = curl_exec(<span class="variable">$ch</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            trigger_error(curl_error(<span class="variable">$ch</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        curl_close(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params"><span class="variable">$url</span>, <span class="variable">$params</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$headers</span>[]  =  <span class="string">&quot;Content-Type:application/json;charset=&#x27;utf-8&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$ch</span> = curl_init();</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_POST, <span class="literal">true</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_SSL_VERIFYPEER ,<span class="literal">false</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_SSL_VERIFYHOST ,<span class="literal">false</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="literal">true</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_CONNECTTIMEOUT, <span class="number">30</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_POSTFIELDS, <span class="variable">$params</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_HTTPHEADER, <span class="variable">$headers</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$ret</span> = curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="keyword">if</span>(curl_error(<span class="variable">$ch</span>))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="built_in">Exception</span>(<span class="string">&#x27;请求异常&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        curl_close(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="keyword">return</span> json_decode(<span class="variable">$ret</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$host</span> = <span class="string">&#x27;https://主机ip:6443&#x27;</span>;</span><br><span class="line"><span class="variable">$namespace</span> = <span class="string">&#x27;命名空间&#x27;</span>;</span><br><span class="line"><span class="variable">$deploy_name</span> = <span class="string">&#x27;容器名称&#x27;</span>;</span><br><span class="line"><span class="variable">$token</span> = <span class="string">&#x27;kubeconfig-u-开头&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$host</span> .<span class="string">&#x27;/api/v1/namespaces/&#x27;</span> . <span class="variable">$namespace</span> . <span class="string">&#x27;/pods?labelSelector=app=&#x27;</span>.<span class="variable">$deploy_name</span>;; </span><br><span class="line"><span class="variable">$tmp</span> = HttpCurl::get(<span class="variable">$url</span>, <span class="variable">$token</span>);</span><br><span class="line">var_dump(<span class="variable">$tmp</span>);</span><br></pre></td></tr></table></figure>





<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="解决-输入kubectl-get-pods-o-wide后没有显示ip"><a href="#解决-输入kubectl-get-pods-o-wide后没有显示ip" class="headerlink" title="解决 输入kubectl get pods -o wide后没有显示ip"></a>解决 输入kubectl get pods -o wide后没有显示ip</h3><p>我在集群的master没有找到下面两个文件，但是master节点<code>/etc/kubernetes</code>找到了很多配置文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 部署calico  重新执行这两句就好了 /etc/kubernetes/addons 是你自己的目录 不要用我的目录</span></span><br><span class="line">kubectl apply -f /etc/kubernetes/addons/calico-rbac-kdd.yaml </span><br><span class="line">kubectl apply -f /etc/kubernetes/addons/calico.yaml</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/k8s/" rel="tag"># k8s</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/02/11/install/%E7%88%B1%E5%BF%AB%E5%AE%89%E8%A3%85/" rel="prev" title="爱快安装">
                  <i class="fa fa-chevron-left"></i> 爱快安装
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/02/17/other/sshd%E9%98%B2%E6%AD%A2%E7%88%86%E7%A0%B4/" rel="next" title="sshd防止爆破.sh">
                  sshd防止爆破.sh <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chaofml</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  







  






</body>
</html>
