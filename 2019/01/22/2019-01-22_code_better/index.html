<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.chaofml.cn","root":"/","images":"/images","scheme":"Muse","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>
<meta name="description" content="会议预约代码改进前言 写程序的时候，要知道代码的前提条件是什么。比如，开根号，就应该想到，我可能用到的数可能为负数。所以，需要先验证。（至于验证在哪进行，是开根号函数定义还是调用，视情况而定。）所以这些，才能保证程序的健壮性。  常用策略使用变量替代复杂的表达式 一个表达式、多个逻辑值求值或函数调用等反复引用，应该起一个有一定含义的名字，作为一个变量来使用。这样能简化代码。如检查是否是特权用户。使">
<meta property="og:type" content="article">
<meta property="og:title" content="会议预约代码改进">
<meta property="og:url" content="https://blog.chaofml.cn/2019/01/22/2019-01-22_code_better/index.html">
<meta property="og:site_name" content="超凡魔力">
<meta property="og:description" content="会议预约代码改进前言 写程序的时候，要知道代码的前提条件是什么。比如，开根号，就应该想到，我可能用到的数可能为负数。所以，需要先验证。（至于验证在哪进行，是开根号函数定义还是调用，视情况而定。）所以这些，才能保证程序的健壮性。  常用策略使用变量替代复杂的表达式 一个表达式、多个逻辑值求值或函数调用等反复引用，应该起一个有一定含义的名字，作为一个变量来使用。这样能简化代码。如检查是否是特权用户。使">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-01-22T17:36:00.000Z">
<meta property="article:modified_time" content="2023-01-20T05:51:57.948Z">
<meta property="article:author" content="chaofml">
<meta property="article:tag" content="个人博客、超凡魔力">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.chaofml.cn/2019/01/22/2019-01-22_code_better/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<title>会议预约代码改进 | 超凡魔力</title>
  



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">超凡魔力</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">君子善思，善假于物，而不物于物。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BC%9A%E8%AE%AE%E9%A2%84%E7%BA%A6%E4%BB%A3%E7%A0%81%E6%94%B9%E8%BF%9B"><span class="nav-number">1.</span> <span class="nav-text">会议预约代码改进</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E7%AD%96%E7%95%A5"><span class="nav-number">1.2.</span> <span class="nav-text">常用策略</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%98%E9%87%8F%E6%9B%BF%E4%BB%A3%E5%A4%8D%E6%9D%82%E7%9A%84%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">1.2.1.</span> <span class="nav-text">使用变量替代复杂的表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E7%9A%84%E5%8F%98%E9%87%8F%E6%88%96%E8%80%85%E9%80%BB%E8%BE%91%E5%BA%94%E8%AF%A5%E6%8A%BD%E8%B1%A1%E6%88%90%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%B0%81%E8%A3%85%E5%9C%A8%E4%B8%80%E8%B5%B7%E3%80%82"><span class="nav-number">1.2.2.</span> <span class="nav-text">相关的变量或者逻辑应该抽象成对象，封装在一起。</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%B1%95%E7%A4%BA"><span class="nav-number">1.3.</span> <span class="nav-text">代码展示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E6%98%BE%E7%A4%BA"><span class="nav-number">1.3.1.</span> <span class="nav-text">时间显示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A2%9E%E5%8A%A0%E8%BE%93%E5%85%A5%E5%8F%98%E5%8C%96%E6%97%B6%EF%BC%8Cchange%E4%BA%8B%E4%BB%B6%E7%9A%84%E5%93%8D%E5%BA%94%E3%80%82"><span class="nav-number">1.3.2.</span> <span class="nav-text">增加输入变化时，change事件的响应。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%E5%89%8D%E7%9A%84%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81"><span class="nav-number">1.3.3.</span> <span class="nav-text">表单提交前的数据验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%9D%E8%AF%B4%EF%BC%8C%E4%B8%8D%E6%AD%BB%E5%B8%83%E5%B1%80%E7%9C%9F%E5%BE%97%E4%B8%8D%E5%A5%BD%E7%94%A8%E3%80%82"><span class="nav-number">1.3.4.</span> <span class="nav-text">话说，不死布局真得不好用。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B6%85%E7%BA%A7%E7%94%A8%E6%88%B7%E7%AD%89%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%9B%B4%E6%94%B9%E6%AD%A3%E5%9C%A8%E8%BF%9B%E8%A1%8C%E4%B8%AD%E7%9A%84%E4%BC%9A%E8%AE%AE"><span class="nav-number">1.3.5.</span> <span class="nav-text">超级用户等，可以更改正在进行中的会议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%B0%E5%9C%A8%E6%97%B6%E9%97%B4%EF%BC%8C%E5%A2%9E%E5%8A%A0%E4%BC%9A%E8%AE%AE%E8%AF%A6%E6%83%85"><span class="nav-number">1.3.6.</span> <span class="nav-text">现在时间，增加会议详情</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86%E7%99%BB%E5%BD%95%E7%9A%84%E6%95%B0%E6%8D%AE%E4%BF%9D%E5%AD%98%E8%B5%B7%E6%9D%A5"><span class="nav-number">1.3.7.</span> <span class="nav-text">将登录的数据保存起来</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%9A%E8%AE%AE%E9%A2%84%E7%BA%A6%E5%90%8E%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA%E5%8A%9F%E8%83%BD"><span class="nav-number">1.3.8.</span> <span class="nav-text">会议预约后台数据导出功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%96%E6%B6%88%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96"><span class="nav-number">1.3.9.</span> <span class="nav-text">取消代码优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%94%B9radio%E7%9A%84%E9%A2%9C%E8%89%B2"><span class="nav-number">1.3.10.</span> <span class="nav-text">更改radio的颜色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%90%E4%BA%A4%E5%A4%B1%E8%B4%A5"><span class="nav-number">1.3.11.</span> <span class="nav-text">提交失败</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E6%97%B6%E9%97%B4%E7%9A%84tbar%E6%A0%87%E7%AD%BE%E7%9A%84%E5%AE%BD%E5%BA%A6%E6%A0%B7%E5%BC%8F"><span class="nav-number">1.3.12.</span> <span class="nav-text">选择时间的tbar标签的宽度样式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96toast%E6%95%88%E6%9E%9C"><span class="nav-number">1.3.13.</span> <span class="nav-text">优化toast效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E6%B3%84%E6%BC%8F%E7%9A%84%E5%8F%98%E9%87%8F"><span class="nav-number">1.3.14.</span> <span class="nav-text">查找泄漏的变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD"><span class="nav-number">1.3.15.</span> <span class="nav-text">条件判断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#store%E5%8A%A0%E8%BD%BD%E6%8B%A6%E6%88%AA"><span class="nav-number">1.3.16.</span> <span class="nav-text">store加载拦截</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E9%83%A8%E9%97%A8%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%E6%97%B6%EF%BC%8C%E5%AF%BC%E8%87%B4%E6%AD%BB%E5%BE%AA%E7%8E%AF"><span class="nav-number">2.</span> <span class="nav-text">获取部门树形结构时，导致死循环</span></a></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">chaofml</p>
  <div class="site-description" itemprop="description">思绪偶尔会在这里停留</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">369</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.chaofml.cn/2019/01/22/2019-01-22_code_better/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chaofml">
      <meta itemprop="description" content="思绪偶尔会在这里停留">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="超凡魔力">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          会议预约代码改进
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-01-22 17:36:00" itemprop="dateCreated datePublished" datetime="2019-01-22T17:36:00+00:00">2019-01-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2023-01-20 05:51:57" itemprop="dateModified" datetime="2023-01-20T05:51:57+00:00">2023-01-20</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="会议预约代码改进"><a href="#会议预约代码改进" class="headerlink" title="会议预约代码改进"></a>会议预约代码改进</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>写程序的时候，要知道代码的前提条件是什么。比如，开根号，就应该想到，我可能用到的数可能为负数。所以，需要先验证。（至于验证在哪进行，是开根号函数定义还是调用，视情况而定。）所以这些，才能保证程序的健壮性。</p>
</blockquote>
<h2 id="常用策略"><a href="#常用策略" class="headerlink" title="常用策略"></a>常用策略</h2><h3 id="使用变量替代复杂的表达式"><a href="#使用变量替代复杂的表达式" class="headerlink" title="使用变量替代复杂的表达式"></a>使用变量替代复杂的表达式</h3><blockquote>
<p>一个表达式、多个逻辑值求值或函数调用等反复引用，应该起一个有一定含义的名字，作为一个变量来使用。这样能简化代码。如检查是否是特权用户。使用super变量，真：特权。假：非特权。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">$super&#x3D;in_array($user-&gt;role_id,array(1,3));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="相关的变量或者逻辑应该抽象成对象，封装在一起。"><a href="#相关的变量或者逻辑应该抽象成对象，封装在一起。" class="headerlink" title="相关的变量或者逻辑应该抽象成对象，封装在一起。"></a>相关的变量或者逻辑应该抽象成对象，封装在一起。</h3><blockquote>
<p>如初始化的变量</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;下面整体应该保存到一个变量，就不用这么麻烦。
&#x2F;&#x2F;var origin&#x3D; rdData;&#x2F;&#x2F;只要这一句就ok。
me.originalMeetingdate&#x3D;me.meetingdate &#x3D; rdData[&#39;meeting_date&#39;];&#x2F;&#x2F;保存初始值
me.originalStarttime&#x3D;me.starttime &#x3D; rdData[&#39;starttime&#39;];    &#x2F;&#x2F;保存初始值
me.originalStoptime&#x3D;me.stoptime &#x3D; rdData[&#39;stoptime&#39;];       &#x2F;&#x2F;保存初始值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a>代码展示</h2><h3 id="时间显示"><a href="#时间显示" class="headerlink" title="时间显示"></a>时间显示</h3><pre class="line-numbers language-none"><code class="language-none">&#123;&#x2F;&#x2F;第二块
    xtype:&#39;menublockpanel&#39;,&#x2F;&#x2F;仅显示
    items:[&#123;
	xtype:&#39;selecttextfield&#39;,
	bind:&#123;
	    &#x2F;&#x2F; value:&quot;&#123;meeting_date&#125;　　&#123;starttime&#125;-&#123;stoptime&#125;&quot; &#x2F;&#x2F;注意这种方式，如果三个字段为空的话，那么还是会有内容，空格+&#39;-&#39;号
	    &#x2F;&#x2F;而下面是一种改进，如果meeting_date没有内容，直接显示的就为空的内容。这样就能显示emptyText:&#39;请选择会议召开时间。&#39;,
	    &#x2F;&#x2F;另外需关注：字符串能运算。当然下面的代码也能放到viewModel中，能使用公式来计算。但是没有此方法简单。
	    value:&#39;&#123;meeting_date?meeting_date+&quot;　　&quot;+starttime+&quot;-&quot;+stoptime:&quot;&quot;&#125;&#39;
	&#125;,
	submitValue:false,
	fieldLabel:Ext.String.format(DIC.labelString,5,&#39;时间&#39;),
	emptyText:&#39;请选择会议召开时间。&#39;,
	setItemIndex:4,
	needRoom:true
    &#125;]
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="增加输入变化时，change事件的响应。"><a href="#增加输入变化时，change事件的响应。" class="headerlink" title="增加输入变化时，change事件的响应。"></a>增加输入变化时，change事件的响应。</h3><blockquote>
<p>在MenuBlockPanel中，集中的为子items设置默认的change属性。先判断setItemIndex是否为1，即先判断是否需要输入提醒。如果确定有，则进行相应的正确、错误提醒。这个在后期还能优化，如正则验证后，相应的提示。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">listeners:&#123;
    &#39;focus&#39;:function(cmp, event, eOpts)&#123;
	var meetingordermenu&#x3D;cmp.up(&#39;meetingordermenu&#39;);
	ShineMessageHub.fireEvent(&#39;meetingordermenuinputfocus&#39;,cmp,meetingordermenu,event, eOpts);
    &#125;,
    &#39;change&#39;:function(cmp, newValue, oldValue, eOpts )&#123;
	if(cmp.setItemIndex!&#x3D;&#x3D;1)&#123;
	    return ;
	&#125;
	var o;
	if(newValue)&#123;
	    o&#x3D;&#123;icon:&#39;pass&#39;&#125;;
	&#125;else&#123;
	    o&#x3D;&#123;icon:&#39;warning&#39;&#125;;
	&#125;
	ShineMessageHub.fireEvent(&#39;meetingordersettingcontainersetviewmodelevent&#39;,o);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="表单提交前的数据验证"><a href="#表单提交前的数据验证" class="headerlink" title="表单提交前的数据验证"></a>表单提交前的数据验证</h3><blockquote>
<p>先进行空的判断，然后再进行valid的正则验证等。如果输入错误，则进行提示相应的内容。</p>
</blockquote>
<h3 id="话说，不死布局真得不好用。"><a href="#话说，不死布局真得不好用。" class="headerlink" title="话说，不死布局真得不好用。"></a>话说，不死布局真得不好用。</h3><blockquote>
<p>不死布局，真的不好用，上一次操作的记录，如果不能完全清空。对下一次的操作影响真得很大。为了这个缺点，每次都要进行初始化工作。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;添加会议时，设置默认项
ShineMessageHub.on(&quot;meetingorderhomeaddevent&quot;,function(rdData)&#123;
    me.meetingdate &#x3D; rdData[&#39;meeting_date&#39;];
    me.starttime &#x3D; rdData[&#39;starttime&#39;];
    me.stoptime &#x3D; rdData[&#39;stoptime&#39;];
    me.conference_room_id &#x3D; rdData[&#39;conference_room_id&#39;];
    me.meeting_id &#x3D; rdData[&#39;meeting_id&#39;];
    me.displayStart&#x3D;Ext.Date.format(new Date(),&#39;Y-m-d&#39;);
    me.ajaxGetOccupy();
    me.idx&#x3D;-1;&#x2F;&#x2F;这个记录了上一次操作的点。结果这个东西，没有重置。
&#125;,me);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="超级用户等，可以更改正在进行中的会议"><a href="#超级用户等，可以更改正在进行中的会议" class="headerlink" title="超级用户等，可以更改正在进行中的会议"></a>超级用户等，可以更改正在进行中的会议</h3><blockquote>
<p>更新需求。超级用户可以修改正在进行中的会议，可以修改任何内容。由于之前，创建的时候，时间如果过期了，就不可选。现在还要可选。像这样的需求，首先要明白，这相当于开了一个口子。这个口子开多大，要根据实际情况定。</p>
</blockquote>
<blockquote>
<p>如本例中，肯定要修改，会议当天的时间，而且如果换了会议室，这个口子就不要看了。所以还需要保存，会议室的id。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">&#39;storeloaddata&#39;:function(dataview,store)&#123;
    var me&#x3D;this;
    console.log(me.starttime);
    var indexs&#x3D;[me.getTimeListIndex(me.starttime),me.getTimeListIndex(me.stoptime)-1];
    var oindexs&#x3D;[me.getTimeListIndex(me.originalStarttime),me.getTimeListIndex(me.originalStoptime)-1];
    store.each(function(rd)&#123;
	&#x2F;&#x2F;编辑会议时，之前的时间可编辑
	&#x2F;&#x2F;if(me.originalMeetingdate&amp;&amp;rd.get(&#39;meetingdate&#39;)&#x3D;&#x3D;me.originalMeetingdate)&#123;
	&#x2F;&#x2F;注意，下面的条件进行了增强，要求是修改前的会议室id，才允许此特例。
	if(me.originalMeetingdate&amp;&amp;me.originalRoomId&#x3D;&#x3D;me.conference_room_id&amp;&amp;rd.get(&#39;meetingdate&#39;)&#x3D;&#x3D;me.originalMeetingdate)&#123;
	    var lis&#x3D;rd.get(&#39;timelist&#39;);
	    for(var i&#x3D;oindexs[0];i&lt;&#x3D;oindexs[1];i++)&#123;
		if(lis[i].status&#x3D;&#x3D;1)&#123;
		    lis[i].status&#x3D;0;
		&#125;
	    &#125;
	    rd.set(&#123;timelist:lis&#125;);
	    rd.commit();
	&#125;
	&#x2F;&#x2F;上面的代码，相当于开了一个口子。在会议修改时，有originalMeetingdate，
	&#x2F;&#x2F;然后针对这一天，如果时间过期了，强制更新为状态0，即时间可用。而且这个应该还跟会议室相关。
	&#x2F;&#x2F;如果更换了会议室，上面的代码应该不执行的。
	
	if(rd.get(&#39;meetingdate&#39;)&#x3D;&#x3D;me.meetingdate)&#123;
	    var lis&#x3D;rd.get(&#39;timelist&#39;);
	    for(var i&#x3D;indexs[0];i&lt;&#x3D;indexs[1];i++)&#123;
		if(lis[i].status!&#x3D;0)&#123;
		    Ext.toast(&#39;当前选择时间段不可用，请重新选择。&#39;);
		    return ;
		&#125;
	    &#125;
	    me.setSelectStyle(rd,indexs);
	&#125;
    &#125;);
&#125;,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>需要将会议的初始的originalMeetingdate、originalRoomId等信息保存起来。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none"> &#x2F;&#x2F;添加会议时，设置默认项
ShineMessageHub.on(&quot;meetingorderhomeaddevent&quot;,function(rdData)&#123;
    me.originalMeetingdate&#x3D;me.meetingdate &#x3D; rdData[&#39;meeting_date&#39;];&#x2F;&#x2F;保存初始值
    me.originalStarttime&#x3D;me.starttime &#x3D; rdData[&#39;starttime&#39;];    &#x2F;&#x2F;保存初始值
    me.originalStoptime&#x3D;me.stoptime &#x3D; rdData[&#39;stoptime&#39;];       &#x2F;&#x2F;保存初始值
    me.originalRoomId&#x3D;me.conference_room_id &#x3D; rdData[&#39;conference_room_id&#39;];   &#x2F;&#x2F;保存初始值
    me.meeting_id &#x3D; rdData[&#39;meeting_id&#39;];
    me.displayStart&#x3D;Ext.Date.format(new Date(),&#39;Y-m-d&#39;);
    me.ajaxGetOccupy();
    me.idx&#x3D;-1;
&#125;,me);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="现在时间，增加会议详情"><a href="#现在时间，增加会议详情" class="headerlink" title="现在时间，增加会议详情"></a>现在时间，增加会议详情</h3><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;info.desc变量比较简单，没有空格分隔，
&#x2F;&#x2F;其实不加引号也没有问题。但是如果有空格等，就多了引号，显示就不正常了。
 title&#x3D;&quot;&#123;info.desc&#125;&quot;
 &#x2F;&#x2F;简单形式,要求变量没有空格等。则显示也没有问题。  title&#x3D;&#123;info.desc&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>完整的模板代码，如下</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">tpl:[
    &#39;&lt;div class&#x3D;&quot;selecttimepanel-right-box&quot;&gt;&#39;,
	&#39;&lt;div class&#x3D;&quot;arrow left-arrow&quot;&gt;&lt;&#x2F;div&gt;&#39;,
	&#39;&lt;tpl for&#x3D;&quot;.&quot;&gt;&#39;,
	&#39;&lt;div class&#x3D;&quot;selecttimepanelchoseitemCls&quot;&gt;&lt;table&gt;&#39;,
	    &#39;&lt;tr&gt;&lt;th&gt;&#123;displaydate&#125;&lt;&#x2F;th&gt;&lt;&#x2F;tr&gt;&#39;,
	    &#39;&lt;tpl for&#x3D;&quot;timelist&quot;&gt;&#39;,
	    &#39;&lt;tr&gt;&#39;,
		&#39;&lt;td dataref&#x3D;&#123;index&#125; &#123;[values.selected?&quot;class&#x3D;selecttimepanel-selected&quot;:&quot;&quot;]&#125; &#123;[values.status&#x3D;&#x3D;1?&quot;class&#x3D;selecttimepanel-expired&quot;:&quot;&quot;]&#125; &#123;[values.status&#x3D;&#x3D;2?&quot;class&#x3D;selecttimepanel-occupy&quot;:&quot;&quot;]&#125; title&#x3D;&quot;&#123;info.desc&#125;&quot;&gt;&#39;,
		    &#39;&#123;info.employee_name&#125;&#39;,
		&#39;&lt;&#x2F;td&gt;&#39;,
	    &#39;&lt;&#x2F;tr&gt;&#39;,
	    &#39;&lt;&#x2F;tpl&gt;&#39;,
	&#39;&lt;&#x2F;table&gt;&lt;&#x2F;div&gt;&#39;,
	&#39;&lt;&#x2F;tpl&gt;&#39;,
	&#39;&lt;div class&#x3D;&quot;arrow right-arrow&quot;&gt;&lt;&#x2F;div&gt;&#39;,
    &#39;&lt;&#x2F;div&gt;&#39;,
],<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>在模板里面进行比较麻烦，直接在store加载数据的时候，进行处理。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;计算时间是否占用
if(status&#x3D;&#x3D;&#x3D;0)&#123;
    var occupy&#x3D;me.isOccupy(items,start,stop);
    if(occupy!&#x3D;&#x3D;false)&#123;
	status&#x3D;2;
	info&#x3D;occupy;
	&#x2F;&#x2F;将所有的计算，在此进行，组合成一个字段。这样在模板里面，就没有复杂的允许。
	&#x2F;&#x2F;看起来也比较简洁。
	info.desc&#x3D;&#39;名称：&#39;+info.meeting_name+&#39;；时间：&#39;+info.starttime+&#39;至&#39;+info.stoptime;
	console.log(info.desc);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>后台增加代码</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;修改
$sql&#x3D;&quot;select meeting.user_id,employee_name,meeting_name,starttime,stoptime from meeting &quot;.
	&#39;LEFT JOIN USER ON &#96;user&#96;.user_id &#x3D; meeting.user_id &#39;.
	&quot;where starttime&gt;&#39;$startStamp&#39; and starttime&lt;&#39;$stopStamp&#39; and status in(0,1) $where &quot;.
	&quot;order by starttime asc&quot;;
&#x2F;&#x2F;原始
$sql&#x3D;&quot;select meeting_name,starttime,stoptime from meeting &quot;.
	&quot;where starttime&gt;&#39;$startStamp&#39; and starttime&lt;&#39;$stopStamp&#39; and status in(0,1) $where &quot;.
	&quot;order by starttime asc&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="将登录的数据保存起来"><a href="#将登录的数据保存起来" class="headerlink" title="将登录的数据保存起来"></a>将登录的数据保存起来</h3><p>其实这个问题，并不是问题。只是当初设计的时候，根本没有想到这个东西，会共用。反复的初始化同一个组件，没有这个必要。应该在6个模块中，共有一个标题头实例。这样，一个更新，其他的也就更新了。但是框架已经写好了。就懒得动了。</p>
<blockquote>
<p>将Ajax获取到的数据保存起来</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">getLoginUser:function()&#123;
var me &#x3D; this;
Ext.Ajax.request(&#123;
		url: SHINEVMSHTTP +&#39;&#x2F;admin&#x2F;default&#x2F;index&#x2F;checklogin&#39;,
    success: function(response, opts) &#123;
			var obj &#x3D; Ext.decode(response.responseText);
	console.log(obj);
	if(obj&amp;&amp;obj.user&amp;&amp;obj.user.employee_name)&#123;
	    me.employee_name&#x3D;obj.user.employee_name;&#x2F;&#x2F;在这一步，将数据保存起来。
	    &#x2F;&#x2F;后面这个发消息，需要相应的组件存在才行。
	    ShineMessageHub.fireEvent(&quot;mainmeetingtitlebarsetviewmodelevent&quot;,&#123;&#39;userName&#39;:obj.user.employee_name&#125;);
	&#125;
    &#125;,
    failure: function(response, opts) &#123;
	console.log(&#39;网络异常 &#39; + response.status);
    &#125;
	&#125;);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>主页点击事件，进行了拦截</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">if(record.data.id&#x3D;&#x3D;2 ||record.data.id&#x3D;&#x3D;6)&#123;
	var o&#x3D;record.data.id&#x3D;&#x3D;2?&#123;xtype:&quot;mymeetinghome&quot;&#125;:&#123;xtype:&quot;meetingmarkhome&quot;&#125;;
	&#x2F;&#x2F;注意，在这一步，为新添加的组件增加一个vmData属性，如果这个属性存在
	&#x2F;&#x2F;新生成的组件会将其放到viewModel中。
	o.vmData&#x3D;&#123;&#39;userName&#39;:ctBox.employee_name&#125;;
	ctBox.items.items[record.data.id].removeAll();
	ctBox.items.items[record.data.id].add(o);
	setTimeout(() &#x3D;&gt; &#123;
	    Ext.fly(itemId).setStyle(&#123;
		border:&quot;0px&quot;
	    &#125;);
	    ctBox.getLayout().setActiveItem(record.data.id);
	&#125;, 200);
	
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>组件对新添加的属性，进行响应。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">constructor:function(config)&#123;&#x2F;&#x2F;后执行
	var me &#x3D; this;
        me.superclass.constructor.call(me, config);
	&#x2F;&#x2F;注意constructor的最后，才能使用me.down(&#39;mainmeetingtitlebar&#39;)这个方法
	&#x2F;&#x2F;否则会找不到组件的。
	&#x2F;&#x2F;这个应该是常用的技俩。习惯将vmData放到ViewModel中。
        if(me.vmData)&#123;
            me.down(&#39;mainmeetingtitlebar&#39;).getViewModel().setData(me.vmData);
        &#125; 
       
&#125;,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="会议预约后台数据导出功能"><a href="#会议预约后台数据导出功能" class="headerlink" title="会议预约后台数据导出功能"></a>会议预约后台数据导出功能</h3><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;indexshineloginsuccessevent这个事件，会在登录成功后，或者页面刷新后，都会发消息。
&#x2F;&#x2F;在这个事件中接收消息。确保，ShineMessageHub.roleId始终都能获取到值。
&#x2F;&#x2F;接收登陆成功消息
ShineMessageHub.on(&quot;indexshineloginsuccessevent&quot;,function(obj)&#123;
	me.getLayout().setActiveItem(0);
	ShineMessageHub.roleId&#x3D;obj[&#39;role_id&#39;];
&#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>对比：</p>
<pre class="line-numbers language-none"><code class="language-none">form.submit(&#123;
    success: function (form, action) &#123;
        Ext.Msg.hide();
        console.log(action[&quot;result&quot;][&quot;user&quot;]);
        ShineMessageHub.fireEvent(&quot;indexshineloginsuccessevent&quot;, action[&quot;result&quot;][&quot;user&quot;]);
	&#x2F;&#x2F;注意，这个事件中，不能保证稳定触发。所以，应该
	&#x2F;&#x2F;监听indexshineloginsuccessevent这个消息。不论是登录、还是刷新页面，
	&#x2F;&#x2F;都能正常的获取到值。下面的代码直接删掉。
	ShineMessageHub.roleId &#x3D; action[&quot;result&quot;][&quot;user&quot;][&#39;role_id&#39;];
    &#125;,
    failure: function (form, action) &#123;
        var msg &#x3D; action[&quot;result&quot;][&quot;msg&quot;];
        Ext.Msg.hide();
        msgPanel.update(&#39;&lt;font color&#x3D;&quot;red&quot;&gt;&#39; + msg + &#39;&lt;&#x2F;font&gt;&#39;);
        &#x2F;&#x2F;重置验证码
        Ext.get(&quot;safecode&quot;).dom.src &#x3D; me.getCodeSrc();

    &#125;
&#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="取消代码优化"><a href="#取消代码优化" class="headerlink" title="取消代码优化"></a>取消代码优化</h3><blockquote>
<p>这个是突发奇想，没有试过。用在桌面版会议室选择跟模板选择的功能。原本的限制取消选择功能，是写在selectionchange(this, selected, eOpts )事件中的。但是发现写在beforedeselect中更好，检测eOpts，如果点击了非item节点，然后return flase，来阻止取消选择功能。（好吧，感觉也还有一点复杂。）</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">beforedeselect ( this, record, index, eOpts ) <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="更改radio的颜色"><a href="#更改radio的颜色" class="headerlink" title="更改radio的颜色"></a>更改radio的颜色</h3><blockquote>
<p>下面这个属性，干不过内联样式。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">.x-meetingordermenu&#123;&#x2F;&#x2F;这个类名，自己为组件增加的cls属性。缩小范围。
    span.x-form-radio&#123;
        color:#F3AD03;
    &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>就是下面这个东西会产生在html内的style标签。</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;设置radio的颜色
var radios &#x3D; el.query(&#39;span.x-form-radio-default&#39;, false);
Ext.each(radios, function (radio) &#123;
    radio.setStyle(&#123;
        color: &#39;#FFFFFF&#39;
    &#125;);
&#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>html中显示的style</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;span id&#x3D;&quot;radiofield-1026-displayEl&quot; data-ref&#x3D;&quot;displayEl&quot; 
role&#x3D;&quot;presentation&quot; class&#x3D;&quot;x-form-field x-form-radio x-form-radio-default x-form-cb x-form-cb-default   &quot; 
style&#x3D;&quot;color: rgb(255, 255, 255);&quot;&gt;
&lt;input type&#x3D;&quot;radio&quot; id&#x3D;&quot;radiofield-1026-inputEl&quot; name&#x3D;&quot;meeting_type&quot; data-ref&#x3D;&quot;inputEl&quot; class&#x3D;&quot;x-form-cb-input&quot; autocomplete&#x3D;&quot;off&quot; hidefocus&#x3D;&quot;true&quot; aria-hidden&#x3D;&quot;false&quot; aria-disabled&#x3D;&quot;false&quot; aria-invalid&#x3D;&quot;false&quot; aria-describedby&#x3D;&quot;radiofield-1026-ariaStatusEl&quot; data-componentid&#x3D;&quot;radiofield-1026&quot; style&#x3D;&quot;background-color: rgb(17, 96, 150); color: rgb(255, 255, 255);&quot;&gt;
&lt;&#x2F;span&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="提交失败"><a href="#提交失败" class="headerlink" title="提交失败"></a>提交失败</h3><blockquote>
<p>数据提交失败，区分失败的原因。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">failure: function (form, action) &#123;
    &#x2F;&#x2F;action的属性，来区分失败的提示语。
    var message &#x3D; action.failureType &#x3D;&#x3D; &quot;connect&quot; ? &#39;联网失败，请检查网络连接状态。&#39; : &#39;提交失败，请检查输入的数据是否完整。&#39;;
    Ext.Msg.hide();
    var win &#x3D; Ext.widget(&#123;
        xtype: &#39;commonmsgwin&#39;,
        vmData: &#123;
            title: &#39;操作提示&#39;,
            message: message,
            hiddenLeft: true
        &#125;,
        rightHandler: function () &#123;
            win.destroy();
        &#125;
    &#125;).show();
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="选择时间的tbar标签的宽度样式"><a href="#选择时间的tbar标签的宽度样式" class="headerlink" title="选择时间的tbar标签的宽度样式"></a>选择时间的tbar标签的宽度样式</h3><blockquote>
<p>设置一个最小宽度。防止太小挤变形。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">tbar: [&#123;
        xtype: &#39;label&#39;,
        text: &#39;查看会议室使用情况&#39;,
        flex: 1,
        minWidth: 230, &#x2F;&#x2F;增加一个宽度，防止太小挤变形。
        style: &#123;
            color: &#39;black&#39;,
            fontSize: &#39;20px&#39;,
            lineHeight: &#39;20px&#39;
        &#125;
    &#125;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="优化toast效果"><a href="#优化toast效果" class="headerlink" title="优化toast效果"></a>优化toast效果</h3><blockquote>
<p>本方案采用两种方式同时进行优化，第一种，屏蔽用户频繁点击。如果距离上次点击的时间太近，则直接不响应。直到下次响应后，记录下响应的时间。（相当于锁机制）。另外一种机制，如果用户点击的时候，发现还有其他的相同的实例存在，干掉他们。然后自己再显示出来。</p>
</blockquote>
<p>巧了，在框架里面也发现了跟我命令差不多的变量，lastTouchTime。这样的话，也能优化，自己的代码呢。</p>
<pre class="line-numbers language-none"><code class="language-none">Ext.isTouchMode &#x3D; function () &#123;
    return (Ext.now() - Ext.lastTouchTime) &lt; 500;
&#125;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;
Ext.define(&quot;Ext.locale.zh_CN.window.Toast&quot;, &#123;	
    override: &quot;Ext.window.Toast&quot;,
    listeners:&#123;
        &#39;beforeshow&#39;:function(cmp, eOpts)&#123;
            var t&#x3D;Ext.all(&#39;toast&#39;);
	    
            var now&#x3D;new Date().getTime();
            if(Ext.lastToastTime&amp;&amp;(now-Ext.lastToastTime)&lt;1000)&#123;
                return false;
            &#125;
            Ext.lastToastTime &#x3D; now;
            Ext.each(t,function(tst)&#123;
                if(tst!&#x3D;&#x3D;cmp)&#123;
                    tst.destroy();
                &#125;
            &#125;);
        &#125; 
    &#125;,
&#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>另外，now的定义如下（为啥多个+号，就能将时间变成时间戳。这是什么骚操作？）：</p>
<pre class="line-numbers language-none"><code class="language-none">Ext.now &#x3D; Date.now || (Date.now &#x3D; function() &#123;
        return +new Date();
&#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>另外，发现，这个组件好像也自动监测了，其他的toast组件。尤其是me.getToasts()函数。这个消息提示，其实做得真心的复杂，功能多。但是，展示出来的效果却不是我们想要的，只能更改。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">removeFromAnchor: function () &#123;
    var me &#x3D; this,
        activeToasts, index;

    if (me.anchor) &#123;
        activeToasts &#x3D; me.getToasts();
        index &#x3D; Ext.Array.indexOf(activeToasts, me);
        if (index !&#x3D;&#x3D; -1) &#123;
            Ext.Array.erase(activeToasts, index, 1);

            &#x2F;&#x2F; Slide &quot;down&quot; all activeToasts &quot;above&quot; the hidden one 
            for (; index &lt; activeToasts.length; index++) &#123;
                activeToasts[index].slideBack();
            &#125;
        &#125;
    &#125;
&#125;,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="查找泄漏的变量"><a href="#查找泄漏的变量" class="headerlink" title="查找泄漏的变量"></a>查找泄漏的变量</h3><blockquote>
<p>js的局部变量应该封装在局部，这样避免其他的地方引用此变量，造成意外错误，而且排查错误难。查找泄漏的变量，直接在控制台输入window，所有绑定到该变量上的其他的变量都是泄漏的变量或者全局变量。这是一种好方法，可以看到全局的变量的一些特征，如：ShineMessageHub监听的事件等。</p>
</blockquote>
<p>以下为一个泄漏的局部变量。部分代码如下：</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;************
     * 
     * 修改会议
     * 2019年1月17日
     * ***********&#x2F;
    editMeeting:function(record)&#123;
        var me&#x3D;this;
        var menu&#x3D;me.down(&#39;meetingordermenu&#39;);
        me.setItemIndex&#x3D;2;
	&#x2F;&#x2F;这一块忘了声明了，结果rdData泄漏成全局变量
        rdData &#x3D; Ext.clone(record[&#39;data&#39;]);
        console.log(rdData);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h3><blockquote>
<p>逻辑运算具有短路效应，优先将容易返回值的放在前面。&amp;&amp; 将容易为false的放在前面。||将容易为真的放在前面。</p>
</blockquote>
<p>php代码：</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;为了保护访问，临时增加了一个password进行保护。
if (isset($params[&#39;password&#39;]) &amp;&amp; $params[&#39;password&#39;] &#x3D;&#x3D; &#39;clearmeeting&#39;) &#123;
    $now &#x3D; time();
    &#x2F;&#x2F;前面的表达式更容易返回值，所以放在前面。
    if ($now &lt; strtotime(date(&#39;Y-m-01 06:00&#39;)) &amp;&amp; $now &gt; strtotime(date(&#39;Y-m-01 01:00&#39;))) &#123;
        $data &#x3D; MeetingListUtils::clearMeeting($params);
        echo Zend_Json::encode($data);
    &#125; else &#123;
        echo Zend_Json::encode(array(&#39;code&#39; &#x3D; &gt; 2, &#39;msg&#39; &#x3D; &gt; &quot;未到月初清理时间，当前时间&quot;.date(&#39;Y-m-d H:i:s&#39;)));
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="store加载拦截"><a href="#store加载拦截" class="headerlink" title="store加载拦截"></a>store加载拦截</h3><blockquote>
<p>之所以要拦截，是因为就有axios拦截器，而store却没有，如果store加载请求的时候，并没有使用Ext.Ajax进行请求。按找传统html的设计，如果用户没有登录，可以通过重定向，让用户跳转到登录界面。但是ajax却不能让浏览器的页面跳转。所以，想在ajax里面让其跳转。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">proxy: &#123;
    type: &#39;ajax&#39;,
    &#x2F;&#x2F; url: SHINEVMSHTTP + &#39;&#x2F;admin&#x2F;meeting&#x2F;list&#x2F;mymeeting&#39;,
    url: SHINEVMSHTTP + &quot;&#x2F;admin&#x2F;desktop&#x2F;mymeetinglist&#x2F;getmeetinginfo&quot;,
    reader: &#123;
        type: &#39;json&#39;,
        rootProperty: &#39;result&#39;,
        totalProperty: &#39;count&#39;
    &#125;,
    &#x2F;&#x2F;注意，这个proxy是能响应事件的。
    listeners: &#123;
        &#39;beginprocessresponse&#39;: function () &#123;
            console.log(&#39;猜猜我是谁？阴险&#39;);
            return false;&#x2F;&#x2F;这个并不会组织解析
        &#125;
	&#x2F;&#x2F;另外还能响应如下事件。以下事件是在源代码Ext.define(&#39;Ext.data.ProxyStore&#39;, 中发现。
        &#x2F;&#x2F;endprocessresponse
        &#x2F;&#x2F;exception
        &#x2F;&#x2F;metachange
    &#125;
&#125;,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="获取部门树形结构时，导致死循环"><a href="#获取部门树形结构时，导致死循环" class="headerlink" title="获取部门树形结构时，导致死循环"></a>获取部门树形结构时，导致死循环</h1><p>在获取树形结构时，当前id跟parent_id一致，导致了死循环。</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;**********
*部门列表
**********&#x2F;
public static function getDeptTree($params)&#123;
	$db &#x3D; Zend_Registry::get(&#39;db&#39;);
	&#x2F;&#x2F;在此处进行了限制。
	$sql &#x3D; &quot;select * from department where department_id !&#x3D;department_parent_id&quot;;
	$res &#x3D; $db-&gt;query($sql);
	$rows &#x3D; $res-&gt;fetchAll();
	$data &#x3D; self::getChild($rows,&quot;null&quot;,$params);
	if(isset($params[&#39;format&#39;])&amp;&amp;$params[&#39;format&#39;]&#x3D;&#x3D;&#x3D;&#39;object&#39;)&#123;&#x2F;&#x2F;转换对象json格式
		return $data[0];
	&#125;
	return $data;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/01/20/2019-01-1_meetingorderdesktop_order_selecttime/" rel="prev" title="会议室选择时间设计">
                  <i class="fa fa-chevron-left"></i> 会议室选择时间设计
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/02/18/vue-learn/" rel="next" title="vue学习笔记">
                  vue学习笔记 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">豫ICP备17029463号-1 </a>
  </div>

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chaofml</span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  







  






</body>
</html>
